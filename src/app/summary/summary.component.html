<div class="card">
  <div class="card-body">
<form [formGroup]="addsummary" (ngSubmit)="SubmitTab5(flag,content5)" (keyup)="onKeyForm($event)">
        <mat-accordion>
          <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <h3>Extent And Limitations Of Inspection And Testing</h3>
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="form-group" [ngClass]="{'disableForm':service.allFieldsDisable}">                    
              <div class="row">
                  <div class="col-sm-12">
                    <div class="form-group">
                      <label>Extent Of Installation Covered By This Report:</label>
                      <input type="text" class="form-control" formControlName="extentInstallation"
                      [(ngModel)]="summary.extentInstallation" 
                      [ngClass]="{ 'is-invalid': submitted && f.extentInstallation?.errors }">
                      <div *ngIf="submitted && f.extentInstallation?.errors" class="invalid-feedback">
                        <div *ngIf="f.extentInstallation?.errors?.required">Field Is Required</div>
                    </div>
                    </div>
                  </div>
                  <div class="col-sm-12">
                    <div class="form-group">
                      <label>Agreed Limitations Including The Reasons:</label>
                      <input type="text" class="form-control" formControlName="agreedLimitations"
                      [(ngModel)]="summary.agreedLimitations"
                      [ngClass]="{ 'is-invalid': submitted && f.agreedLimitations?.errors }">
                      <div *ngIf="submitted && f.agreedLimitations?.errors" class="invalid-feedback">
                        <div *ngIf="f.agreedLimitations?.errors?.required">Field Is Required</div>
                    </div>
                    </div>
                  </div>
    
                  <div class="col-sm-12">
                    <div class="form-group">
                      <label>Agreed With:</label>
                      <input type="text" class="form-control" formControlName="agreedWith"
                      [(ngModel)]="summary.agreedWith"
                      [ngClass]="{ 'is-invalid': submitted && f.agreedWith?.errors }">
                      <div *ngIf="submitted && f.agreedWith?.errors" class="invalid-feedback">
                        <div *ngIf="f.agreedWith?.errors?.required">Field Is Required</div>
                    </div>
                    </div>
                  </div>
    
                  <div class="col-sm-12">
                    <div class="form-group">
                      <label>Operational Limitations Including The Reasons:</label>
                      <input type="text" class="form-control" formControlName="operationalLimitations"
                      [(ngModel)]="summary.operationalLimitations"
                      [ngClass]="{ 'is-invalid': submitted && f.operationalLimitations?.errors }">
                      <div *ngIf="submitted && f.operationalLimitations?.errors" class="invalid-feedback">
                        <div *ngIf="f.operationalLimitations?.errors?.required">Field Is Required</div>
                    </div>
                    </div>
                  </div>
    
                  <div class="col-sm-12">
                    <div class="form-group">
                      <label>The inspection and testing detailed in this report have been carried out in accordance 
                        with IEC60364. It should be note that cables concealed within trunk/trench and conduits, 
                        under floors and generally within the fabric of the building or underground, have not been 
                        inspected unless specifically agreed between the client and inspector prior to inspection:</label>
                        <input type="text" class="form-control" formControlName="inspectionTestingDetailed"
                        [(ngModel)]="summary.inspectionTestingDetailed"
                        [ngClass]="{ 'is-invalid': submitted && f.inspectionTestingDetailed?.errors }">
                        <div *ngIf="submitted && f.inspectionTestingDetailed?.errors" class="invalid-feedback">
                          <div *ngIf="f.inspectionTestingDetailed?.errors?.required">Field Is Required</div>
                      </div>
                    </div>
                  </div>
                </div>
            </div>
          </mat-expansion-panel>

          <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <h3>Observations </h3>
              </mat-panel-title>
            </mat-expansion-panel-header>
              <div class="row" [ngClass]="{'disableForm':service.allFieldsDisable}">
              <div class="col-sm-12">
                <div class="form-group">
                  <label>Referring to attached inspection report and test results and subject to the 
                    limitations specified at the extent and limitations of inspection and testing :</label>
                  <select class="form-control" formControlName="limitationsInspection" (change)="onChange($event)"
                  [(ngModel)]="summary.limitationsInspection"
                  [ngClass]="{ 'is-invalid': submitted && f.limitationsInspection?.errors }">
                  <option value="0" selected>Select Option</option>
                  <option *ngFor="let a of observationList" [selected]="a === summary.limitationsInspection">{{a}}</option>
                  <!-- <option value="No remedial action required" [selected]="f.limitationsInspection?.value === summary.limitationsInspection">No remedial action required</option>
                  <option value="The following observations are made" [selected]="f.limitationsInspection?.value === summary.limitationsInspection">The following observations are made</option> -->
                </select>
                <div *ngIf="submitted && f.limitationsInspection?.errors" class="invalid-feedback">
                  <div *ngIf="f.limitationsInspection?.errors?.required">Field is required</div>
                </div>
                </div>
              </div>
         </div>
         <div *ngIf="selectedType">
              <div formArrayName="ObservationsArr" *ngFor="let a of getObservationsControls(); let i = index">
              <div class="form-group" [formGroupName]="i" [ngClass]="{'disableForm':service.allFieldsDisable}">
            <div class="form-group">
        <div class="row">
              <div class="col-sm-12">
                <div class="form-group">
                  <label>Observations:</label>
                  <mat-icon class="mousechange" (click)="addObservations()" style="margin-top: 2px;
                  float: right;">add_box</mat-icon>
                  <textarea matInput class="client-box-description" maxlength="500" formControlName="observations"
                   placeholder="Ex. Report description..." 
                   [ngClass]="{ 'is-invalid': submitted && f.observations?.errors }"></textarea>
                   <div *ngIf="submitted && f.observations?.errors" class="invalid-feedback">
                    <div *ngIf="f.observations?.errors?.required">Field Is Required</div>
                </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label>Further actions:</label>
                  <select class="form-control" formControlName="furtherActions" 
                  [ngClass]="{ 'is-invalid': submitted && f.furtherActions?.errors }">
                    <option value="0" selected>Select Option</option>
                    <option >C1 – Danger present. Risk of injury. Immediate remedial action required</option>
                    <option>C2 – Potentially dangerous – urgent remedial action required</option>
                    <option>C3 – Improvement recommended</option>
                  </select>
                  <div *ngIf="submitted && f.furtherActions?.errors" class="invalid-feedback">
                    <div *ngIf="f.furtherActions?.errors?.required">Field Is Required</div>
                </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label>Reference number in report:</label>
                  <input type="number" min="0" formControlName="referanceNumberReport" class="form-control"  
                  placeholder="Enter Reference Number" [ngClass]="{ 'is-invalid': submitted && f.referanceNumberReport?.errors }">
                  <div *ngIf="submitted && f.referanceNumberReport?.errors" class="invalid-feedback">
                    <div *ngIf="f.referanceNumberReport?.errors?.required">Field Is Required</div>
                </div> 
                </div>
              </div>
              <div class="col-sm-12">
                <div class="form-group">
                  <label>Comment:</label>
                  <textarea matInput class="client-box-description" maxlength="500" 
                  placeholder="Ex. Report description..." formControlName="comment"
                  [ngClass]="{ 'is-invalid': submitted && f.comment?.errors }"></textarea>
                  <div *ngIf="submitted && f.comment?.errors" class="invalid-feedback">
                    <div *ngIf="f.comment?.errors?.required">Field Is Required</div>
                </div>
                </div>
              </div>
              <mat-icon class="mousechange" *ngIf="getObservationsControls().length > 1" 
                (click)="removeObservations(i)" style="margin-top: 2px;float: right;">remove_circle</mat-icon>
            </div>
          </div>
                </div>
              </div>
            </div>
          </mat-expansion-panel>

          <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <h3>Recommendations</h3>
              </mat-panel-title>
            </mat-expansion-panel-header>
              <div [ngClass]="{'disableForm':service.allFieldsDisable}">
                <div class="row">
                  <div class="col-sm-12">
                    <div class="form-group">
                      <label>Where the overall assessment of the suitability of the installation for 
                        continuous use above is stated as unsatisfactory, I/We recommend that any observations 
                        classified as “danger present” (Code C1) or “potentially dangerous” (Code C2) are acted 
                        upon the matter of urgency. Investigation without delay is recommended for observations 
                        identified as “Required further investigation”. Observations classified as “Improvement 
                        recommended” (Code C3) should be given due consideration. Subject to necessary remedial 
                        action being taken, I/We recommended that the installation is further inspected and tested
                         by date.:</label>
                         <input type="date" class="form-control" placeholder="Enter Date"
                          [(ngModel)]="summary.recommendationsDate" formControlName="recommendationsDate"
                          [ngClass]="{ 'is-invalid': submitted && f.recommendationsDate?.errors }">  

                          <!-- <input matInput [matDatepicker]="picker" (click)="picker.open()" placeholder="Choose a date"
                          [(ngModel)]="summary.recommendationsDate" formControlName="recommendationsDate" autocomplete="off"
                          [ngClass]="{ 'is-invalid': submitted && f.recommendationsDate?.errors }" 
                          style="border-bottom: 1px solid darkgrey;padding: 10px;" id="summaryDateIcon">
                          <mat-datepicker-toggle matSuffix [for]="picker" style="float: right;position: relative;bottom: 40px;"></mat-datepicker-toggle>
                          <mat-datepicker #picker></mat-datepicker> -->

                          <div *ngIf="submitted && f.recommendationsDate?.errors" class="invalid-feedback">
                            <div *ngIf="f.recommendationsDate?.errors?.required">Field Is Required</div>
                        </div>            
                    </div> 
                  </div>
                </div>
              </div>
          </mat-expansion-panel>

          <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <h3>Summary And Conditions Of The Installation </h3>
              </mat-panel-title>
            </mat-expansion-panel-header>
                <div class="form-group" [ngClass]="{'disableForm':service.allFieldsDisable}">
                  <div class="row">
                    <div class="col-sm-12">
                      <div class="form-group">
                        <label>General condition of the installation in terms of electrical safety:</label>
                        <input type="text" class="form-control" formControlName="generalConditionInstallation" 
                        [(ngModel)]="summary.generalConditionInstallation" 
                        [ngClass]="{ 'is-invalid': submitted && f.generalConditionInstallation?.errors }">
                        <div *ngIf="submitted && f.generalConditionInstallation?.errors" class="invalid-feedback">
                          <div *ngIf="f.generalConditionInstallation?.errors?.required">Field Is Required</div>
                      </div> 
                      </div>
                    </div>
                    <div class="col-sm-12">
                      <div class="form-group">
                        <label>Overall assessment of the installation in terms of suitability of continuous use:</label>
                        &nbsp;&nbsp;
                        <mat-radio-group class="example-radio-group" (change)="changeComboo($event)"
                         [(ngModel)]="summary.overallAssessmentInstallation" 
                         [ngClass]="{ 'is-invalid': submitted && f.overallAssessmentInstallation?.errors }"
                         formControlName="overallAssessmentInstallation">
                          <mat-radio-button class="example-radio-button" *ngFor="let installation of installations" 
                          [value]="installation">
                            {{installation}}
                          </mat-radio-button>
                        </mat-radio-group>
                        <div *ngIf="submitted && f.overallAssessmentInstallation?.errors" class="invalid-feedback">
                          <div *ngIf="f.overallAssessmentInstallation?.errors?.required">Field Is Required</div>
                      </div> 
                   </div>
                   <div *ngIf="f.overallAssessmentInstallation?.value=='Unsatisfactory'"><b>Note:</b>Unsatisfactory assessment indicates that dangerous and/or 
                     potentially dangerous conditions have been identified</div>
                    </div>
                  </div>
                </div>
              </mat-expansion-panel>

          <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <h3>Declaration</h3>
              </mat-panel-title>
            </mat-expansion-panel-header>
              <div formArrayName="Declaration1Arr" *ngFor="let a of getDeclaration1Controls(); let i = index">
                <div class="form-group" [formGroupName]="i" [ngClass]="{'disableForm':service.allFieldsDisable}">
                  <label>I/we being the person responsible for the inspection & testing  of the electrical 
                    installation (as indicated by my/our signatures below), particulars of which are described 
                    in this report, having exercised reasonable skill and care when carrying out the inspection 
                    and testing, hereby declare that information in this report including the observations 
                    provides an accurate assessment of condition of electrical installation taking into account 
                    the stated extent and limitations in part 5 of this report:</label>
    
                  <h2>Inspected and tested by:</h2>
                  <div class="form-group">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group">
                        <label>Name:</label>
                        <input type="text" class="form-control" formControlName="name"
                        [ngClass]="{ 'is-invalid': submitted && a.get('name')?.errors }">
                        <div *ngIf="submitted && a.get('name')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('name')?.errors?.required">Person name is required</div>
                      </div>
                      </div>
                    </div>
      
                    <div class="col-md-6">
                      <div class="form-group">
                        <label>Signature:</label>
                        <input type="text" class="form-control" formControlName="signature" readonly
                        [ngClass]="{ 'is-invalid': submitted && a.get('signature')?.errors }">
                        <div *ngIf="submitted && a.get('signature')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('signature')?.errors?.required">Signature is required</div>
                      </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group">
                        <label>Company:</label>
                        <input type="text" class="form-control" formControlName="company"
                        [ngClass]="{ 'is-invalid': submitted && a.get('company')?.errors }">
                        <div *ngIf="submitted && a.get('company')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('company')?.errors?.required">Company name is required</div>
                      </div>
                      </div>
                    </div>
      
                    <div class="col-md-6">
                      <div class="form-group">
                        <label>Position:</label>
                        <input type="text" class="form-control" formControlName="position"
                        [ngClass]="{ 'is-invalid': submitted && a.get('position')?.errors }">
                        <div *ngIf="submitted && a.get('position')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('position')?.errors?.required">Position is required</div>
                      </div>
                      </div>
                    </div>
      
                    <div class="col-md-6">
                      <div class="form-group">
                        <label>Address:</label>
                        <input type="text" class="form-control" formControlName="address"
                        [ngClass]="{ 'is-invalid': submitted && a.get('address')?.errors }">
                        <div *ngIf="submitted && a.get('address')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('address')?.errors?.required"><Address></Address> is required</div>
                      </div>
                      </div>
                    </div>
      
                    <div class="col-md-6">
                      <div class="form-group">
                        <label>Date:</label>
                        <input type="date" class="form-control" formControlName="date"
                        [ngClass]="{ 'is-invalid': submitted && a.get('date')?.errors }">
                        <div *ngIf="submitted && a.get('date')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('date')?.errors?.required">Date is required</div>
                      </div>
                      </div>
                    </div>
                  </div>
                </div>
                </div>
              </div>

                <div formArrayName="Declaration2Arr" *ngFor="let a of getDeclaration2Controls(); let i = index">
                  <div class="form-group" [formGroupName]="i" [ngClass]="{'disableForm':service.allFieldsDisable}">
                    <h2>Authorised by:</h2>
                    <div class="form-group">
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label>Name:</label>
                          <input type="text" class="form-control" formControlName="name"
                          [ngClass]="{ 'is-invalid': submitted && a.get('name')?.errors }">
                          <div *ngIf="submitted && a.get('name')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('name')?.errors?.required">Person name is required</div>
                        </div>
                        </div>
                      </div>
        
                      <div class="col-md-6">
                        <div class="form-group">
                          <label>Signature:</label>
                          <input type="text" class="form-control" formControlName="signature" readonly
                          [ngClass]="{ 'is-invalid': submitted && a.get('signature')?.errors }">
                        <div *ngIf="submitted && a.get('signature')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('signature')?.errors?.required">Signature is required</div>
                      </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <label>Company:</label>
                          <input type="text" class="form-control" formControlName="company"
                          [ngClass]="{ 'is-invalid': submitted && a.get('company')?.errors }">
                          <div *ngIf="submitted && a.get('company')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('company')?.errors?.required">Company name is required</div>
                        </div>
                        </div>
                      </div>
        
                      <div class="col-md-6">
                        <div class="form-group">
                          <label>Position:</label>
                          <input type="text" class="form-control" formControlName="position"
                          [ngClass]="{ 'is-invalid': submitted && a.get('position')?.errors }">
                          <div *ngIf="submitted && a.get('position')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('position')?.errors?.required">Position is required</div>
                        </div>
                        </div>
                      </div>
        
                      <div class="col-md-6">
                        <div class="form-group">
                          <label>Address:</label>
                          <input type="text" class="form-control" formControlName="address"
                          [ngClass]="{ 'is-invalid': submitted && a.get('address')?.errors }">
                          <div *ngIf="submitted && a.get('address')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('address')?.errors?.required">Address is required</div>
                        </div>
                        </div>
                      </div>
        
                      <div class="col-md-6">
                        <div class="form-group">
                          <label>Date:</label>
                          <input type="date" class="form-control" formControlName="date"
                          [ngClass]="{ 'is-invalid': submitted && a.get('date')?.errors }">
                          <div *ngIf="submitted && a.get('date')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('date')?.errors?.required">Date is required</div>
                        </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  </div>
                </div>
            
          </mat-expansion-panel>

          <!-- comments start-->
  <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false" *ngIf="hideShowComment">
    <mat-expansion-panel-header>
      <mat-panel-title>
        <h3>Comments</h3>
      </mat-panel-title>
    </mat-expansion-panel-header>
   
   <mat-progress-spinner style="margin: 0 auto;" *ngIf="spinner"
  color="primary"
   [mode]="mode"
   value="50"
  diameter="50">
</mat-progress-spinner>

<div class="card-body" style="padding: 0px;" *ngIf="cardBodyComments">
<button class="btn dropdown" (click)="showSubmenu = !showSubmenu" style="width:100%;" 
*ngIf="(isExpanded || isShowing) || (toggleHideShow || getViewerCommentControls().length > 2)">
  <mat-icon class="menu-button" [ngClass]="{'rotated' : showSubmenu}" style="float: left;">chevron_right</mat-icon> 
  <label style="float: left;">Check comments here!</label>
 </button> 
 <span *ngIf="getViewerCommentControls().length==0">No comments!</span>
 <mat-icon class="mousechange" (click)="refreshCommentSection()" style="float: right;"
 title="Refresh comment">refresh</mat-icon> 

<div  formArrayName="viewerCommentArr" *ngFor="let a of getViewerCommentControls(); let i = index" 
style="margin-left: 10px;">
<div [formGroupName]="i" style="margin-left: 30px;">
<div class="submenu" [ngClass]="{'expanded' : showSubmenu}" [ngStyle]="{'display': showSubmenu ? 'block' : 'none'}">

  <div class="input-group" [ngClass]="{even: i!=0}" style="align-items: end;">
    <div class="input-group-prepend" title="Viewer" style="height: 26px;">
        <span class="input-group-text" style="line-height: unset;">
            <i class="bi bi-eye-fill"></i>
        </span>
    </div>
    <textarea cols="60" rows="1" formControlName="viewerComments" placeholder="Enter Viewer Comment">
   </textarea>

<div style="display: flex;margin-left: 25px;" *ngIf="replyCommentBox">

          <mat-icon class="mousechange" (click)="sendViewerComment(a)" [ngClass]="{'disable':disableSend== true}"
          *ngIf="((a.get('inspectorComments')?.value=='' || a.get('inspectorComments')?.value==null) && sendComment)"
          title="Send comment">send</mat-icon> &nbsp;&nbsp;&nbsp;&nbsp;

          <mat-icon class="mousechange" (click)="replyToViewerComment(a)" 
          *ngIf="((a.get('viewerComments')?.value!='') && (getViewerCommentControls().length-1 == i)) && hideAsViewerLogin "
         title="Reply comment">reply</mat-icon>&nbsp;&nbsp;&nbsp;&nbsp;

         <mat-icon class="mousechange" (click)="ViewerRemoveComment(i)" style="float:right;position: relative;left: 630%;"
         *ngIf="(a.get('inspectorComments')?.value=='' || a.get('viewerComments')?.value=='') && hideDelete" >delete</mat-icon>
         &nbsp;&nbsp;&nbsp;&nbsp;

        
  </div>
</div>


  <span [ngClass]="i!=0 ? 'viewer' : 'even1'">
    {{a.value.viewerUserName}} {{a.value.viewerDateTime | date:'dd-MM-YY hh:mm:ss a':'+0530'}}
  </span>  

<div *ngIf="replyCommentBox">

<ul style="list-style-type:none;margin-bottom: 0rem;">
<li> 

  <div class="input-group" style="align-items: end;"
  *ngIf="(a.get('inspectorComments')?.value!='' && a.get('inspectorComments')?.value!=null) || showReplyBox" >
    <div class="input-group-prepend" title="Inspector" style="height: 26px;">
        <span class="input-group-text" style="line-height: unset;">
            <i class="bi bi-person-fill"></i>
        </span>
    </div>
    <textarea cols="60" rows="1" placeholder="Enter Inspector Comment" formControlName="inspectorComments" ></textarea>
 <div style="display: initial;margin-left: 25px;">

     <mat-icon class="mousechange" (click)="inspectorComment(a)" [ngClass]="{'disable':disableReply== true}"
     *ngIf="(getViewerCommentControls().length-1 == i) && SendReply" title="Send reply">send</mat-icon>

     <mat-icon class="mousechange" (click)="approveComment(a)" [ngClass]="{'disable':enabledRequest== true}"
     *ngIf="((getViewerCommentControls().length-1 == i) && hideapprove) && a.value.approveOrReject != 'REJECT'"
     title="Approve comment">thumb_up_alt</mat-icon> &nbsp;&nbsp;&nbsp;&nbsp;

     <mat-icon class="mousechange" (click)="rejectComment(a)" 
     [ngClass]="{'disable':a.value.approveOrReject === 'REJECT' || enabledRequest== true}"

      *ngIf="((getViewerCommentControls().length-1 == i) && hideReject) || 
      ((a.get('inspectorComments')?.value!='' || a.get('viewerComments')?.value!='') && a.value.approveOrReject=='REJECT')"
     title="Reject comment">thumb_down_alt</mat-icon>

     

     <mat-icon class="mousechange" (click)="addAnotherviewerComment()"
     *ngIf="((getViewerCommentControls().length-1 == i) && hideAdd) 
     || ((a.value.approveOrReject === 'REJECT' && getViewerCommentControls().length-1 == i) && addReject)"
      style="float:right;position: relative;left: 718%;" title="Add another comment">add_box</mat-icon>

 </div>
</div>

 <span style="display: block;font-size: 11px;text-align: center;margin-left: -29%;">
  {{a.value.inspectorUserName}} {{a.value.inspectorDateTime | date:'dd-MM-YY hh:mm:ss a':'+0530'}}</span>  
       </li>
     </ul>
    </div> 
    </div>
    </div>
  </div> 
   
  </div>   
   
  </mat-expansion-panel>

<!-- completed comments start-->
<mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false" *ngIf="completedComments">
<mat-expansion-panel-header>
<mat-panel-title>
<h3>Completed Comments</h3>
</mat-panel-title>

</mat-expansion-panel-header>
<div class="card-body" style="padding: 0px;">
<div formArrayName="completedCommentArr1" *ngFor="let x of getCompletedCommentControls1(); let j = index" >
<div [formGroupName]="j">

<button class="btn dropdown" (click)="showHideAccordion(j);" style="width:100%;" 
*ngIf="(isExpanded || isShowing) || toggleHideShow || getCompletedCommentControls1().length >= 1">
  <mat-icon class="menu-button" style="float: left;">chevron_right</mat-icon> 
  <label style="float: left;">{{getViewerFirstMessage(x)}}...</label>
 </button> 

<div *ngIf="j === expandedIndexx" >
<div  formArrayName="completedCommentArr" *ngFor="let a of getCompletedCommentControls(x); let i = index" 
style="margin-left: 10px;" > 
<div [formGroupName]="i" style="margin-left: 30px;">
<div class="submenu" >

<div class="input-group" [ngClass]="{even: i!=0}" style="align-items: end;">
<div class="input-group-prepend" title="Viewer" style="height: 26px;">
    <span class="input-group-text" style="line-height: unset;">
        <i class="bi bi-eye-fill"></i>
    </span>
</div>
<textarea cols="60" rows="1"  formControlName="viewerComments" placeholder="Enter Viewer Comment">
</textarea>
</div>
<div>
<span [ngClass]="i!=0 ? 'viewer' : 'even1'">
{{a.value.viewerUserName}} 
{{a.value.viewerDateTime | date:'dd-MM-YY hh:mm:ss a':'+0530'}}
</span>  
</div>
<div class="input-group" style="margin-left: 41px;width: 50%;align-items: end;">
<div class="input-group-prepend" title="Inspector" style="height: 26px;">
<span class="input-group-text" style="line-height: unset;">
  <i class="bi bi-person-fill"></i>
</span>
</div>
<textarea cols="60" rows="1"  formControlName="inspectorComments" placeholder="Enter Viewer Comment"></textarea>
</div>

<span style="display: block;font-size: 11px;text-align: center;margin-left: -25%;">
{{a.value.inspectorUserName}} {{a.value.inspectorDateTime | date:'dd-MM-YY hh:mm:ss a':'+0530'}}</span>  
   
</div>
</div>
</div> 
</div>
</div>
</div>
</div>   

</mat-expansion-panel>
<!-- completed comments end-->

      </mat-accordion>
      <div *ngIf="validationError" style="text-align: center;margin-top: 30px;">
        <span class="alert alert-danger">{{validationErrorMsg}}</span>
    </div>
    <div *ngIf="commentSuccess" style="text-align: center;margin-top: 30px;">
      <span class="successshow">Your comment has been sent to Inspector</span>
    </div>
    <div *ngIf="commentApprove" style="text-align: center;margin-top: 30px;">
      <span class="alert alert-success">Your response to comments has been approved</span>
    </div>
    <div *ngIf="commentReject" style="text-align: center;margin-top: 30px;">
      <span class="alert alert-danger">Your response to comments has been rejected</span>
    </div>
    <br>
      <!-- <div style="text-align: center;margin-top: 40px;">
        <button class="previous" mat-button matStepperPrevious>&laquo; Back</button>
      </div> -->
    
      <div class="row" style="display:block;margin-top: 30px;margin-left: 40px;">
        <div class="col-sm-12">
        <div style="text-align: center;"> 
        <button  style="width: auto;" type="submit" 
        class="btn btn-primary btn-rounded btn-md font-weight-medium auth-form-btn next"
        mat-button [ngClass]="{'disableSubmit':service.disableSubmitSummary}">
          <i class="bi bi-journal-arrow-up icon"></i> Submit</button>
    </div>
        </div>
      </div>
<br>
      <!-- <div class="row" *ngIf="showSubmit">
        <div class="col-sm-12">
        <div style="text-align: center;">
        <button  style="width: auto;" type="submit" (click)="openModalDialog(content2)"
        class="btn btn-block btn-primary btn-rounded btn-md font-weight-medium auth-form-btn next"
        mat-button>
          <i class="bi bi-journal-arrow-up icon"></i> Submit</button>
    </div>
        </div>
      </div> -->
  </form>
</div>
</div>

  <ng-template #content5 let-modal>
    <div class="modal-body">
        <div class="centre-text m-btm30">
            <div *ngIf="success" style="text-align: center;">
                <span class="alert alert-success">{{successMsg}}</span>
            </div>
            <div *ngIf="Error" style="text-align: center;">
                <span class="alert alert-danger">{{errorMsg}}</span>
            </div>
        </div>
    </div>
    <br>
    <button type="button" class="col-md-6" class="close" class="btn btn-primary btn-rounded btn-md font-weight-medium auth-form-btn"
   aria-label="Close" (click)="closeModalDialog()">
    <span aria-hidden="true">Ok</span>
</button>

</ng-template>

<ng-template #content2 let-modal>
  <div class="modal-body">
   <div class="centre-text m-btm30">
    <div style="text-align: center;" *ngIf="ConfirmSuccess">
      <span class="successshow">Are you sure you want to procced? </span>
      <br>
      <span style="font-size: 12px;"><b>Note:</b>Once saved, details can't be edited!</span>
     </div>
     <div *ngIf="Error" style="text-align: center;">
      <span class="alert alert-danger">{{errorMsg}}</span>
  </div>
  <br>
  <div class="row" *ngIf="Error">
    <button type="button" class="col-md-6" style="text-align:center; width: auto;" class="btn btn-primary btn-rounded btn-md font-weight-medium auth-form-btn"
    aria-label="Close" (click)="closeModalDialog()">
    <i class="bi bi-arrow-right-circle"></i>&nbsp;
     <span aria-hidden="true">Ok</span>
 </button>
</div>
    </div>
   </div>
  <br>
  <div class="row" *ngIf="ConfirmSuccess">
     <button type="button" class="col-md-6" style="text-align:center; width: auto;" class="btn btn-primary btn-rounded btn-md font-weight-medium auth-form-btn"
     aria-label="Close" (click)="OkModalDialog(content5)">
     <i class="bi bi-arrow-right-circle"></i>&nbsp;
      <span aria-hidden="true">Ok</span>
  </button>
  <button type="button" class="col-md-6" style="width: auto;" class="btn btn-danger btn-rounded btn-md font-weight-medium auth-form-btn"
     aria-label="Close" (click)="closeModalDialog()">
     <i class="bi bi-x icon"></i>
      <span aria-hidden="true">Cancel</span>
  </button>
</div>

  </ng-template>