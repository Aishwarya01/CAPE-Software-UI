
<div *ngIf="tabError" style="text-align: center;">
    <span class="alert alert-danger">{{tabErrorMsg}}</span>
  </div>
<div *ngIf="validationErrorTab" style="text-align: center;">
    <span class="alert alert-danger">{{validationErrorMsgTab}}</span>
  </div>

<div class="card">
    <div class="card-body">
        <form [formGroup]="EmcClientDetailsForm" (keyup)="onKeyForm($event)" (change)="onChangeForm($event)"
            (ngSubmit)="saveClientDetails(flag)">
            <div formArrayName="clientArr" *ngFor="let a of getClientControls(); let i = index">
                <div [formGroupName]="i">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label>Client Name: </label>
                                <input type="text" class="form-control" formControlName="clientName"
                                    [(ngModel)]="emcClientDetails.clientName" [readonly]="isEditableEmc"
                                    [ngClass]="{ 'is-invalid': submitted && a.get('clientName')?.errors }"
                                    placeholder="Please Enter Client name">
                                <!-- <div *ngIf="submitted &&a.clientName?.errors" class="invalid-feedback">
                            <div *ngIf="a.clientName?.errors?.required">Client Name Is Required</div>
                        </div> -->
                                <div *ngIf="submitted && a.get('clientName')?.errors" class="invalid-feedback">
                                    <div *ngIf="a.get('clientName')?.errors?.required">Client Name Is Required</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label>Contact Number:</label>
                            <input type="tel" class="form-control" ng2TelInput [ng2TelInputOptions]="{initialCountry: 'in',separateDialCode: 'true'}"
                                [readonly]="setReadOnly" (keypress)="keyPressNumbers($event)"
                                (countryChange)="countryChange($event)" placeholder="Enter Contact Number" 
                                formControlName="contactNumber" class="form-control"
                                [ngClass]="{ 'is-invalid': submitted && a.get('contactNumber')?.errors }">
                            <div *ngIf="submitted && a.get('contactNumber')?.errors" class="invalid-feedback">
                                <div *ngIf="a.get('contactNumber')?.errors?.required">Contact Number Is Required</div>
                                <div *ngIf="a.get('contactNumber')?.errors?.minlength">Please Enter 10 Digit Number</div>
                                <div *ngIf="a.get('contactNumber')?.errors?.maxlength">Please Enter 10 Digit Number</div>
                            </div>
                            <!-- [readonly]="setReadOnly" -->

                            <!-- [ngClass]="{'is-invalid':submitted && a.contactNumber?.errors}"> -->
                            <!-- <div *ngIf="submitted &&a.contactNumber?.errors" class="invalid-feedback">
                        <div *ngIf="a.contactNumber?.errors?.required">Contact Number is Required</div>
                        <div *ngIf="a.contactNumber?.errors?.minlength">Please Enter 10 Digit Number</div>
                        <div *ngIf="a.contactNumber?.errors?.maxlength">Please Enter 10 Digit Number</div>
                    </div> -->
                        </div>

                        <div class="col-md-4">
                            <div class="form-group">
                                <label>Contact Person: </label>
                                <input type="text" class="form-control" formControlName="contactPerson"
                                    [(ngModel)]="emcClientDetails.contactPerson" [readonly]="isEditableEmc"
                                    placeholder="Please Enter Client Person"
                                    [ngClass]="{ 'is-invalid': submitted && a.get('contactPerson')?.errors }">
                                <div *ngIf="submitted && a.get('contactPerson')?.errors" class="invalid-feedback">
                                    <div *ngIf="a.get('contactPerson')?.errors?.required">Contact Person Is Required
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <label>Landmark (Optional):</label>
                            <input type="text" formControlName="landMark" class="form-control" [readonly]="isEditableEmc"
                                placeholder="Enter Landmark" [(ngModel)]="emcClientDetails.landMark">
                            <!-- [ngClass]="{ 'is-invalid': submitted && a.landMark?.errors }"> -->
                            <!-- <div *ngIf="submitted && a.landMark?.errors" class="invalid-feedback">
                        <div *ngIf="a.landMark?.errors?.required">Landmark Is Required</div>
                    </div> -->
                        </div>

                        <div class="col-md-4">
                            <div class="form-group">
                                <label>Location (Optional):</label>
                                <input type="text" class="form-control" formControlName="clientLocation" [readonly]="isEditableEmc"
                                    [(ngModel)]="emcClientDetails.clientLocation"
                                    placeholder="Please Enter Client Location">
                                <!-- [ngClass]="{'is-invalid':submitted && a.clientLocation?.errors}"
                        <div *ngIf="submitted &&a.clientLocation?.errors" class="invalid-feedback">
                            <div *ngIf="a.clientLocation?.errors?.required">Client Location Is Required</div>
                        </div> -->
                            </div>
                        </div>

                        <div class="col-md-4">
                            <label>Address:</label>
                            <input type="text" formControlName="clientAddress" class="form-control"[readonly]="isEditableEmc"
                                placeholder="Enter Address" [(ngModel)]="emcClientDetails.clientAddress"
                                [ngClass]="{ 'is-invalid': submitted && a.get('clientAddress')?.errors }">
                            <!-- <div *ngIf="submitted && a.clientAddress?.errors" class="invalid-feedback">
                        <div *ngIf="a.clientAddress?.errors?.required">Address Is Required</div>
                    </div> -->
                            <div *ngIf="submitted && a.get('clientAddress')?.errors" class="invalid-feedback">
                                <div *ngIf="a.get('clientAddress')?.errors?.required">Client Address Is Required</div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="form-group">
                                <label>Email: </label>
                                <input type="text" class="form-control" formControlName="email" [readonly]="isEditableEmc"
                                    [(ngModel)]="emcClientDetails.email" placeholder="Enter Email Address"
                                    [ngClass]="{ 'is-invalid': submitted && a.get('email')?.errors }">
                                <!-- <div *ngIf="submitted &&a.email?.errors" class="invalid-feedback">
                            <div *ngIf="a.email?.errors?.required">Email is required</div>
                            <div *ngIf="a.email?.errors?.pattern">Enter valid email</div>
                        </div> -->
                                <div *ngIf="submitted && a.get('email')?.errors" class="invalid-feedback">
                                    <div *ngIf="a.get('email')?.errors?.required">Email is required</div>
                                    <div *ngIf="a.get('email')?.errors?.pattern">Enter valid email</div>
                                </div>
                            </div>

                        </div>

                        <div class="col-md-4">
                            <label>Country:</label>
                            <select formControlName="country" class="form-control" (change)="changeCountry($event)"
                                [(ngModel)]="emcClientDetails.country"   [attr.disabled]="isEditableEmc ? '' : null" 
                                [ngClass]="{ 'is-invalid': submitted && a.get('country')?.errors }">
                                <option value="0" selected>Select Country Name</option>
                                <option *ngFor="let country of countryList" [selected]="country.name=== emcClientDetails.country">{{country.name}}</option>
                            </select>
                            <!-- <div *ngIf="submitted && a.country?.errors" class="invalid-feedback">
                        <div *ngIf="a.country?.errors?.required">Country Is Required</div>
                    </div> -->
                            <div *ngIf="submitted && a.get('country')?.errors" class="invalid-feedback">
                                <div *ngIf="a.get('country')?.errors?.required">Country is required</div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <label>State:</label>
                            <select formControlName="state" class="form-control" [(ngModel)]="emcClientDetails.state"
                              [attr.disabled]="isEditableEmc ? '' : null" 
                                [ngClass]="{ 'is-invalid': submitted && a.get('state')?.errors }">
                                <option value="0" selected>Select State Name</option>
                                <option *ngFor="let state of stateList"
                                    [selected]="state.name === emcClientDetails.state">
                                    {{state.name}}</option>
                            </select>
                            <!-- <div *ngIf="submitted && a.state?.errors" class="invalid-feedback">
                        <div *ngIf="a.state?.errors?.required">State Is Required</div>
                    </div> -->
                            <div *ngIf="submitted && a.get('state')?.errors" class="invalid-feedback">
                                <div *ngIf="a.get('state')?.errors?.required">Email is required</div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div *ngIf="validationError" style="text-align: center;">
                <span class="errorshow">{{validationErrorMsg}}</span>
            </div>

            <div style="text-align: center;margin-top: 40px;margin-bottom: 20px;">
                <button class="next" (click)="gotoNextModal(content, content2)" mat-button>Next &raquo;</button>
            </div>

        </form>
    </div>
</div>

<ng-template #content let-modal>
    <!-- Spinner -->
    <mat-progress-spinner style="margin: 0 auto;" *ngIf="spinner" color="primary" [mode]="mode" value="50" diameter="50">
    </mat-progress-spinner>
    <br>
    <div *ngIf="spinner" style="text-align: center;">
        Please wait, the details are loading!
    </div>

    <div class="modal-body" *ngIf="popup">
        <div class="centre-text m-btm30">
            <div *ngIf="success" style="text-align: center;">
                <span class="successshow">{{successMsg}}</span>
            </div>
            <div *ngIf="Error" style="text-align: center;">
                <span class="errorshow">{{errorMsg}}</span>
            </div>
        </div>
    </div>
    <br>
    <div *ngIf="popup">
        <button type="button" *ngIf="success" style="text-align: center;margin-left:180px;width:20%;background-color: #0f800c;color: white;" class="close"
        class="btn btn-block btn-rounded btn-md font-weight-medium auth-form-btn" aria-label="Close"
        (click)="closeModalDialog()" matStepperNext>
        <span aria-hidden="true">Ok</span>
    </button>
    <button type="button" *ngIf="Error" style="text-align: center;margin-left:180px;width:20%;background-color: #0f800c;color: white;" class="close"
        class="btn btn-block btn-rounded btn-md font-weight-medium auth-form-btn" aria-label="Close"
        (click)="closeModalDialog()">
        <span aria-hidden="true">Ok</span>
    </button>
    </div>
</ng-template>

<ng-template #content2 let-modal>
    <div class="modal-body">
        <div class="centre-text m-btm30">
            <div style="text-align: center;">
                <span class="successshow">Are you sure you want to procced? </span>
                <br>
                <span style="font-size: 12px;">Note: Please verify all the details! </span>
            </div>
        </div>
    </div>
    <br>
    <div class="row">
        <button type="button" class="col-md-4" style="text-align: center;margin-left:100px;width:20%;background-color: #0f800c;color: white;"
            class="btn btn-rounded btn-md font-weight-medium auth-form-btn" aria-label="Close"
            (click)="closeModalDialog()" matStepperNext>
            <i class="bi bi-arrow-right-circle"></i>&nbsp;
            <span aria-hidden="true">Ok</span>
        </button>
        <button type="button" class="col-md-4" style="text-align: center;margin-left:100px;width:20%"
            class="btn btn-danger btn-rounded btn-md font-weight-medium auth-form-btn" aria-label="Close"
            (click)="closeModalDialog()">
            <i class="bi bi-x icon"></i>
            <span aria-hidden="true">Cancel</span>
        </button>
    </div>

</ng-template>