<div class="card">
  <div class="card-body">
    <form [formGroup]="supplycharesteristicForm" (ngSubmit)="nextTab2(flag)">
      <mat-accordion>
        <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <h3>Mains Incoming</h3>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div class="form-group">
            <div class="row">
              <div class="col-md-4">
                <label>System Earthing:</label>
                <select class="form-control"  formControlName="systemEarthing" [(ngModel)]="supplycharesteristic.mainSystemEarthing" [ngClass]="{ 'is-invalid': submitted && f.systemEarthing.errors }">
                  <option value="0" selected>Select Option</option>
                  <option *ngFor="let value of systemEarthingList">
                    {{value}}
                  </option>
                </select>
                <div *ngIf="submitted && f.systemEarthing.errors" class="invalid-feedback">
                  <div *ngIf="f.systemEarthing?.errors?.required">Field Is Required</div>
                </div>
              </div>

              <div class="col-md-4"> 
                  <label>Number and Type Of Live Conductors: </label>
                  <select class="form-control"  formControlName="liveConductor" 
                  [(ngModel)]="supplycharesteristic.liveConductorType" (change)="changeCurrent($event)" [ngClass]="{ 'is-invalid': submitted && f.liveConductor.errors }">
                    <option value="0" selected>Select Option</option>
                    <option value="AC">AC</option>
                    <option value="DC" disabled style="cursor: not-allowed;">DC</option>
                  </select>
                  <div *ngIf="submitted && f.liveConductor.errors" class="invalid-feedback">
                    <div *ngIf="f.liveConductor?.errors?.required">Field Is Required</div>
                  </div>
              </div>

              <div class="col-md-4" *ngIf="enableAC"> 
                  <label>AC:</label>
                  <select class="form-control" formControlName="AcConductor" [(ngModel)]="supplycharesteristic.liveConductorAC" 
                  [ngClass]="{ 'is-invalid': submitted && f.AcConductor.errors }">
                    <option value="0" selected>Select Option</option>  
                    <!-- <option *ngFor="let value of AcConductorList" [selected]="value=== AcValue"> {{value}}</option> -->
                    <option value="1-phase" [selected]="f.AcConductor?.value=== AcValue" >1-phase</option>
                    <option value="2-wire (LN)" [selected]="f.AcConductor?.value=== AcValue" >2-wire (LN)</option>
                    <option value="1-phase" [selected]="f.AcConductor?.value=== AcValue" >1-phase</option>
                    <option value="3-wire (LLM)" [selected]="f.AcConductor?.value=== AcValue"  >3-wire (LLM)</option>
                    <option value="2-phase" [selected]="f.AcConductor?.value=== AcValue" >2-phase</option>
                    <option value="3-wire (LLN)" [selected]="f.AcConductor?.value=== AcValue" >3-wire (LLN)</option>
                    <option value="3-phase" [selected]="f.AcConductor?.value=== AcValue" >3-phase</option>
                    <option value="3-wire (LLL)" [selected]="f.AcConductor?.value=== AcValue" >3-wire (LLL)</option>
                    <option value="3-phase" [selected]="f.AcConductor?.value=== DcValue" >3-phase</option>
                    <option value="4-wire (LLLN)" [selected]="f.AcConductor?.value=== AcValue" >4-wire (LLLN)</option>
                  </select>
                  <div *ngIf="submitted && f.AcConductor.errors" class="invalid-feedback">
                    <div *ngIf="f.AcConductor?.errors?.required">AC conductor type is required</div>
                  </div>
              </div>

              <div class="col-md-4" *ngIf="enableDC">
                  <label>DC:</label>
                  <select class="form-control" formControlName="DcConductor" [(ngModel)]="supplycharesteristic.liveConductorDC" 
                  [ngClass]="{ 'is-invalid': submitted && f.DcConductor.errors }">
                    <option value="0" selected>Select Option</option>
                    <!-- <option *ngFor="let value of liveConductorDCList" [selected]="value=== DcValue"> {{value}}</option> -->
                    <option value="2-pole" [selected]="f.DcConductor?.value=== DcValue" >2-pole</option>
                    <option value="3-pole" [selected]="f.DcConductor?.value=== DcValue" >3-pole</option>
                    <option value="Others" [selected]=" f.DcConductor?.value=== DcValue">Others</option> 
                  </select>
                  <div *ngIf="submitted && f.DcConductor.errors" class="invalid-feedback">
                    <div *ngIf="f.DcConductor?.errors?.required">DC conductor type is required</div>
                  </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-4">
              <mat-form-field class="client-description " >
                <mat-label>
                  <h3>Brief Note (in case of confusion)</h3>
                </mat-label>
                <textarea matInput class="client-box-description" formControlName="briefNote" [ngClass]="{ 'is-invalid': submitted && f.briefNote.errors }" [(ngModel)]="supplycharesteristic.systemEarthingBNote" maxlength="500" placeholder="Ex. Brief Note ..." ></textarea>
              </mat-form-field>
              <div *ngIf="submitted && f.briefNote.errors" class="invalid-feedback">
                <div *ngIf="f.briefNote?.errors?.required">Field Is Required</div>
              </div>
            </div>
          </div>

          <div class="row" *ngIf="tableAC">
            <div class="col" >
              <h2>Applicable for AC: (Note: Please mention NA if any column is not applicable)</h2>
                <div class="table-responsive">
                  <table class="table">
                    <thead>
                      <tr align="center">
                        <th>Nature of supply parameters</th>
                        <th>L1-L2</th>
                        <th>L2-L3</th>
                        <th>L1-L3</th>
                        <th>L1-N</th>
                        <th>L2-N</th>
                        <th>L3-N</th>
                        <th>L1-PE</th>
                        <th>L2-PE</th>
                        <th>L3-PE</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td nowrap="nowrap">Nominal voltage U/U0 (V)</td>
                        <td><input type="number" min="0" style="width:50px" formControlName="NV1" [(ngModel)]="NV1"></td>
                        <td><input type="number" min="0"   style="width:50px" formControlName="NV2" [(ngModel)]="NV2"></td>
                        <td><input type="number" min="0"  style="width:50px" formControlName="NV3" [(ngModel)]="NV3"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="NV4" [(ngModel)]="NV4"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="NV5" [(ngModel)]="NV5"></td>
                        <td><input type="number" min="0"  style="width:50px" formControlName="NV6" [(ngModel)]="NV6"></td>
                        <td><input type="number" min="0"   style="width:50px" formControlName="NV7" [(ngModel)]="NV7"></td>
                        <td><input type="number" min="0"  style="width:50px" formControlName="NV8" [(ngModel)]="NV8"></td>
                        <td><input type="number" min="0"  style="width:50px" formControlName="NV9" [(ngModel)]="NV9"></td>
                      </tr>
                      <tr>
                        <td nowrap="nowrap">Nominal Frequency f (HZ)</td>
                        <td><input type="number" min="0"  style="width:50px" formControlName="NF1" [(ngModel)]="NF1"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="NF2" [(ngModel)]="NF2"></td>
                        <td><input type="number" min="0"  style="width:50px" formControlName="NF3" [(ngModel)]="NF3"></td>
                        <td><input type="number" min="0"  style="width:50px" formControlName="NF4" [(ngModel)]="NF4"></td>
                        <td><input type="number" min="0"  style="width:50px" formControlName="NF5" [(ngModel)]="NF5"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="NF6" [(ngModel)]="NF6"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="NF7" [(ngModel)]="NF7"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="NF8" [(ngModel)]="NF8"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="NF9" [(ngModel)]="NF9"></td>
                      </tr>
                      <tr>
                        <td nowrap="nowrap">Prospective fault current Ipfc (kA) </td>
                        <td><input type="number" min="0"  style="width:50px" formControlName="PF1" [(ngModel)]="PF1"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="PF2" [(ngModel)]="PF2"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="PF3" [(ngModel)]="PF3"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="PF4" [(ngModel)]="PF4"></td>
                        <td><input type="number" min="0"  style="width:50px" formControlName="PF5" [(ngModel)]="PF5"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="PF6" [(ngModel)]="PF6"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="PF7" [(ngModel)]="PF7"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="PF8" [(ngModel)]="PF8"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="PF9" [(ngModel)]="PF9"></td>
                      </tr>

                      <tr>
                        <td nowrap="nowrap">External Loop Impedance Ze (Ω)</td>
                        <td><input type="number" min="0" style="width:50px" formControlName="EL1" [(ngModel)]="EL1"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="EL2" [(ngModel)]="EL2" ></td>
                        <td><input type="number" min="0"  style="width:50px" formControlName="EL3" [(ngModel)]="EL3"></td>
                        <td><input type="number" min="0"   style="width:50px" formControlName="EL4" [(ngModel)]="EL4"></td>
                        <td><input type="number" min="0"  style="width:50px" formControlName="EL5" [(ngModel)]="EL5"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="EL6" [(ngModel)]="EL6"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="EL7" [(ngModel)]="EL7"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="EL8" [(ngModel)]="EL8"></td>
                        <td><input type="number" min="0" style="width:50px" formControlName="EL9" [(ngModel)]="EL9"></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
            </div>
          </div>


          <div class="row" style="margin-top: 50px;">
            <div class="col-sm-12">
              <h2>Incoming (Supply) Protective Device Characteristics:</h2>
              <table  class="table">
                <tr>
                  <td nowrap="nowrap">Type Of Over Current Protective Device</td>
                  <td> 
                  <input type="text"  style="width:200px" formControlName="mainNominalProtectiveDevice" 
                  [(ngModel)]="supplycharesteristic.mainNominalProtectiveDevice" [ngClass]="{ 'is-invalid': submitted && f.mainNominalProtectiveDevice.errors }">
                  <div *ngIf="submitted && f.mainNominalProtectiveDevice.errors" class="invalid-feedback">
                    <div *ngIf="f.mainNominalProtectiveDevice?.errors?.required">Field Is Required</div>
                  </div>
                </td>
              </tr>
                <tr>
                  <td nowrap="nowrap">Rated current (A)</td>
                  <td>
                    <input type="number" min="0" maxlength="4"style="width:200px" formControlName="mainRatedCurrent" 
                    [(ngModel)]="supplycharesteristic.mainRatedCurrent" 
                    [ngClass]="{ 'is-invalid': submitted && f.mainRatedCurrent.errors }">
                    <div *ngIf="submitted && f.mainRatedCurrent.errors" class="invalid-feedback">
                      <div *ngIf="f.mainRatedCurrent?.errors?.required">Field Is Required</div>
                    </div>
                  </td>
              </tr>
                <tr>
                  <td nowrap="nowrap">Current for Disconnection With in 0.2 seconds</td>
                  <td>
                    <input type="number"   min="0" maxlength="5" style="width:200px" max="5" formControlName="mainCurrentDisconnection" [(ngModel)]="supplycharesteristic.mainCurrentDisconnection" [ngClass]="{ 'is-invalid': submitted && f.mainCurrentDisconnection.errors }">
                    <div *ngIf="submitted && f.mainCurrentDisconnection.errors" class="invalid-feedback">
                      <div *ngIf="f.mainCurrentDisconnection?.errors?.required">Field Is Required</div>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
          </div>

          <div class="row">
            <div class="col-md-4">
              <mat-form-field class="client-description " >
                <mat-label>
                  <h3>Brief note</h3>
                </mat-label>
                <textarea matInput class="client-box-description" formControlName="liveConductorBNote" [ngClass]="{ 'is-invalid': submitted && f.liveConductorBNote.errors }" [(ngModel)]="supplycharesteristic.liveConductorBNote" maxlength="500" placeholder="Ex. Brief Note ..." ></textarea>
              </mat-form-field>
              <div *ngIf="submitted && f.liveConductorBNote.errors" class="invalid-feedback">
                <div *ngIf="f.liveConductorBNote?.errors?.required">Field Is Required</div>
              </div>
            </div>
          </div>



        </mat-expansion-panel>

        <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <h3>Alternative Source of Supply</h3>
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="row">
              <div class="col-md-4">
                <div class="form-group">
                  <label> Availability of Alternate Supply:</label>
                  <select class="form-control" formControlName="alternativeSupply" 
                  (change)="showAlternateField($event)" [ngClass]="{ 'is-invalid': submitted && f.alternativeSupply.errors }" 
                  [(ngModel)]="supplycharesteristic.alternativeSupply">
                  <option value="0" selected>Select Option</option>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                  </select>
                  <div *ngIf="submitted && f.alternativeSupply.errors" class="invalid-feedback">
                    <div *ngIf="f.alternativeSupply?.errors?.required">Field Is Required</div>
                  </div>
                </div>
              </div>

              <div class="col-md-4" *ngIf="alternativeSupplyNo">
                <label>Number of Alternate Sources of Supply:</label>
                <input type="tel" min="0"  class="form-control" formControlName="supplyNumber"
                [ngClass]="{ 'is-invalid': submitted && f.supplyNumber.errors }" 
                [(ngModel)]="supplycharesteristic.supplyNumber"
                (keyup)="onKeyAlernate($event)">

                <!-- <p class="joints">Number of Alternate Sources of Supply: 
                  <input type="tel" min="0" formControlName="supplyNumber" 
                  [ngClass]="{ 'is-invalid': submitted && f.supplyNumber.errors }" 
                  [value]="supplycharesteristic.supplyNumber" [(ngModel)]="supplycharesteristic.supplyNumber" style="
                  width: 50px;
                  background: transparent;
                  border: none;
                  border-bottom: 1px solid #000000;" (keyup)="onKeyAlernate($event)"></p> -->
                <div *ngIf="submitted && f.supplyNumber.errors" class="invalid-feedback">
                  <div *ngIf="f.supplyNumber?.errors?.required">Supply number is required</div>
                </div>
              </div>
            </div>

            <div *ngIf="sources">
              <div formArrayName="alternateArr" *ngFor="let a of getLocation4Controls(); let i = index">
                <h2>Alternate Form :</h2>
                <div class="form-group" [formGroupName]="i">
                  <div class="row">

                    <div class="col-md-4">
                      <label>Alternate supply no:</label>
                      <input type="number"   min="0" class="form-control"  formControlName="aLSupplyNo" [ngClass]="{ 'is-invalid': submitted && a.get('aLSupplyNo')?.errors }">
                      <div *ngIf="submitted && a.get('aLSupplyNo')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('aLSupplyNo')?.errors?.required">Field Is Required</div>
                      </div>
                    </div>

                    <div class="col-md-4">
                      <label>Short Name of Alternate Supply:</label>
                      <input type="text"  maxlength="50" class="form-control"  formControlName="aLSupplyShortName" [ngClass]="{ 'is-invalid': submitted && a.get('aLSupplyShortName')?.errors }">
                      <div *ngIf="submitted && a.get('aLSupplyShortName')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('aLSupplyShortName')?.errors?.required">Field Is Required</div>
                      </div>
                    </div>

                    <div class="col-md-4">
                      <label>System Earthing:</label>
                      <select class="form-control" formControlName="aLSystemEarthing" [ngClass]="{ 'is-invalid': submitted && a.get('aLSystemEarthing')?.errors }">
                        <option value="0" selected>Select Option</option>
                        <option *ngFor="let value of systemEarthingList" [selected]="value=== a.get('aLSystemEarthing')?.value"> {{value}}</option>
                      </select>
                      <div *ngIf="submitted && a.get('aLSystemEarthing')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('aLSystemEarthing')?.errors?.required">Field Is Required</div>
                      </div>
                    </div>

                    <div class="col-md-4">
                        <label>Number and Type Of Live Conductors: </label>
                        <select class="form-control"  formControlName="aLLiveConductorType" (change)=showValue($event,i) [ngClass]="{ 'is-invalid': submitted && a.get('aLLiveConductorType')?.errors }">
                          <option value="0" selected>Select Option</option>
                          <option value="AC">AC</option>
                          <option value="DC" disabled style="cursor: not-allowed;">DC</option>
                        </select>
                        <div *ngIf="submitted && a.get('aLLiveConductorType')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('aLLiveConductorType')?.errors?.required">Field Is Required</div>
                        </div>
                    </div>

                    <div class="col-md-4" *ngIf="a.get('aLLiveConductorType')?.value=='AC'">
                        <label>AC:</label>
                        <select class="form-control" formControlName="aLLiveConductorAC" [ngClass]="{ 'is-invalid': submitted && a.get('aLLiveConductorAC')?.errors }">
                          <option value="0" selected>Select Option</option>
                          <option value="1-phase, 3-wire (LLM)">1-phase, 2-wire (LN)</option>
                          <option value="1-phase, 3-wire (LLM)">1-phase, 3-wire (LLM)</option>
                          <option value="2-phase, 3-wire (LLN)">2-phase, 3-wire (LLN)</option>
                          <option value="3-phase, 3-wire (LLL)">3-phase, 3-wire (LLL)</option>
                          <option value="3-phase, 4-wire (LLLN)">3-phase, 4-wire (LLLN)</option>
                        </select>
                        <div *ngIf="submitted && a.get('aLLiveConductorAC')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('aLLiveConductorAC')?.errors?.required">Field Is Required</div>
                        </div>
                    </div>

                    <div class="col-md-4" *ngIf="a.get('aLLiveConductorType')?.value=='DC'">
                        <label>DC:</label>
                        <select class="form-control" formControlName="aLLiveConductorDC" [ngClass]="{ 'is-invalid': submitted && a.get('aLLiveConductorDC')?.errors }">
                          <option selected="selected" value="2-pole">2-pole </option>
                          <option value=" 3-pole"> 3-pole</option>
                          <option value="Others">Others</option>
                        </select>
                        <div *ngIf="submitted && a.get('aLLiveConductorDC')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('aLLiveConductorDC')?.errors?.required">Field Is Required</div>
                        </div>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-md-4">
                      <mat-form-field class="client-description">
                        <mat-label>
                          <h3>Brief Note (in case of confusion)</h3>
                        </mat-label>
                        <textarea matInput class="client-box-description" formControlName="aLSystemEarthingBNote" [ngClass]="{ 'is-invalid': submitted && a.get('aLSystemEarthingBNote')?.errors }" maxlength="500" placeholder="Ex. Brief Note ..." ></textarea>
                      </mat-form-field>
                      <div *ngIf="submitted && a.get('aLSystemEarthingBNote')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('aLSystemEarthingBNote')?.errors?.required">Field Is Required</div>
                      </div>
                    </div>
                  </div>


                  <div class="row" *ngIf="a.get('aLLiveConductorType')?.value=='AC'">
                    <div class="col">
                      <h2>Applicable for AC: (Note: Please mention NA if any column is not applicable)</h2>
                      <div class="table-responsive">
                        <table  class="table" formArrayName="nominalVoltageArr1" *ngFor="let row of getTableArray(a); let j = index">
                          <thead>
                              <tr align="center">
                                <th>Nature of supply parameters</th>
                                <th>L1-L2</th>
                                <th>L2-L3</th>
                                <th>L1-L3</th>
                                <th>L1-N</th>
                                <th>L2-N</th>
                                <th>L3-N</th>
                                <th>L1-PE</th>
                                <th>L2-PE</th>
                                <th>L3-PE</th>
                              </tr>
                          </thead>
                          <tbody [formGroupName]="j">
                              <tr>
                                <td nowrap="nowrap">Nominal Voltage U/U0 (V)</td>
                                <td><input type="number" min="0" formControlName="nominalVoltage1"  style="width:70px"></td>
                                <td><input type="number" min="0" formControlName="nominalVoltage2"  style="width:70px"></td>
                                <td><input type="number" min="0"  formControlName="nominalVoltage3" style="width:70px"></td>
                                <td><input type="number" min="0" formControlName="nominalVoltage4" style="width:70px"></td>
                                <td><input type="number" min="0" formControlName="nominalVoltage5" style="width:70px"></td>
                                <td><input type="number" min="0" formControlName="nominalVoltage6" style="width:70px"></td>
                                <td><input type="number" min="0"  formControlName="nominalVoltage7" style="width:70px"></td>
                                <td><input type="number" min="0" formControlName="nominalVoltage8" style="width:70px"></td>
                                <td><input type="number" min="0" formControlName="nominalVoltage9" style="width:70px"></td>

                              </tr>
                              <tr>
                                <td nowrap="nowrap">Nominal Frequency f (HZ)</td>
                                <td><input type="number" min="0"   formControlName="nominalFrequency1" style="width:70px"></td>
                                <td><input type="number" min="0" formControlName="nominalFrequency2" style="width:70px"></td>
                                <td><input type="number" min="0"  formControlName="nominalFrequency3" style="width:70px"></td>
                                <td><input type="number" min="0" formControlName="nominalFrequency4" style="width:70px"></td>
                                <td><input type="number" min="0"  formControlName="nominalFrequency5" style="width:70px"></td>
                                <td><input type="number" min="0" formControlName="nominalFrequency6" style="width:70px"></td>
                                <td><input type="number" min="0" formControlName="nominalFrequency7" style="width:70px"></td>
                                <td><input type="number" min="0"  formControlName="nominalFrequency8" style="width:70px"></td>
                                <td><input type="number" min="0" formControlName="nominalFrequency9" style="width:70px"></td>
                              </tr>
                              <tr>
                                <td nowrap="nowrap">Prospective Fault Current Ipfc (kA) </td>
                                <td><input type="number" min="0"  formControlName="current1" style="width:70px"></td>
                                <td><input type="number" min="0"  formControlName="current2" style="width:70px"></td>
                                <td><input type="number" min="0" formControlName="current3" style="width:70px"></td>
                                <td><input type="number" min="0"  formControlName="current4" style="width:70px"></td>
                                <td><input type="number" min="0" formControlName="current5" style="width:70px"></td>
                                <td><input type="number" min="0"  formControlName="current6" style="width:70px"></td>
                                <td><input type="number" min="0"  formControlName="current7" style="width:70px"></td>
                                <td><input type="number" min="0" formControlName="current8" style="width:70px"></td>
                                <td><input type="number" min="0" formControlName="current9" style="width:70px"></td>

                              </tr>
                              <tr>
                                <td nowrap="nowrap">External Loop Impedance Ze (Ω)</td>
                                <td><input type="number" min="0"  formControlName="impedence1" style="width:70px"></td>
                                <td><input type="number" min="0"  formControlName="impedence2" style="width:70px"></td>
                                <td><input type="number" min="0" formControlName="impedence3" style="width:70px"></td>
                                <td><input type="number" min="0"   formControlName="impedence4" style="width:70px"></td>
                                <td><input type="number" min="0" formControlName="impedence5" style="width:70px"></td>
                                <td><input type="number" min="0"  formControlName="impedence6" style="width:70px"></td>
                                <td><input type="number" min="0"  formControlName="impedence7" style="width:70px"></td>
                                <td><input type="number" min="0"  formControlName="impedence8" style="width:70px"></td>
                                <td><input type="number" min="0" formControlName="impedence9" style="width:70px"></td>

                              </tr>
                                <tr><td >Installed Capacity (kVA)</td>
                                  <td colspan="9"><input type="number" min="0" formControlName="capacity" style="width: 950px"></td>
                                </tr>
                                <tr>
                                  <td >Actual Load Current (R,Y,B, N)</td>
                                  <td colspan="2"><input type="number" min="0" formControlName="loadCurrent1" style="width:206px"></td>
                                  <td colspan="2"><input type="number" min="0" formControlName="loadCurrent2" style="width:206px"></td>
                                  <td colspan="3"><input type="number" min="0" formControlName="loadCurrent3" style="width:206px"></td>
                                  <td colspan="2"><input type="number" min="0" formControlName="loadCurrent4"  style="width:206px"></td>

                                </tr>

                          </tbody>
                          </table>
                      </div>
                    </div>
                  </div>


                  <div class="row" style="margin-top: 50px;">
                    <div class="col">
                      <h2>Incoming (Supply) Protective Device Characteristics:</h2>
                      <table  class="table">

                          <tr>
                            <td nowrap="nowrap">Type Of Over Current Protective Device</td>
                            <td>
                              <input type="text"  style="width:400px" formControlName="protectiveDevice" 
                              [ngClass]="{ 'is-invalid': submitted && a.get('protectiveDevice')?.errors }">
                              <div *ngIf="submitted && a.get('protectiveDevice')?.errors" class="invalid-feedback">
                                <div *ngIf="a.get('protectiveDevice')?.errors?.required">Field Is Required</div>
                              </div>
                            </td>
                          </tr>
                          <tr>
                              <td nowrap="nowrap">Rated current (A)</td>
                              <td>
                                <input type="number" min="0" formControlName="ratedCurrent" min="0" 
                                [ngClass]="{ 'is-invalid': submitted && a.get('ratedCurrent')?.errors }" style="width:400px">
                                <div *ngIf="submitted && a.get('ratedCurrent')?.errors" class="invalid-feedback">
                                  <div *ngIf="a.get('ratedCurrent')?.errors?.required">Field Is Required</div>
                                </div>
                              </td>
                          </tr>
                          <tr>
                            <td nowrap="nowrap">Current for Disconnection with in 0.2 seconds</td>
                            <td>
                              <input type="number" min="0" formControlName="currentDissconnection" [ngClass]="{ 'is-invalid': submitted && a.get('currentDissconnection')?.errors }" style="width:400px">
                              <div *ngIf="submitted && a.get('currentDissconnection')?.errors" class="invalid-feedback">
                                <div *ngIf="a.get('currentDissconnection')?.errors?.required">Field Is Required</div>
                              </div>
                            </td>
                          </tr>
                      </table>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-md-4">
                      <mat-form-field class="client-description">
                        <mat-label>
                          <h3>Brief Note (in case of confusion)</h3>
                        </mat-label>
                        <textarea matInput class="client-box-description" formControlName="aLLiveConductorBNote" [ngClass]="{ 'is-invalid': submitted && a.get('aLLiveConductorBNote')?.errors }" maxlength="500" placeholder="Ex. Brief Note ..." ></textarea>
                        <div *ngIf="submitted && a.get('aLLiveConductorBNote')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('aLLiveConductorBNote')?.errors?.required">Field Is Required</div>
                        </div>
                      </mat-form-field>
                    </div>
                  </div>

                </div>
              </div>
            </div>

        </mat-expansion-panel>
            <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h3>Particulars Of Installation Referred in the Report</h3>
                </mat-panel-title>
              </mat-expansion-panel-header>
              <div class="row">
                <div class="col-md-4" style="margin-top: 30px">
                  <p>Maximum Demand <input type="number" min="0" formControlName="maximumDemand"   
                  [ngClass]="{ 'is-invalid': submitted && f.maximumDemand.errors }"[(ngModel)]="supplycharesteristic.maximumDemand" style="
                    width: 50px;
                    background: transparent;
                    border: none;
                    border-bottom: 1px solid #000000;"> KvA</p>
                    <div *ngIf="submitted && f.maximumDemand.errors" class="invalid-feedback">
                      <div *ngIf="f.maximumDemand?.errors?.required">Maximum Demand is Required</div>
                    </div>
                </div>

                <div class="col-md-4" style="margin-top: 30px">
                  <p>Maximum Load<input type="number" min="0" formControlName="maximumLoad" 
                  [ngClass]="{ 'is-invalid': submitted && f.maximumLoad.errors }" [(ngModel)]="supplycharesteristic.maximumLoad" style="
                    width: 50px;
                    background: transparent;
                    border: none;
                    border-bottom: 1px solid #000000;"> Amps</p>
                    <div *ngIf="submitted && f.maximumLoad.errors" class="invalid-feedback">
                      <div *ngIf="f.maximumLoad?.errors?.required">Maximum load is required</div>
                    </div>
                </div>

                <div class="col-md-4" >
                  <label>Means Of Earthing :</label>
                  <select class="form-control" formControlName="meansEarthing" 
                  [ngClass]="{ 'is-invalid': submitted && f.meansEarthing.errors }" [(ngModel)]="supplycharesteristic.meansEarthing" >
                    <option value="0" selected>Select Option</option>
                    <option *ngFor="let value of MeansofEarthingList"> {{value}}</option>
                  </select>
                  <div *ngIf="submitted && f.meansEarthing.errors" class="invalid-feedback">
                    <div *ngIf="f.meansEarthing?.errors?.required">Field Is Required</div>
                  </div>
                </div>
              </div>

              <div class="row" style="margin-top: 30px">

                <div class="col-md-4">
                  <label>Type Of Earth Electrode :</label>
                  <select class="form-control" formControlName="electrodeType" 
                  [ngClass]="{ 'is-invalid': submitted && f.electrodeType.errors }" [(ngModel)]="supplycharesteristic.electrodeType">
                    <option value="0" selected>Select Option</option>
                    <option *ngFor="let value of  electrodeTypeList"> {{value}}</option>
                  </select>
                  <div *ngIf="submitted && f.electrodeType.errors" class="invalid-feedback">
                    <div *ngIf="f.electrodeType?.errors?.required">Field Is Required</div>
                  </div>
                </div>

                <div class="col-md-4">
                  <label>Material Of Earth Electrode:</label>
                  <select class="form-control" formControlName="electrodeMaterial" 
                  [ngClass]="{ 'is-invalid': submitted && f.electrodeMaterial.errors }" 
                  [(ngModel)]="supplycharesteristic.electrodeMaterial">
                    <option value="0" selected>Select Option</option>
                    <option *ngFor="let value of  electrodeMaterialList"> {{value}}</option>
                  </select>
                  <div *ngIf="submitted && f.electrodeMaterial.errors" class="invalid-feedback">
                    <div *ngIf="f.electrodeMaterial?.errors?.required">Field Is Required</div>
                  </div>
                </div>

                <div class="col-md-4" style="margin-top: 30px">
                  <p class="joints">Number Of Locations 
                    <input type="tel" min="1" formControlName="noOfLocation" 
                    [ngClass]="{ 'is-invalid': submitted && f.noOfLocation.errors }" 
                    [(ngModel)]="supplycharesteristic.noOfLocation" style="
                    width: 50px;
                    background: transparent;
                    border: none;
                    border-bottom: 1px solid #000000;" (keyup)="onKey1($event)"></p>
                    <div *ngIf="submitted && f.noOfLocation.errors" class="invalid-feedback">
                      <div *ngIf="f.noOfLocation?.errors?.required">Location number is required</div>
                      <div *ngIf="f.noOfLocation?.errors?.min">Please enter value above 0</div>
                    </div>
                </div>
              </div>
            <br>
              <div class="row">
                <div class="col-sm-12">
                  <h2>Number Of Locations</h2>
                </div>
                <!-- <mat-icon class="mousechange" (click)="addLocation1()" style=" padding-top: 5px;">add_box</mat-icon> -->
              </div>


              <div class="row">
                <div class="col-md-3">
                  <label style="text-align: center;">Location Number</label>
                </div>
                <div class="col-md-3">
                  <label style="text-align: center;">Location Name</label>
                </div>
                <div class="col-md-3">
                  <label style="text-align: center;">Electrode Resistance to Earth in (Ω)</label>
                </div>
                <div class="col-md-3">
                  <label style="text-align: center;">Electrode Resistance to Grid (Ω)</label>
                </div>
              </div>

              <div formArrayName="location1Arr" *ngFor="let a of getLocation1Controls(); let i = index">
                <div class="form-group" [formGroupName]="i">
                  <div class="row">
                    <div class="col-md-3">
                      <input type="number" min=1  formControlName="locationNo" class="form-control"  
                      [ngClass]="{ 'is-invalid': submitted && a.get('locationNo')?.errors }" placeholder="Enter location number" >
                      <div *ngIf="submitted && a.get('locationNo')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('locationNo')?.errors?.required">Location number is required</div>
                      </div>
                    </div>

                    <div class="col-md-3">
                      <input type="text"  formControlName="locationName" class="form-control"  [ngClass]="{ 'is-invalid': submitted && a.get('locationName')?.errors }" placeholder="Enter location name" >
                      <div *ngIf="submitted && a.get('locationName')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('locationName')?.errors?.required">Location name is required</div>
                      </div>
                    </div>

                    <div class="col-md-3">
                      <input type="number" min="0"  formControlName="electrodeResistanceEarth" class="form-control"  [ngClass]="{ 'is-invalid': submitted && a.get('electrodeResistanceEarth')?.errors }" placeholder="Enter electrode resistance" >
                      <div *ngIf="submitted && a.get('electrodeResistanceEarth')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('electrodeResistanceEarth')?.errors?.required">Field Is Required</div>
                      </div>
                    </div>

                    <div class="col-md-3">
                      <input type="number" min="0"  formControlName="electrodeResistanceGird" class="form-control"  [ngClass]="{ 'is-invalid': submitted && a.get('electrodeResistanceGird')?.errors }" placeholder="Enter electrode resistance" >
                      <div *ngIf="submitted && a.get('electrodeResistanceGird')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('electrodeResistanceGird')?.errors?.required">Field Is Required</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </mat-expansion-panel>

            <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h3>Details Of Main Protective Conductor</h3>
                </mat-panel-title>
              </mat-expansion-panel-header>

              <div class="form-group">
                <div class="row">
                  <div class="col-md-4" style="margin-top: 57px">
                    <p>Size of Earthing Conductor <input type="number" min="0" formControlName="conductorSize" 
                    [ngClass]="{ 'is-invalid': submitted && f.conductorSize.errors }" [(ngModel)]="supplycharesteristic.conductorSize" style="
                      width: 50px;
                      background: transparent;
                      border: none;
                      border-bottom: 1px solid #000000;"> sq.mm</p>
                      <div *ngIf="submitted && f.conductorSize.errors" class="invalid-feedback">
                        <div *ngIf="f.conductorSize?.errors?.required">Field Is Required</div>
                      </div>
                  </div>

                  <div class="col-md-4">
                    <label>Material Of Earthing Conductor:</label>
                    <input type="text"  class="form-control" formControlName="conductormaterial" 
                    [ngClass]="{ 'is-invalid': submitted && f.conductormaterial.errors }" [(ngModel)]="supplycharesteristic.conductormaterial">
                    <div *ngIf="submitted && f.conductormaterial.errors" class="invalid-feedback">
                      <div *ngIf="f.conductormaterial?.errors?.required">Field Is Required</div>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <label>Earthing Conductor Continuity and Connection Verified:</label>

                    <select class="form-control" formControlName="conductorVerify" [ngClass]="{ 'is-invalid': submitted && f.conductorVerify.errors }" [(ngModel)]="supplycharesteristic.conductorVerify">
                      <option value="0" selected>Select Option</option>
                      <option *ngFor="let value of  earthingConductorVerifyList"> {{value}}</option>
                    </select>
                    <div *ngIf="submitted && f.conductorVerify.errors" class="invalid-feedback">
                      <div *ngIf="f.conductorVerify?.errors?.required">Field Is Required</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <div class="row">
                  <div class="col-md-4" style="margin-top: 30px">
                    <p>Size of Main Protective Bonding Conductor <input type="number" min="0" formControlName="bondingConductorSize" 
                    [ngClass]="{ 'is-invalid': submitted && f.bondingConductorSize.errors }" [(ngModel)]="supplycharesteristic.bondingConductorSize" style="
                      width: 50px;
                      background: transparent;
                      border: none;
                      border-bottom: 1px solid #000000;"> sq.mm</p>
                      <div *ngIf="submitted && f.bondingConductorSize.errors" class="invalid-feedback">
                        <div *ngIf="f.bondingConductorSize?.errors?.required">Field Is Required</div>
                      </div>
                  </div>

                  <div class="col-md-4">
                    <label>Material Of Main Protective Bonding Conductor:</label>
                    <input type="text"  class="form-control" formControlName="bondingConductorMaterial" 
                    [ngClass]="{ 'is-invalid': submitted && f.bondingConductorMaterial.errors }" [(ngModel)]="supplycharesteristic.bondingConductorMaterial">
                    <div *ngIf="submitted && f.bondingConductorMaterial.errors" class="invalid-feedback">
                      <div *ngIf="f.bondingConductorMaterial?.errors?.required">Field Is Required</div>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <label>Main Protective Bonding Conductor Continuity And Connection Verified:</label>
                    <select class="form-control" formControlName="bondingConductorVerify" 
                    [ngClass]="{ 'is-invalid': submitted && f.bondingConductorVerify.errors }" [(ngModel)]="supplycharesteristic.bondingConductorVerify">
                      <option value="0" selected>Select Option</option>
                      <option *ngFor="let value of bondingConductorVerifyList"> {{value}}</option>
                    </select>
                    <div *ngIf="submitted && f.bondingConductorVerify.errors" class="invalid-feedback">
                      <div *ngIf="f.bondingConductorVerify?.errors?.required">Field Is Required</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <div class="row">
                  <div class="col-md-4" style="margin-top: 30px">
                    <p>Type Of Joints (Impairing Safety) <input type="number" min="1" formControlName="bondingJointsType" 
                    [ngClass]="{ 'is-invalid': submitted && f.bondingJointsType.errors }" [(ngModel)]="supplycharesteristic.bondingJointsType" style="
                      width: 50px;
                      background: transparent;
                      border: none;
                      border-bottom: 1px solid #000000;">
                    </p>
                    <div *ngIf="submitted && f.bondingJointsType.errors" class="invalid-feedback">
                      <div *ngIf="f.bondingJointsType?.errors?.required">Field Is Required</div>
                    </div>
                  </div>
                  <div class="col-md-4" style="margin-top: 30px">
                    <p  class="joints">No Of Joints
                      <input type="tel" min="1" formControlName="bondingNoOfJoints" [(ngModel)]="supplycharesteristic.bondingNoOfJoints" [ngClass]="{ 'is-invalid': submitted && f.bondingNoOfJoints.errors }" style="
                      width: 50px;
                      background: transparent;
                      border: none;
                      border-bottom: 1px solid #000000;" (keyup)="onKey($event)"
                      ></p>
                      <div *ngIf="submitted && f.bondingNoOfJoints.errors" class="invalid-feedback">
                        <div *ngIf="f.bondingNoOfJoints?.errors?.required">Number of joints is required</div>
                        <div *ngIf="f.bondingNoOfJoints?.errors?.min">Please enter value above 0</div>
                      </div>
                  </div>
                  <!-- (blur)="update(box.value)" (keyup)="onKey($event)"-->
                </div>
              </div>

              <div class="row">
                <div class="col-sm-12">
                <h2>Location Table</h2>
                <!-- <mat-icon class="mousechange" (click)="addLocation2()" style=" padding-top: 5px;">add_box</mat-icon> -->
              </div>
              </div>

              <div class="row">
                <div class="col-md-4">
                  <label style="text-align: center;">Location</label>
                </div>
                <div class="col-md-4">
                  <label style="text-align: center;">Joint No</label>
                </div>
                <div class="col-md-4">
                  <label style="text-align: center;">Joint Resistance (Ω)</label>
                </div>
              </div>

              <div formArrayName="location2Arr" *ngFor="let a of getLocation2Controls(); let i = index">
                <div class="form-group" [formGroupName]="i">
                  <div class="row">
                    <div class="col-md-4">
                      <input type="text"  formControlName="location" class="form-control"  
                      [ngClass]="{ 'is-invalid': submitted && a.get('location')?.errors }" placeholder="Enter location" >
                      <div *ngIf="submitted && a.get('location')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('location')?.errors?.required">Location is required</div>
                      </div>
                    </div>

                    <div class="col-md-4">
                      <input type="number" min="0"  formControlName="jointNo" class="form-control"  [ngClass]="{ 'is-invalid': submitted && a.get('jointNo')?.errors }" placeholder="Enter Joint No" >
                      <div *ngIf="submitted && a.get('jointNo')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('jointNo')?.errors?.required">Joint number is required</div>
                      </div>
                    </div>

                    <div class="col-md-4">
                      <input type="number" min="0"  formControlName="jointResistance" class="form-control"  [ngClass]="{ 'is-invalid': submitted && a.get('jointResistance')?.errors }" placeholder="Enter Joint resistance" >
                      <div *ngIf="submitted && a.get('jointResistance')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('jointResistance')?.errors?.required">Joint resistance is required</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <div class="row">
                  <div class="col-md-4" style="margin-top: 30px">
                    <p>Size of Main Protective Earthing Conductor<input type="number" min="0" formControlName="earthingConductorSize" 
                    [ngClass]="{ 'is-invalid': submitted && f.earthingConductorSize.errors }" [(ngModel)]="supplycharesteristic.earthingConductorSize" style="
                      width: 50px;
                      background: transparent;
                      border: none;
                      border-bottom: 1px solid #000000;"> Sq.mm</p>
                      <div *ngIf="submitted && f.earthingConductorSize.errors" class="invalid-feedback">
                        <div *ngIf="f.earthingConductorSize?.errors?.required">Field Is Required</div>
                      </div>
                  </div>

                  <div class="col-md-4">
                    <label>Material of Main Protective Earthing Conductor:</label>
                    <input type="text"  class="form-control" formControlName="earthingConductorMaterial"  
                    [ngClass]="{ 'is-invalid': submitted && f.earthingConductorMaterial.errors }" [(ngModel)]="supplycharesteristic.earthingConductorMaterial">
                    <div *ngIf="submitted && f.earthingConductorMaterial.errors" class="invalid-feedback">
                      <div *ngIf="f.earthingConductorMaterial?.errors?.required">Field Is Required</div>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <label>Main Protective Conductor Continuity and Connection Verified:</label>
                    <select class="form-control" formControlName="earthingConductorVerify" 
                    [ngClass]="{ 'is-invalid': submitted && f.earthingConductorVerify.errors }" [(ngModel)]="supplycharesteristic.earthingConductorVerify">
                      <option value="0" selected>Select Option</option>
                      <option *ngFor="let value of conductorVerifyList"> {{value}}</option>
                    </select>
                    <div *ngIf="submitted && f.earthingConductorVerify.errors" class="invalid-feedback">
                      <div *ngIf="f.earthingConductorVerify?.errors?.required">Field Is Required</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <div class="row">
                  <div class="col-md-4" style="margin-top: 30px">
                    <p>Type of Joints<input type="number" min="1" formControlName="earthingJointsType" [ngClass]="{ 'is-invalid': submitted && f.earthingJointsType.errors }" [(ngModel)]="supplycharesteristic.earthingJointsType" style="
                      width: 50px;
                      background: transparent;
                      border: none;
                      border-bottom: 1px solid #000000;">
                    </p>
                    <div *ngIf="submitted && f.earthingJointsType.errors" class="invalid-feedback">
                      <div *ngIf="f.earthingJointsType?.errors?.required">Field Is Required</div>
                    </div>
                  </div>

                  <div class="col-md-4" style="margin-top: 30px">
                    <p class="joints">No Of Joints <input type="tel" min="1" formControlName="earthingNoOfJoints" [ngClass]="{ 'is-invalid': submitted && f.earthingNoOfJoints.errors }" [(ngModel)]="supplycharesteristic.earthingNoOfJoints" style="
                      width: 50px;
                      background: transparent;
                      border: none;
                      border-bottom: 1px solid #000000;" (keyup)="onKey3($event)"></p>
                      <div *ngIf="submitted && f.earthingNoOfJoints.errors" class="invalid-feedback">
                        <div *ngIf="f.earthingNoOfJoints?.errors?.required">Field Is Required</div>
                        <div *ngIf="f.earthingNoOfJoints?.errors?.min">Please enter value above 0</div>
                      </div>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-sm-12">
                <h2>Location Table</h2>
                </div>
                <!-- <mat-icon class="mousechange" (click)="addLocation3()" style=" padding-top: 5px;">add_box</mat-icon> -->
              </div>

              <div class="row">
                <div class="col-md-4">
                  <label style="text-align: center;">Location</label>
                </div>
                <div class="col-md-4">
                  <label style="text-align: center;">Joint No</label>
                </div>
                <div class="col-md-4">
                  <label style="text-align: center;">Joint Resistance (Ω)</label>
                </div>
              </div>

              <div formArrayName="location3Arr" *ngFor="let a of getLocation3Controls(); let i = index">
                <div class="form-group" [formGroupName]="i">
                  <div class="row">
                    <div class="col-md-4">
                      <input type="text"  formControlName="location" class="form-control"  [ngClass]="{ 'is-invalid': submitted && a.get('location')?.errors }" placeholder="Enter location" >
                      <div *ngIf="submitted && a.get('location')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('location')?.errors?.required">Location is required</div>
                      </div>
                    </div>

                    <div class="col-md-4">
                      <input type="number" min="0"  formControlName="jointNo" class="form-control" [ngClass]="{ 'is-invalid': submitted && a.get('jointNo')?.errors }" placeholder="Enter Joint No" >
                      <div *ngIf="submitted && a.get('jointNo')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('jointNo')?.errors?.required">Joint number is required</div>
                      </div>
                    </div>

                    <div class="col-md-4">
                      <input type="number" min="0"  formControlName="jointResistance" class="form-control" [ngClass]="{ 'is-invalid': submitted && a.get('jointResistance')?.errors }" placeholder="Enter Joint resistance" >
                      <div *ngIf="submitted && a.get('jointResistance')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('jointResistance')?.errors?.required">Field Is Required</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </mat-expansion-panel>

                <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false" *ngIf="breaker">
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      <h3>Details Of Main Switch or Circuit Breaker</h3>
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <div formArrayName="circuitArr" *ngFor="let a of getCircuitControls(); let i = index">
                    <div class="form-group" [formGroupName]="i">
                      <h2>Details Of Circuit Breaker</h2>
                      <div class="row">
                        <div class="col-md-4">
                          <label>Location:</label>
                          <input type="text"  formControlName="location" class="form-control"  [ngClass]="{ 'is-invalid': submitted && a.get('location')?.errors }" placeholder="Enter Location" >
                          <div *ngIf="submitted && a.get('location')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('location')?.errors?.required">Location is required</div>
                          </div>
                        </div>

                        <div class="col-md-4">
                          <label>Type:</label>
                          <select class="form-control" formControlName="type" [ngClass]="{ 'is-invalid': submitted && a.get('type')?.errors }">
                            <option value="0" selected>Select Option</option>
                            <option value="MCB">MCB</option>
                            <option value=" ACB"> ACB</option>
                            <option value="MCCB">MCCB</option>
                            <option value="RCBO">RCBO</option>
                          </select>
                          <div *ngIf="submitted && a.get('type')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('type')?.errors?.required">Field Is Required</div>
                          </div>
                        </div>

                        <div class="col-md-4">
                          <label>No Of Poles:</label>
                          <input type="number" min="0" class="form-control" formControlName="noPoles" [ngClass]="{ 'is-invalid': submitted && a.get('noPoles')?.errors }"  placeholder="Enter poles" >
                          <div *ngIf="submitted && a.get('noPoles')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('noPoles')?.errors?.required">Field Is Required</div>
                          </div>
                        </div>

                        <div class="col-md-4">
                          <label>Current Rating:</label>
                          <div class="input-group">
                            <input type="number" min="0"   class="form-control" formControlName="current" [ngClass]="{ 'is-invalid': submitted && a.get('current')?.errors }" placeholder="Enter rating" >
                            <div class="input-group-prepend">
                              <span class="input-group-text">A</span>
                            </div>
                          </div>
                          <div *ngIf="submitted && a.get('current')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('current')?.errors?.required">Field Is Required</div>
                          </div>
                        </div>

                        <div class="col-md-4">
                          <label>Voltage Rating:</label>
                          <div class="input-group">
                            <input type="number" min="0"   class="form-control" formControlName="voltage" [ngClass]="{ 'is-invalid': submitted && a.get('voltage')?.errors }" placeholder="Enter voltage" >
                            <div class="input-group-prepend">
                              <span class="input-group-text">V</span>
                            </div>
                          </div>
                          <div *ngIf="submitted && a.get('voltage')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('voltage')?.errors?.required">Field Is Required</div>
                          </div>
                        </div>

                        <div class="col-md-4">
                          <label>Fuse Rating or Settings:</label>
                          <div class="input-group">
                            <input type="number" min="0"   class="form-control" formControlName="fuse" [ngClass]="{ 'is-invalid': submitted && a.get('fuse')?.errors }" placeholder="Enter rating" >
                            <div class="input-group-prepend">
                              <span class="input-group-text">A</span>
                            </div>
                          </div>
                          <div *ngIf="submitted && a.get('fuse')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('fuse')?.errors?.required">Field Is Required</div>
                          </div>
                        </div>

                        <div class="col-md-4" *ngIf="true">
                          <label>Rated Residual Operating Current I∆n:</label>
                          <div class="input-group">
                            <input type="number" min="0"   class="form-control" formControlName="residualCurrent" [ngClass]="{ 'is-invalid': submitted && a.get('residualCurrent')?.errors }" placeholder="Enter value" >
                            <div class="input-group-prepend">
                              <span class="input-group-text">mA</span>
                            </div>
                          </div>
                          <div *ngIf="submitted && a.get('residualCurrent')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('residualCurrent')?.errors?.required">Field Is Required</div>
                          </div>
                        </div>

                        <div class="col-md-4" *ngIf="true">
                          <label>Rated Residual Operating Time @I∆n T∆n	:</label>
                          <div class="input-group">
                            <input type="number" min="0"   class="form-control" formControlName="residualTime" 
                            
                            [ngClass]="{ 'is-invalid': submitted && a.get('residualTime')?.errors }" placeholder="Enter value" >
                            <div class="input-group-prepend">
                              <span class="input-group-text">mS</span>
                            </div>
                          </div>
                          <div *ngIf="submitted && a.get('residualTime')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('residualTime')?.errors?.required">Field Is Required</div>
                          </div>
                        </div>

                      </div>
                    </div>
                  </div>


              </mat-expansion-panel>

<!-- comments start-->
  <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false" *ngIf="hideShowComment">
    <mat-expansion-panel-header>
      <mat-panel-title>
        <h3>Comments</h3>
      </mat-panel-title>
    </mat-expansion-panel-header>
   
   <mat-progress-spinner style="margin: 0 auto;" *ngIf="spinner"
  color="primary"
   [mode]="mode"
   value="50"
  diameter="50">
</mat-progress-spinner>

<div class="card-body" style="padding: 0px;" *ngIf="cardBodyComments">
<button class="btn dropdown" (click)="showSubmenu = !showSubmenu" style="width:100%;" 
*ngIf="(isExpanded || isShowing) || (toggleHideShow || getViewerCommentControls().length > 2)">
  <mat-icon class="menu-button" [ngClass]="{'rotated' : showSubmenu}" style="float: left;">chevron_right</mat-icon> 
  <label style="float: left;">Check comments here!</label>
 </button> 
 <span *ngIf="getViewerCommentControls().length==0">No comments!</span>
 <mat-icon class="mousechange" (click)="refreshCommentSection()" style="float: right;"
 title="Refresh comment">refresh</mat-icon> 

<div  formArrayName="viewerCommentArr" *ngFor="let a of getViewerCommentControls(); let i = index" 
style="margin-left: 10px;">
<div [formGroupName]="i" style="margin-left: 30px;">
<div class="submenu" [ngClass]="{'expanded' : showSubmenu}" [ngStyle]="{'display': showSubmenu ? 'block' : 'none'}">

  <div class="input-group" [ngClass]="{even: i!=0}" style="align-items: end;">
    <div class="input-group-prepend" title="Viewer" style="height: 26px;">
        <span class="input-group-text" style="line-height: unset;">
            <i class="bi bi-eye-fill"></i>
        </span>
    </div>
    <textarea cols="60" rows="1" formControlName="viewerComments" placeholder="Enter Viewer Comment">
   </textarea>

<div style="display: flex;margin-left: 25px;" *ngIf="replyCommentBox">

          <mat-icon class="mousechange" (click)="sendViewerComment(a)" [ngClass]="{'disable':disableSend== true}"
          *ngIf="((a.get('inspectorComments')?.value=='' || a.get('inspectorComments')?.value==null) && sendComment)"
          title="Send comment">send</mat-icon> &nbsp;&nbsp;&nbsp;&nbsp;

          <mat-icon class="mousechange" (click)="replyToViewerComment(a)" 
          *ngIf="((a.get('viewerComments')?.value!='') && (getViewerCommentControls().length-1 == i)) && hideAsViewerLogin "
         title="Reply comment">reply</mat-icon>&nbsp;&nbsp;&nbsp;&nbsp;

         <mat-icon class="mousechange" (click)="ViewerRemoveComment(i)" style="float:right;position: relative;left: 630%;"
         *ngIf="(a.get('inspectorComments')?.value=='' || a.get('viewerComments')?.value=='') && hideDelete" >delete</mat-icon>
         &nbsp;&nbsp;&nbsp;&nbsp;

        
  </div>
</div>


  <span [ngClass]="i!=0 ? 'viewer' : 'even1'">
    {{a.value.viewerUserName}} {{a.value.viewerDateTime | date:'dd-MM-YY hh:mm:ss a':'+0530'}}
  </span>  

<div *ngIf="replyCommentBox">

<ul style="list-style-type:none;margin-bottom: 0rem;">
<li> 

  <div class="input-group" style="align-items: end;"
  *ngIf="(a.get('inspectorComments')?.value!='' && a.get('inspectorComments')?.value!=null) || showReplyBox" >
    <div class="input-group-prepend" title="Inspector" style="height: 26px;">
        <span class="input-group-text" style="line-height: unset;">
            <i class="bi bi-person-fill"></i>
        </span>
    </div>
    <textarea cols="60" rows="1" placeholder="Enter Inspector Comment" formControlName="inspectorComments" ></textarea>
 <div style="display: initial;margin-left: 25px;">

     <mat-icon class="mousechange" (click)="inspectorComment(a)" [ngClass]="{'disable':disableReply== true}"
     *ngIf="(getViewerCommentControls().length-1 == i) && SendReply" title="Send reply">send</mat-icon>

     <mat-icon class="mousechange" (click)="approveComment(a)" [ngClass]="{'disable':enabledRequest== true}"
     *ngIf="((getViewerCommentControls().length-1 == i) && hideapprove) && a.value.approveOrReject != 'REJECT'"
     title="Approve comment">thumb_up_alt</mat-icon> &nbsp;&nbsp;&nbsp;&nbsp;

     <mat-icon class="mousechange" (click)="rejectComment(a)" 
     [ngClass]="{'disable':a.value.approveOrReject === 'REJECT' || enabledRequest== true}"

      *ngIf="((getViewerCommentControls().length-1 == i) && hideReject) || 
      ((a.get('inspectorComments')?.value!='' || a.get('viewerComments')?.value!='') && a.value.approveOrReject=='REJECT')"
     title="Reject comment">thumb_down_alt</mat-icon>

     

     <mat-icon class="mousechange" (click)="addAnotherviewerComment()"
     *ngIf="((getViewerCommentControls().length-1 == i) && hideAdd) 
     || ((a.value.approveOrReject === 'REJECT' && getViewerCommentControls().length-1 == i) && addReject)"
      style="float:right;position: relative;left: 718%;" title="Add another comment">add_box</mat-icon>

 </div>
</div>

 <span style="display: block;font-size: 11px;text-align: center;margin-left: -29%;">
  {{a.value.inspectorUserName}} {{a.value.inspectorDateTime | date:'dd-MM-YY hh:mm:ss a':'+0530'}}</span>  
       </li>
     </ul>
    </div> 
    </div>
    </div>
  </div> 
   
  </div>   
   
  </mat-expansion-panel>

<!-- completed comments start-->
<mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false" *ngIf="completedComments">
<mat-expansion-panel-header>
<mat-panel-title>
<h3>Completed Comments</h3>
</mat-panel-title>

</mat-expansion-panel-header>
<div class="card-body" style="padding: 0px;">
<div formArrayName="completedCommentArr1" *ngFor="let x of getCompletedCommentControls1(); let j = index" >
<div [formGroupName]="j">

<button class="btn dropdown" (click)="showHideAccordion(j);" style="width:100%;" 
*ngIf="(isExpanded || isShowing) || toggleHideShow || getCompletedCommentControls1().length >= 1">
  <mat-icon class="menu-button" style="float: left;">chevron_right</mat-icon> 
  <label style="float: left;">{{getViewerFirstMessage(x)}}...</label>
 </button> 

<div *ngIf="j === expandedIndexx" >
<div  formArrayName="completedCommentArr" *ngFor="let a of getCompletedCommentControls(x); let i = index" 
style="margin-left: 10px;" > 
<div [formGroupName]="i" style="margin-left: 30px;">
<div class="submenu" >

<div class="input-group" [ngClass]="{even: i!=0}" style="align-items: end;">
<div class="input-group-prepend" title="Viewer" style="height: 26px;">
    <span class="input-group-text" style="line-height: unset;">
        <i class="bi bi-eye-fill"></i>
    </span>
</div>
<textarea cols="60" rows="1"  formControlName="viewerComments" placeholder="Enter Viewer Comment">
</textarea>
</div>
<div>
<span [ngClass]="i!=0 ? 'viewer' : 'even1'">
{{a.value.viewerUserName}} 
{{a.value.viewerDateTime | date:'dd-MM-YY hh:mm:ss a':'+0530'}}
</span>  
</div>
<div class="input-group" style="margin-left: 41px;width: 50%;align-items: end;">
<div class="input-group-prepend" title="Inspector" style="height: 26px;">
<span class="input-group-text" style="line-height: unset;">
  <i class="bi bi-person-fill"></i>
</span>
</div>
<textarea cols="60" rows="1"  formControlName="inspectorComments" placeholder="Enter Viewer Comment"></textarea>
</div>

<span style="display: block;font-size: 11px;text-align: center;margin-left: -25%;">
{{a.value.inspectorUserName}} {{a.value.inspectorDateTime | date:'dd-MM-YY hh:mm:ss a':'+0530'}}</span>  
   
</div>
</div>
</div> 
</div>
</div>
</div>
</div>   

</mat-expansion-panel>
<!-- completed comments end-->

             </mat-accordion>
             <div *ngIf="validationError" style="text-align: center;margin-top: 30px;">
              <span class="alert alert-danger">{{validationErrorMsg}}</span>
             </div>
             <div *ngIf="commentSuccess" style="text-align: center;margin-top: 30px;">
              <span class="successshow">Your comment has been sent to Inspector</span>
            </div>
            <div *ngIf="commentApprove" style="text-align: center;margin-top: 30px;">
              <span class="alert alert-success">Your response to comments has been approved</span>
            </div>
            <div *ngIf="commentReject" style="text-align: center;margin-top: 30px;">
              <span class="alert alert-danger">Your response to comments has been rejected</span>
            </div>
            <br>
             <div style="text-align: center;margin-top: 40px;">
              <button class="previous" mat-button matStepperPrevious>&laquo; Back</button>
              <button  class="next" [disabled]="disable" (click)="gotoNextModal(content1)" mat-button >Next &raquo;</button>
             </div>
    </form>
  </div>
</div>

<ng-template #content1 let-modal>

  <div class="modal-body">

 <div class="centre-text m-btm30">
  <div *ngIf="success" style="text-align: center;">
    <span class="successshow">{{successMsg}}</span>
   </div>
   <div *ngIf="Error" style="text-align: center;">
     <span class="errorshow">{{errorMsg}}</span>
    </div>
       </div>

   </div>
<br>
   <button type="button" class="close" class="btn btn-block btn-primary btn-rounded btn-md font-weight-medium auth-form-btn"
   aria-label="Close" (click)="closeModalDialog()" matStepperNext>

    <span aria-hidden="true">Ok</span>

</button>



</ng-template>
