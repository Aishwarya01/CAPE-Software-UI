<div *ngIf="tabError" style="text-align: center;">
  <span class="alert alert-danger">{{tabErrorMsg}}</span>
</div>
<div *ngIf="validationErrorTab" style="text-align: center;">
  <span class="alert alert-danger">{{validationErrorMsgTab}}</span>
</div>
<div class="card">
  <div class="card-body">
    <div class="row">
      <div class="col-sm-12">
        <a  [ngClass]="{'glow':service.observationGlowSupply}"
        style="margin-top: -10px;margin-bottom: 5px;float: right;text-decoration: underline;">Observations</a>
      </div>
      </div>
    <form [formGroup]="supplycharesteristicForm" (ngSubmit)="nextTab2(flag)" (keyup)="onKeyForm($event)" (change)="onChangeForm($event)">
      <mat-accordion>
        <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <h3>Mains Incoming</h3>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div class="form-group" [ngClass]="{'disableForm':service.allFieldsDisable}">
            <div class="row">
              <div class="col-md-4">
                 <mat-form-field class="client-description">
                  <mat-icon style="float: right;font-size: 18px;
                  line-height: unset;margin-right: 85%; margin-top: 0.7%;"
                  matTooltip="Main’s incoming in case of no alternative supply from state EB.
                  Main’s incoming in case of alternative supply from state EB act as standby.
                  EB source incomer-1 in case of alternative supply from state EB share the total load."
                  matTooltipClass="multiline-tooltip">
                  info_outline
                 </mat-icon>
                  <mat-label>
                    <h3>Short Name</h3>
                  </mat-label>
                  <textarea matInput class="client-box-description" formControlName="shortName" 
                  [ngClass]="{ 'is-invalid': submitted && f.shortName?.errors }" [(ngModel)]="supplycharesteristic.shortName"  
                  maxlength="500" [readonly]="service.allFieldsDisable" (keyup)="onKeyMainShortName($event)"
                  placeholder="Ex. Short Name ..." ></textarea>
                  <div *ngIf="submitted && f.shortName?.errors" class="invalid-feedback">
                    <div *ngIf="f.shortName?.errors?.required">Field Is Required</div>
                  </div>
                </mat-form-field>
              </div>
            </div>
            <br>
              <div class="row">
              <div class="col-md-3">
                <label>System Earthing:</label>
                <mat-icon style="float: right;font-size: 18px;
                line-height: unset;margin-right: 50%;"
                matTooltip="TN-C -system which has combined neutral and protective conductor. (i.e. body earthing is connected to the 
                neutral at or after point of commencement of supply). 
                TN-C-S – system which has combined neutral and protective conductor from source up to mains incoming panel.
                After this point separate neutral and protective conductor is used downstream. Minimum insulation resistance between 
                Neutral and earth is 1 MΩ. 
                TN-S – system which has separate neutral and protective conductor throughout the installation. 
                Minimum insulation resistance between Neutral and earth is 1 MΩ. 
                TT- system neutral of the source is connected to an earth electrode. Downstream installation have separate earth 
                electrode in soil.
                IT- system in which Live conductor are isolated from protective conductor (i.e floating neutral).
                In case of confusion select others."
                matTooltipClass="multiline-tooltip"
                aria-label="Button that shows a red tooltip"
                class="example-button">
                info_outline
               </mat-icon>
                <select class="form-control"  formControlName="systemEarthing" (change)="changeSystem($event)" [tabindex]="service.allFieldsDisable ? -1 : 0"
                [(ngModel)]="supplycharesteristic.mainSystemEarthing" [disabled]="service.allFieldsDisable"  [ngClass]="{ 'is-invalid': submitted && f.systemEarthing.errors }">
                  <option value="" selected>Select Option</option>
                  <option *ngFor="let value of systemEarthingList">
                    {{value}}
                  </option>
                </select>
                <div *ngIf="submitted && f.systemEarthing.errors" class="invalid-feedback">
                  <div *ngIf="f.systemEarthing?.errors?.required">Field Is Required</div>
                </div>
              </div>

              <div class="col-md-3"> 
                  <label>Type Of Live Conductors: </label>
                  <mat-icon style="float: right;font-size: 18px;
                  line-height: unset;margin-right: 35%;"
                  matTooltip="DC is disabled now, since it is not commonly used."
                  matTooltipClass="multiline-tooltip"
                  aria-label="Button that shows a red tooltip"
                  class="example-button">
                  info_outline
                 </mat-icon>
                  <select class="form-control"  formControlName="liveConductor"  [tabindex]="service.allFieldsDisable ? -1 : 0"
                  [(ngModel)]="supplycharesteristic.liveConductorType"  [disabled]="service.allFieldsDisable" 
                  (change)="changeCurrent($event)" [ngClass]="{ 'is-invalid': submitted && f.liveConductor.errors }">
                    <option value="" selected>Select Option</option>
                    <option value="AC">AC</option>
                    <option value="DC" disabled style="cursor: not-allowed;">DC</option>
                  </select>
                  <div *ngIf="submitted && f.liveConductor.errors" class="invalid-feedback">
                    <div *ngIf="f.liveConductor?.errors?.required">Field Is Required</div>
                  </div>
              </div>

              <div class="col-md-3" *ngIf="enableAC">
                <label>Nominal Frequency (HZ):</label>
                <select class="form-control" formControlName="mainNominalFrequency" [(ngModel)]="supplycharesteristic.mainNominalFrequency"
                [ngClass]="{ 'is-invalid': submitted && f.mainNominalFrequency.errors }" [disabled]="service.allFieldsDisable">
                  <option value="" selected>Select Option</option>  
                  <option value="50" [selected]="f.mainNominalFrequency?.value=== '50'">50</option>
                        <option value="60" [selected]="f.mainNominalFrequency?.value=== '60'">60</option>
                  </select>
              <div *ngIf="submitted && f.mainNominalFrequency.errors" class="invalid-feedback">
                <div *ngIf="f.mainNominalFrequency?.errors?.required">Field Is Required</div>
              </div>
            </div>

              <div class="col-md-3" *ngIf="enableAC"> 
                  <label>Number of conductors:</label>
                  <mat-icon style="float: right;font-size: 18px;
                  line-height: unset;margin-right: 38%;"
                  matTooltip="Single phase / three phase / three phase with neutral etc."
                  matTooltipClass="multiline-tooltip"
                  aria-label="Button that shows a red tooltip"
                  class="example-button">
                  info_outline
                 </mat-icon>
                  <select class="form-control" formControlName="AcConductor" [tabindex]="service.allFieldsDisable ? -1 : 0"
                  [(ngModel)]="supplycharesteristic.liveConductorAC" 
                  [ngClass]="{ 'is-invalid': submitted && f.AcConductor.errors }" [disabled]="service.allFieldsDisable">
                   <option value="" selected>Select Option</option>  
                    <option value="1-phase, 2-wire (LLM)" [selected]="f.AcConductor?.value=== AcValue">1-phase, 2-wire (LN)</option>
                          <option value="1-phase, 3-wire (LLM)" [selected]="f.AcConductor?.value=== AcValue">1-phase, 3-wire (LLM)</option>
                          <option value="2-phase, 3-wire (LLN)" [selected]="f.AcConductor?.value=== AcValue">2-phase, 3-wire (LLN)</option>
                          <option value="3-phase, 3-wire (LLL)" [selected]="f.AcConductor?.value=== AcValue">3-phase, 3-wire (LLL)</option>
                          <option value="3-phase, 4-wire (LLLN)" [selected]="f.AcConductor?.value=== AcValue">3-phase, 4-wire (LLLN)</option>
                    <!-- <option *ngFor="let value of AcConductorList" [selected]="value=== AcValue"> {{value}}</option> -->
                    </select>
                  <div *ngIf="submitted && f.AcConductor.errors" class="invalid-feedback">
                    <div *ngIf="f.AcConductor?.errors?.required">AC conductor type is required</div>
                  </div>
              </div>

              <div class="col-md-3" *ngIf="enableDC && f.liveConductor?.value=='DC'">
                  <label>DC:</label>
                  <select class="form-control" formControlName="DcConductor" 
                  [tabindex]="service.allFieldsDisable ? -1 : 0" [(ngModel)]="supplycharesteristic.liveConductorDC" 
                  [ngClass]="{ 'is-invalid': submitted && f.DcConductor.errors }" [disabled]="service.allFieldsDisable">
                   <option value="" selected>Select Option</option>
                    <!-- <option *ngFor="let value of liveConductorDCList" [selected]="value=== DcValue"> {{value}}</option> -->
                    <option value="2-pole" [selected]="f.DcConductor?.value=== DcValue" >2-pole</option>
                    <option value="3-pole" [selected]="f.DcConductor?.value=== DcValue" >3-pole</option>
                    <option value="Others" [selected]=" f.DcConductor?.value=== DcValue">Others</option> 
                  </select>
                  <div *ngIf="submitted && f.DcConductor.errors" class="invalid-feedback">
                    <div *ngIf="f.DcConductor?.errors?.required">DC conductor type is required</div>
                  </div>
              </div>
            </div>
            
          </div>


          <div class="row" [ngClass]="{'disableForm':service.allFieldsDisable}">	
            <div class="col-md-4">	
              <mat-form-field class="client-description " >	
                <mat-label>	
                  <h3>Brief Note (in case of confusion)</h3>	
                </mat-label>	
                <textarea matInput class="client-box-description" formControlName="briefNote" 	
                [ngClass]="{ 'is-invalid': submitted && f.briefNote.errors }" 	
                [(ngModel)]="supplycharesteristic.systemEarthingBNote" maxlength="500" placeholder="Ex. Brief Note ..." ></textarea>	
              </mat-form-field>	
              <div *ngIf="submitted && f.briefNote.errors" class="invalid-feedback">	
                <div *ngIf="f.briefNote?.errors?.required">Field Is Required</div>	
              </div>	
            </div>	
            <!-- <div class="col-md-4" *ngIf="showRemarks">	
              <mat-form-field class="client-description">	
                <mat-label>	
                  <h3>Remarks</h3>	
                </mat-label>	
                <textarea matInput class="client-box-description" formControlName="briefNote" 	
                [ngClass]="{ 'is-invalid': submitted && f.briefNote.errors }" 	
                [(ngModel)]="supplycharesteristic.systemEarthingBNote" maxlength="500" 	
                placeholder="Ex. Remarks ..." ></textarea>	
              </mat-form-field>	
              <div *ngIf="submitted && f.briefNote.errors" class="invalid-feedback">	
                <div *ngIf="f.briefNote?.errors?.required">Field Is Required</div>	
              </div>	
            </div> -->	
          </div>	
<br>
          <div class="row" *ngIf="tableAC" [ngClass]="{'disableForm':service.allFieldsDisable}">
            <div class="col-sm-12">
              <mat-icon style="float: right;font-size: 18px;
              line-height: unset;margin-right: 35%;margin-top: 0.5%;"
              matTooltip="If 1-phase, 2-wire (LN) is selected, column L1-N, L1-PE to be filled. 
              If 1-phase, 3-wire (LLM) is selected, column L1-L2, L1-N, L2-N, L1-PE & L2-PE to be filled. 
              If 2-phase, 3-wire (LLN) is selected, column L1-L2, L1-N, L2-N, L1-PE & L2-PE to be filled. 
              If 3-phase, 3-wire (LLL) is selected, column L1-L2, L2-L3, L3-L1, L1-PE, L2-PE & L3-PE to be filled. 
              If 3-phase, 4-wire (LLLN) is selected, all fields to be filled. 
              Fill not applicable (NA) for unfilled fields. 
              4.3 = 4.1/4.2 * 10-3 (calculation will be automatically done) 
              L1 is R phase, L2 is Y phase and L3 is B phase"
              matTooltipClass="multiline-tooltip"
              aria-label="Button that shows a red tooltip"
              class="example-button">
              info_outline
             </mat-icon>
              <h2>Nature of supply parameters: (Note: Please mention NA if any column is not applicable)</h2>
                <div class="table-responsive" style="border: 1px solid black">
                  <table class="table">
                    <thead>
                      <tr>

                        <th>Reference</th>

                        <th>L1-L2</th>
                        <th>L2-L3</th>
                        <th>L1-L3</th>
                        <th>L1-N</th>
                        <th>L2-N</th>
                        <th>L3-N</th>
                        <th>L1-PE</th>
                        <th>L2-PE</th>
                        <th>L3-PE</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td nowrap="nowrap">Nominal voltage U/U0 (V)</td>
                        <td><input  type="text" style="width:50px" [readonly]="service.allFieldsDisable" formControlName="NV1" [(ngModel)]="NV1"
                          (keyup)="onKeyVoltage($event)"></td>
                        <td><input  type="text" style="width:50px" [readonly]="service.allFieldsDisable" formControlName="NV2" [(ngModel)]="NV2"
                          (keyup)="onKeyVoltage($event)"></td>
                        <td><input  type="text" style="width:50px" [readonly]="service.allFieldsDisable" formControlName="NV3" [(ngModel)]="NV3"
                          (keyup)="onKeyVoltage($event)"></td>
                        <td><input  type="text" style="width:50px" [readonly]="service.allFieldsDisable" formControlName="NV4" [(ngModel)]="NV4"
                          (keyup)="onKeyVoltage($event)"></td>
                        <td><input  type="text" style="width:50px" [readonly]="service.allFieldsDisable" formControlName="NV5" [(ngModel)]="NV5"
                          (keyup)="onKeyVoltage($event)"></td>
                        <td><input  type="text" style="width:50px" [readonly]="service.allFieldsDisable" formControlName="NV6" [(ngModel)]="NV6"
                          (keyup)="onKeyVoltage($event)"></td>
                        <td><input  type="text" style="width:50px" [readonly]="service.allFieldsDisable" formControlName="NV7" [(ngModel)]="NV7"
                          (keyup)="onKeyVoltage($event)"></td>
                        <td><input  type="text" style="width:50px" [readonly]="service.allFieldsDisable" formControlName="NV8" [(ngModel)]="NV8"
                          (keyup)="onKeyVoltage($event)"></td>
                        <td><input  type="text" style="width:50px" [readonly]="service.allFieldsDisable" formControlName="NV9" [(ngModel)]="NV9"
                          (keyup)="onKeyVoltage($event)"></td>
                      </tr>
                      <!-- <tr>
                        <td nowrap="nowrap">Nominal Frequency f (HZ)</td>
                        <td colspan="9"><input  type="text" formControlName="NF1" [(ngModel)]="NF1" style="width: 950px"></td> -->
                        <!-- <td><input  type="text" style="width:50px" formControlName="NF1" [(ngModel)]="NF1"></td>
                        <td><input  type="text" style="width:50px" formControlName="NF2" [(ngModel)]="NF2"></td>
                        <td><input  type="text" style="width:50px" formControlName="NF3" [(ngModel)]="NF3"></td>
                        <td><input  type="text" style="width:50px" formControlName="NF4" [(ngModel)]="NF4"></td>
                        <td><input  type="text" style="width:50px" formControlName="NF5" [(ngModel)]="NF5"></td>
                        <td><input  type="text" style="width:50px" formControlName="NF6" [(ngModel)]="NF6"></td>
                        <td><input  type="text" style="width:50px" formControlName="NF7" [(ngModel)]="NF7"></td>
                        <td><input  type="text" style="width:50px" formControlName="NF8" [(ngModel)]="NF8"></td>
                        <td><input  type="text" style="width:50px" formControlName="NF9" [(ngModel)]="NF9"></td> -->
                      <!-- </tr> -->
                      <tr>
                        <td nowrap="nowrap">External Loop Impedance Ze (Ω)</td>
                        <td><input  type="text" style="width:50px" [readonly]="service.allFieldsDisable" formControlName="EL1" [(ngModel)]="EL1"
                          (keyup)="onKeyImpedance($event)"></td>
                        <td><input  type="text" style="width:50px" [readonly]="service.allFieldsDisable" formControlName="EL2" [(ngModel)]="EL2" 
                          (keyup)="onKeyImpedance($event)"></td>
                        <td><input  type="text" style="width:50px" [readonly]="service.allFieldsDisable" formControlName="EL3" [(ngModel)]="EL3"
                          (keyup)="onKeyImpedance($event)"></td>
                        <td><input  type="text" style="width:50px" [readonly]="service.allFieldsDisable" formControlName="EL4" [(ngModel)]="EL4"
                          (keyup)="onKeyImpedance($event)"></td>
                        <td><input  type="text" style="width:50px" [readonly]="service.allFieldsDisable" formControlName="EL5" [(ngModel)]="EL5"
                          (keyup)="onKeyImpedance($event)"></td>
                        <td><input  type="text" style="width:50px" [readonly]="service.allFieldsDisable" formControlName="EL6" [(ngModel)]="EL6"
                          (keyup)="onKeyImpedance($event)"></td>
                        <td><input  type="text" style="width:50px" [readonly]="service.allFieldsDisable" formControlName="EL7" [(ngModel)]="EL7"
                          (keyup)="onKeyImpedance($event)"></td>
                        <td><input  type="text" style="width:50px" [readonly]="service.allFieldsDisable" formControlName="EL8" [(ngModel)]="EL8"
                          (keyup)="onKeyImpedance($event)"></td>
                        <td><input  type="text" style="width:50px" [readonly]="service.allFieldsDisable" formControlName="EL9" [(ngModel)]="EL9"
                          (keyup)="onKeyImpedance($event)"></td>
                      </tr>
                      <tr>
                        <td nowrap="nowrap">Prospective fault current Ipfc (kA) </td>
                        <td><input  type="text" style="width:50px;pointer-events: none;" formControlName="PF1" readonly [(ngModel)]="PF1"></td>
                        <td><input  type="text" style="width:50px;pointer-events: none;" formControlName="PF2" readonly [(ngModel)]="PF2"></td>
                        <td><input  type="text" style="width:50px;pointer-events: none;" formControlName="PF3" readonly [(ngModel)]="PF3"></td>
                        <td><input  type="text" style="width:50px;pointer-events: none;" formControlName="PF4" readonly [(ngModel)]="PF4"></td>
                        <td><input  type="text" style="width:50px;pointer-events: none;" formControlName="PF5" readonly [(ngModel)]="PF5"></td>
                        <td><input  type="text" style="width:50px;pointer-events: none;" formControlName="PF6" readonly [(ngModel)]="PF6"></td>
                        <td><input  type="text" style="width:50px;pointer-events: none;" formControlName="PF7" readonly [(ngModel)]="PF7"></td>
                        <td><input  type="text" style="width:50px;pointer-events: none;" formControlName="PF8" readonly [(ngModel)]="PF8"></td>
                        <td><input  type="text" style="width:50px;pointer-events: none;" formControlName="PF9" readonly [(ngModel)]="PF9"></td>
                      </tr>
                      <tr>
                        <td>Capacity (kVA)
                          <mat-icon style="line-height: unset;font-size: 18px;margin-right: 54%;float: right;"
                          matTooltip="Capacity of DG, if alternative source is from state EB fill as not applicable"
                          matTooltipClass="multiline-tooltip"
                          aria-label="Button that shows a red tooltip"
                          class="example-button">
                          info_outline
                         </mat-icon>
                        </td>
                        <td colspan="9"><input  type="text" formControlName="NF1" [readonly]="service.allFieldsDisable" [(ngModel)]="NF1" style="width: 950px"></td>
                      </tr>
                      <tr>
                        <td>Actual load current connected to this source (A)</td>
                        <td colspan="2"><input  type="text" formControlName="AL1" [readonly]="service.allFieldsDisable" [(ngModel)]="AL1" style="width:206px"></td>
                        <td colspan="2"><input  type="text" formControlName="AL2" [readonly]="service.allFieldsDisable" [(ngModel)]="AL2" style="width:206px"></td>
                        <td colspan="3"><input  type="text" formControlName="AL3" [readonly]="service.allFieldsDisable" [(ngModel)]="AL3" style="width:206px"></td>
                        <td colspan="2"><input  type="text" formControlName="AL4" [readonly]="service.allFieldsDisable" [(ngModel)]="AL4" style="width:206px"></td>
                     </tr>
                    </tbody>
                  </table>
                </div>
            </div>
          </div>
         <br>

          <div class="row" [ngClass]="{'disableForm':service.allFieldsDisable}">
            <div class="col-sm-12">
              <h2>Incoming (Supply) Protective Device Characteristics:</h2>
              <div class="table-responsive" style="border: 1px solid black">
              <table  class="table">
                <tr>
                  <td nowrap="nowrap">Type Of Over Current Protective Device
                    <mat-icon style="float: right;font-size: 18px;
                    line-height: unset;margin-right: 60%;"
                    matTooltip="MCB/MCCB/RCBO/MCB with RCD/ACB with micrologic relay/ ACB with numerical protection relay."
                    matTooltipClass="multiline-tooltip"
                    aria-label="Button that shows a red tooltip"
                    class="example-button">
                    info_outline
                   </mat-icon>
                  </td>
                  <td> 
                  <input type="text"  style="width:200px" formControlName="mainNominalProtectiveDevice" 
                  [(ngModel)]="supplycharesteristic.mainNominalProtectiveDevice" [readonly]="service.allFieldsDisable" [ngClass]="{ 'is-invalid': submitted && f.mainNominalProtectiveDevice.errors }">
                  <div *ngIf="submitted && f.mainNominalProtectiveDevice.errors" class="invalid-feedback">
                    <div *ngIf="f.mainNominalProtectiveDevice?.errors?.required">Field Is Required</div>
                  </div>
                </td>
              </tr>
                <tr>
                  <td nowrap="nowrap">Rated current (A)
                    <mat-icon style="float: right;font-size: 18px;
                    line-height: unset;margin-right:79%;"
                    matTooltip="Rated current mentioned in over current protective device."
                    matTooltipClass="multiline-tooltip"
                    aria-label="Button that shows a red tooltip"
                    class="example-button">
                    info_outline
                   </mat-icon>
                  </td>
                  <td>
                    <input type="number" min="0" maxlength="4"style="width:200px" formControlName="mainRatedCurrent" 
                    [(ngModel)]="supplycharesteristic.mainRatedCurrent" [readonly]="service.allFieldsDisable"
                    [ngClass]="{ 'is-invalid': submitted && f.mainRatedCurrent.errors }">
                    <div *ngIf="submitted && f.mainRatedCurrent.errors" class="invalid-feedback">
                      <div *ngIf="f.mainRatedCurrent?.errors?.required">Field Is Required</div>
                    </div>
                  </td>
              </tr>
                <tr>
                  <td nowrap="nowrap">Current for Disconnection With in 0.2 seconds (A)
                    <mat-icon style="float: right;font-size: 18px;
                  line-height: unset;margin-right: 51%;"
                  matTooltip="MCB: B curve 3-5 times rated current (eg. For B6 MCB, 30 A current is needed to trip the MCB. 
                  C curve 5-10 times rated current 
                  D curve 10-20 times rated current 
                  K curve 8-12 times rated current 
                  Z curve 2-3 times rated current 
                  MCCB: based on manufacturers curve (OEM data sheets to be referred). 
                  ACB with relay: w.r.t. current & curve settings time will be calculated based on IEC 60255 (details to be given in remarks)."
                  matTooltipClass="multiline-tooltip"
                  aria-label="Button that shows a red tooltip"
                  class="example-button">
                  info_outline
                 </mat-icon>
                  </td>
                  <td>
                    <div class="input-group">
                      <input type="number"   min="0" maxlength="5" style="width:200px" max="5" formControlName="mainCurrentDisconnection" [readonly]="service.allFieldsDisable" [(ngModel)]="supplycharesteristic.mainCurrentDisconnection" [ngClass]="{ 'is-invalid': submitted && f.mainCurrentDisconnection.errors }">
                      <div class="input-group-prepend">
                        <span class="input-group-text">A</span>
                      </div>
                    </div>
                    <div *ngIf="submitted && f.mainCurrentDisconnection.errors" class="invalid-feedback">
                      <div *ngIf="f.mainCurrentDisconnection?.errors?.required">Field Is Required</div>
                    </div>
                  </td>
                </tr>
              </table>
              </div>
            </div>
          </div>

          <div class="row" [ngClass]="{'disableForm':service.allFieldsDisable}">
            <!-- <div class="col-md-4" *ngIf="showBrief">
              <mat-form-field class="client-description " >
                <mat-label>
                  <h3>Brief note (Optional)</h3>
                </mat-label>
                <textarea matInput class="client-box-description" formControlName="liveConductorBNote" 
                [ngClass]="{ 'is-invalid': submitted && f.liveConductorBNote.errors }" 
                [(ngModel)]="supplycharesteristic.liveConductorBNote" maxlength="500" placeholder="Ex. Brief Note ..." ></textarea>
              </mat-form-field>
              <div *ngIf="submitted && f.liveConductorBNote.errors" class="invalid-feedback">
                <div *ngIf="f.liveConductorBNote?.errors?.required">Field Is Required</div>
              </div>
            </div> -->

            <div class="col-md-4">
              <mat-form-field class="client-description">
                <mat-label>
                  <h3>Observations</h3>
                </mat-label>
                <textarea matInput class="client-box-description" formControlName="liveConductorBNote" 
                [ngClass]="{ 'is-invalid': submitted && f.liveConductorBNote.errors }"  [readonly]="service.allFieldsDisable"
                [(ngModel)]="supplycharesteristic.liveConductorBNote" maxlength="500" 
                placeholder="Ex. Observations ..." ></textarea>
              </mat-form-field>
              <div *ngIf="submitted && f.liveConductorBNote.errors" class="invalid-feedback">
                <div *ngIf="f.liveConductorBNote?.errors?.required">Field Is Required</div>
              </div>
            </div>
          </div>
        </mat-expansion-panel>

        <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <h3>Alternative Source of Supply</h3>
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="row" [ngClass]="{'disableForm':service.allFieldsDisable}">
              <div class="col-md-4">
                <div class="form-group">
                  <label> Availability of Alternate Supply:</label>
                  <mat-icon style="float: right;font-size: 18px;
                  line-height: unset;margin-right: 43%;"
                  matTooltip="In-case of availability of standby source from EB or/and DG source."
                  matTooltipClass="multiline-tooltip"
                  aria-label="Button that shows a red tooltip"
                  class="example-button">
                  info_outline
                 </mat-icon>
                  <select class="form-control" formControlName="alternativeSupply" [tabindex]="service.allFieldsDisable ? -1 : 0" 
                  [disabled]="service.allFieldsDisable"
                  (change)="showAlternateField($event)" [ngClass]="{ 'is-invalid': submitted && f.alternativeSupply.errors }" 
                  [(ngModel)]="supplycharesteristic.alternativeSupply">
                 <option value="" disabled selected>Select Option</option>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                  </select>
                  <div *ngIf="submitted && f.alternativeSupply.errors" class="invalid-feedback">
                    <div *ngIf="f.alternativeSupply?.errors?.required">Field Is Required</div>
                  </div>
                </div>
              </div>

              <div class="col-md-4" *ngIf="alternativeSupplyNo"> 
                <label>Number of Alternate Sources of Supply:</label>
                <mat-icon style="float: right;font-size: 18px;
                line-height: unset;margin-right: 30%;"
                matTooltip="Total number of alternative sources from state EB and DG’s."
                matTooltipClass="multiline-tooltip"
                aria-label="Button that shows a red tooltip"
                class="example-button">
                info_outline
               </mat-icon>
                <input (keypress)="keyPressNumbers($event)" type="tel" min="0" class="form-control" formControlName="supplyNumber" [readonly]="service.allFieldsDisable" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"
                [ngClass]="{ 'is-invalid': submitted && f.supplyNumber.errors }" 
                [(ngModel)]="supplycharesteristic.supplyNumber"
                (keyup)="onKeyAlernate($event)">

                <!-- <p class="joints">Number of Alternate Sources of Supply: 
                  <input type="tel" min="0" formControlName="supplyNumber" 
                  [ngClass]="{ 'is-invalid': submitted && f.supplyNumber.errors }" 
                  [value]="supplycharesteristic.supplyNumber" [(ngModel)]="supplycharesteristic.supplyNumber" style="
                  width: 50px;
                  background: transparent;
                  border: none;
                  border-bottom: 1px solid #000000;" (keyup)="onKeyAlernate($event)"></p> -->
                <div *ngIf="submitted && f.supplyNumber.errors" class="invalid-feedback">
                  <div *ngIf="f.supplyNumber?.errors?.required">Supply number is required</div>
                  <div *ngIf="f.supplyNumber?.errors?.min">Field value should be more than 0 or change Availability of Alternate Supply</div>
                </div>
              </div>
            </div>

            <div *ngIf="sources">
              <div formArrayName="alternateArr" *ngFor="let a of getLocation4Controls(); let i = index">


                    <h2>Alternate Form :</h2>
                
              
                  <mat-icon  class="mousechange" class="dlt" type="button" title="Delete" [ngClass]="{'disableForm':service.allFieldsDisable}" (click)="removeItem3(a,i)"  style="margin-inline: 4rem;float: right;position: relative;margin-top: -4rem;" >remove_circle_outline</mat-icon>
      
                    
            

                <div class="form-group" [formGroupName]="i" [ngClass]="{'disableForm':service.allFieldsDisable}">
                  <!-- <div class="row">
                    <div class="col-md-4">
                      <input type="text" class="form-control" formControlName="alternateArrFormValue" 
                      value="Alternate Source of Supply-{{i}}">
                    </div>
                  </div> -->
                  <div class="row" [ngClass]="{'disableForm':service.allFieldsDisable}">
                    <div class="col-md-4">
                      <label>Alternate supply no:</label>
                      <mat-icon style="float: right;font-size: 18px;
                      line-height: unset;margin-right: 60%;"
                      matTooltip="Start with 1 and continue sequentially."
                      matTooltipClass="multiline-tooltip"
                      aria-label="Button that shows a red tooltip"
                      class="example-button">
                      info_outline
                     </mat-icon>
                      <input type="number"   min="0" class="form-control" [readonly]="service.allFieldsDisable" formControlName="aLSupplyNo" [ngClass]="{ 'is-invalid': submitted && a.get('aLSupplyNo')?.errors }">
                      <div *ngIf="submitted && a.get('aLSupplyNo')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('aLSupplyNo')?.errors?.required">Field Is Required</div>
                      </div>
                    </div>

                    <!-- <div class="col-md-4">
                      <label>Short Name:</label>
                      <mat-icon style="float: right;font-size: 18px;
                      line-height: unset;margin-right: 71%;"
                      matTooltip="Main’s incoming (standby) in case of alternative supply from state EB act as standby. 
                      EB source incomer-2 in case of alternative supply from state EB share the total load. 
                      DG source in case of alternative supply from DG."
                      matTooltipClass="multiline-tooltip"
                      aria-label="Button that shows a red tooltip"
                      class="example-button">
                      info_outline
                     </mat-icon>
                      <input type="text"  maxlength="50" class="form-control"  formControlName="aLSupplyShortName" [ngClass]="{ 'is-invalid': submitted && a.get('aLSupplyShortName')?.errors }">
                      <div *ngIf="submitted && a.get('aLSupplyShortName')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('aLSupplyShortName')?.errors?.required">Field Is Required</div>
                      </div>
                    </div> -->
                  
                    <div class="col-md-4">
                      <label>System Earthing:</label>

                      <mat-icon style="float: right;font-size: 18px;
                      line-height: unset;margin-right: 64%;"
                      matTooltip="TN-C -system which has combined neutral and protective conductor. (i.e. body earthing is connected to the neutral at or after point of commencement of supply). 
                      TN-C-S – system which has combined neutral and protective conductor from source up to mains incoming panel. 
                      After this point separate neutral and protective conductor  is used downstream. 
                      Minimum insulation resistance between Neutral and earth is 1 MΩ. 
                      TN-S – system which has separate neutral and protective conductor throughout the installation.   
                      Minimum insulation resistance between Neutral and earth is 1 MΩ.TT- system neutral of the source is connected to an earth electrode. 
                      Downstream installation have separate earth electrode in soil.   
                      IT- system in which Live conductor are isolated from protective conductor (i.e floating neutral). 
                      In case of confusion select others."
                      matTooltipClass="multiline-tooltip"
                      aria-label="Button that shows a red tooltip"
                      class="example-button">
                      info_outline
                     </mat-icon>
                     <select class="form-control" formControlName="aLSystemEarthing" (change)="enableBriefNote($event,a)" 
                     [tabindex]="service.allFieldsDisable ? -1 : 0" [ngClass]="{ 'is-invalid': submitted && a.get('aLSystemEarthing')?.errors }">
                       <option value="" selected>Select Option</option>
                        <option *ngFor="let value of systemEarthingList" [selected]="value=== a.get('aLSystemEarthing')?.value"> {{value}}</option>
                      </select>
                      <div *ngIf="submitted && a.get('aLSystemEarthing')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('aLSystemEarthing')?.errors?.required">Field Is Required</div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-4">
                    <mat-form-field class="client-description">
                      <mat-icon style="float: right;font-size: 18px;
                      line-height: unset;margin-right: 84%;margin-top: 0.6%;"
                      matTooltip="Main’s incoming (standby) in case of alternative supply from state EB act as standby.
                      EB source incomer-2 in case of alternative supply from state EB share the total load.
                      DG source in case of alternative supply from DG."
                      matTooltipClass="multiline-tooltip">
                      info_outline
                     </mat-icon>
                      <mat-label>
                        <h3>Short Name</h3>
                      </mat-label>
                      <textarea matInput class="client-box-description" formControlName="aLSupplyShortName" 
                      [ngClass]="{ 'is-invalid': submitted && a.get('aLSupplyShortName')?.errors }" maxlength="500" 
                      placeholder="Ex. Remarks ..." [readonly]="service.allFieldsDisable" (keyup)="onKeyAlternateShortName($event,i)"></textarea>
                      <div *ngIf="submitted && a.get('aLSupplyShortName')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('aLSupplyShortName')?.errors?.required">Field Is Required</div>
                      </div>
                    </mat-form-field>
                    </div>
                  </div>
<br>
                <div class="row" [ngClass]="{'disableForm':service.allFieldsDisable}">	
                <div class="col-md-4">	
                <mat-form-field class="client-description">	
                  <mat-label>	
                    <h3>Brief Note (in case of confusion)</h3>	
                  </mat-label>	
                  <textarea matInput class="client-box-description" 	
                  formControlName="aLSystemEarthingBNote" 	
                  [ngClass]="{ 'is-invalid': submitted && a.get('aLSystemEarthingBNote')?.errors }" 	
                  maxlength="500" 	
                  placeholder="Ex. Brief Note ..." ></textarea>	
                </mat-form-field>	
                <div *ngIf="submitted && a.get('aLSystemEarthingBNote')?.errors" class="invalid-feedback">	
                  <div *ngIf="a.get('aLSystemEarthingBNote')?.errors?.required">Field Is Required</div>	
                </div>	
                </div>	
                <!-- <div class="col-md-4" *ngIf="a.get('aLSystemEarthing')?.value=='Others'">	
                <mat-form-field class="client-description">	
                  <mat-label>	
                    <h3>Remarks</h3>	
                  </mat-label>	
                  <textarea matInput class="client-box-description" formControlName="aLSystemEarthingBNote" 	
                  [ngClass]="{ 'is-invalid': submitted && a.get('aLSystemEarthingBNote')?.errors }" 	
                  maxlength="500" 	
                  placeholder="Ex. Remarks ..." ></textarea>	
                </mat-form-field>	
                <div *ngIf="submitted && a.get('aLSystemEarthingBNote')?.errors" class="invalid-feedback">	
                  <div *ngIf="a.get('aLSystemEarthingBNote')?.errors?.required">Field Is Required</div>	
                </div>	
                </div> -->	
                </div>
                <br>
                  <div class="row">
                    <div class="col-md-4">
                        <label>Type Of Live Conductors: </label>
                        <select class="form-control"  formControlName="aLLiveConductorType" 
                        [tabindex]="service.allFieldsDisable ? -1 : 0" [disabled]="service.allFieldsDisable" 
                        (change)=showValue($event,i) [ngClass]="{ 'is-invalid': submitted && a.get('aLLiveConductorType')?.errors }">
                         <option value="" selected>Select Option</option>
                          <option value="AC">AC</option>
                          <option value="DC" disabled style="cursor: not-allowed;">DC</option>
                        </select>
                        <div *ngIf="submitted && a.get('aLLiveConductorType')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('aLLiveConductorType')?.errors?.required">Field Is Required</div>
                        </div>
                    </div>

                    <div class="col-md-4" *ngIf="a.get('aLLiveConductorType')?.value=='AC'">
                      <label>Nominal Frequency (HZ):</label>
                      <select class="form-control" formControlName="nominalFrequency" 
                      [tabindex]="service.allFieldsDisable ? -1 : 0" [disabled]="service.allFieldsDisable"
                      [ngClass]="{ 'is-invalid': submitted && a.get('nominalFrequency')?.errors }">
                       <option value="" selected>Select Option</option>  
                        <option value="50">50</option>
                        <option value="60">60</option>
                        </select>
                        <div *ngIf="submitted && a.get('nominalFrequency')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('nominalFrequency')?.errors?.required">Field Is Required</div>
                        </div>
                  </div>

                    <div class="col-md-4" *ngIf="a.get('aLLiveConductorType')?.value=='AC'">
                        <label>Number of conductors:</label>
                        <select class="form-control" formControlName="aLLiveConductorAC" 
                        [tabindex]="service.allFieldsDisable ? -1 : 0" [disabled]="service.allFieldsDisable"
                        [ngClass]="{ 'is-invalid': submitted && a.get('aLLiveConductorAC')?.errors }">
                         <option value="" selected>Select Option</option>
                          <option value="1-phase, 2-wire (LLM)">1-phase, 2-wire (LN)</option>
                          <option value="1-phase, 3-wire (LLM)">1-phase, 3-wire (LLM)</option>
                          <option value="2-phase, 3-wire (LLN)">2-phase, 3-wire (LLN)</option>
                          <option value="3-phase, 3-wire (LLL)">3-phase, 3-wire (LLL)</option>
                          <option value="3-phase, 4-wire (LLLN)">3-phase, 4-wire (LLLN)</option>
                        </select>
                        <div *ngIf="submitted && a.get('aLLiveConductorAC')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('aLLiveConductorAC')?.errors?.required">Field Is Required</div>
                        </div>
                    </div>

                    <div class="col-md-4" *ngIf="a.get('aLLiveConductorType')?.value=='DC'">
                        <label>DC:</label>
                        <select class="form-control" formControlName="aLLiveConductorDC" 
                        [tabindex]="service.allFieldsDisable ? -1 : 0" [disabled]="service.allFieldsDisable" [ngClass]="{ 'is-invalid': submitted && a.get('aLLiveConductorDC')?.errors }">
                          <option selected="selected" value="2-pole">2-pole </option>
                          <option value=" 3-pole"> 3-pole</option>
                          <option value="Others">Others</option>
                        </select>
                        <div *ngIf="submitted && a.get('aLLiveConductorDC')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('aLLiveConductorDC')?.errors?.required">Field Is Required</div>
                        </div>
                    </div>
                  </div>

<br>



                  <div class="row" *ngIf="a.get('aLLiveConductorType')?.value=='AC'" [ngClass]="{'disableForm':service.allFieldsDisable}">
                    <div class="col-sm-12">
                      <mat-icon style="float: right;font-size: 18px;
                      line-height: unset;margin-right: 36%;margin-top: 0.5%;"
                      matTooltip="If 1-phase, 2-wire (LN) is selected, column L1-N, L1-PE to be filled. 
                      If 1-phase, 3-wire (LLM) is selected, column L1-L2, L1-N, L2-N, L1-PE & L2-PE to be filled. 
                      If 2-phase, 3-wire (LLN) is selected, column L1-L2, L1-N, L2-N, L1-PE & L2-PE to be filled. 
                      If 3-phase, 3-wire (LLL) is selected, column L1-L2, L2-L3, L3-L1, L1-PE, L2-PE & L3-PE to be filled. 
                      If 3-phase, 4-wire (LLLN) is selected, all fields to be filled. 
                      Fill not applicable (NA) for unfilled fields. 
                      54.3 = 54.1/54.2 * 10-3 (calculation will be automatically done).
                      L1 is R phase, L2 is Y phase and L3 is B phase."
                      matTooltipClass="multiline-tooltip"
                      aria-label="Button that shows a red tooltip"
                      class="example-button">
                      info_outline
                     </mat-icon>
                      <h2>Nature of supply parameters: (Note: Please mention NA if any column is not applicable)</h2>
                      <div class="table-responsive" style="border: 1px solid black">
                        <table  class="table" formArrayName="nominalVoltageArr1" *ngFor="let row of getTableArray(a); let j = index">
                          <thead>
                              <tr>

                                <th>Reference</th>
                                <th>L1-L2</th>
                                <th>L2-L3</th>
                                <th>L1-L3</th>
                                <th>L1-N</th>
                                <th>L2-N</th>
                                <th>L3-N</th>
                                <th>L1-PE</th>
                                <th>L2-PE</th>
                                <th>L3-PE</th>
                              </tr>
                          </thead>
                          <tbody [formGroupName]="j">
                              <tr>
                                <td nowrap="nowrap">Nominal Voltage U/U0 (V)</td>
                                <td><input  type="text" formControlName="nominalVoltage1" [readonly]="service.allFieldsDisable" style="width:70px" (keyup)="onKeyVoltage1($event,row)"></td>
                                <td><input  type="text" formControlName="nominalVoltage2" [readonly]="service.allFieldsDisable" style="width:70px" (keyup)="onKeyVoltage1($event,row)"></td>
                                <td><input  type="text"  formControlName="nominalVoltage3" [readonly]="service.allFieldsDisable"style="width:70px" (keyup)="onKeyVoltage1($event,row)"></td>
                                <td><input  type="text" formControlName="nominalVoltage4"[readonly]="service.allFieldsDisable" style="width:70px" (keyup)="onKeyVoltage1($event,row)"></td>
                                <td><input  type="text" formControlName="nominalVoltage5" [readonly]="service.allFieldsDisable"style="width:70px" (keyup)="onKeyVoltage1($event,row)"></td>
                                <td><input  type="text" formControlName="nominalVoltage6" [readonly]="service.allFieldsDisable"style="width:70px" (keyup)="onKeyVoltage1($event,row)"></td>
                                <td><input  type="text"  formControlName="nominalVoltage7" [readonly]="service.allFieldsDisable"style="width:70px" (keyup)="onKeyVoltage1($event,row)"></td>
                                <td><input  type="text" formControlName="nominalVoltage8" [readonly]="service.allFieldsDisable"style="width:70px" (keyup)="onKeyVoltage1($event,row)"></td>
                                <td><input  type="text" formControlName="nominalVoltage9" [readonly]="service.allFieldsDisable"style="width:70px" (keyup)="onKeyVoltage1($event,row)"></td>

                              </tr>
                              <!-- <tr> 
                                <td nowrap="nowrap">Nominal Frequency f (HZ)</td>
                                <td colspan="9"><input  type="text" formControlName="nominalFrequency1" style="width: 950px"></td> -->
                                <!-- <td><input  type="text"   formControlName="nominalFrequency1" style="width:70px"></td>
                                <td><input  type="text" formControlName="nominalFrequency2" style="width:70px"></td>
                                <td><input  type="text"  formControlName="nominalFrequency3" style="width:70px"></td>
                                <td><input  type="text" formControlName="nominalFrequency4" style="width:70px"></td>
                                <td><input  type="text"  formControlName="nominalFrequency5" style="width:70px"></td>
                                <td><input  type="text" formControlName="nominalFrequency6" style="width:70px"></td>
                                <td><input  type="text" formControlName="nominalFrequency7" style="width:70px"></td>
                                <td><input  type="text"  formControlName="nominalFrequency8" style="width:70px"></td>
                                <td><input  type="text" formControlName="nominalFrequency9" style="width:70px"></td> -->
                              <!-- </tr> -->
                              <tr>
                                <td nowrap="nowrap">External Loop Impedance Ze (Ω)</td>
                                <td><input  type="text"  formControlName="impedence1"[readonly]="service.allFieldsDisable" style="width:70px" (keyup)="onKeyImpedance1($event,row)"></td>
                                <td><input  type="text"  formControlName="impedence2"[readonly]="service.allFieldsDisable" style="width:70px" (keyup)="onKeyImpedance1($event,row)"></td>
                                <td><input  type="text" formControlName="impedence3"[readonly]="service.allFieldsDisable" style="width:70px" (keyup)="onKeyImpedance1($event,row)"></td>
                                <td><input  type="text"   formControlName="impedence4"[readonly]="service.allFieldsDisable" style="width:70px" (keyup)="onKeyImpedance1($event,row)"></td>
                                <td><input  type="text" formControlName="impedence5"[readonly]="service.allFieldsDisable" style="width:70px" (keyup)="onKeyImpedance1($event,row)"></td>
                                <td><input  type="text"  formControlName="impedence6"[readonly]="service.allFieldsDisable" style="width:70px" (keyup)="onKeyImpedance1($event,row)"></td>
                                <td><input  type="text"  formControlName="impedence7"[readonly]="service.allFieldsDisable" style="width:70px" (keyup)="onKeyImpedance1($event,row)"></td>
                                <td><input  type="text"  formControlName="impedence8"[readonly]="service.allFieldsDisable" style="width:70px" (keyup)="onKeyImpedance1($event,row)"></td>
                                <td><input  type="text" formControlName="impedence9"[readonly]="service.allFieldsDisable" style="width:70px" (keyup)="onKeyImpedance1($event,row)"></td>

                              </tr>
                              <tr>
                                <td nowrap="nowrap" readonly>Prospective Fault Current Ipfc (kA) </td>
                                <td><input  type="text"  formControlName="current1" style="width:70px;pointer-events: none;" readonly 
                                  [value]="row.get('current1')?.value"></td>
                                <td><input  type="text"  formControlName="current2" style="width:70px;pointer-events: none;" 
                                  readonly [value]="row.get('current2')?.value"></td>
                                <td><input  type="text" formControlName="current3" style="width:70px;pointer-events: none;" readonly 
                                  [value]="row.get('current3')?.value"></td>
                                <td><input  type="text"  formControlName="current4" style="width:70px;pointer-events: none;" readonly 
                                  [value]="row.get('current4')?.value"></td>
                                <td><input  type="text" formControlName="current5" style="width:70px;pointer-events: none;" readonly 
                                  [value]="row.get('current5')?.value"></td>
                                <td><input  type="text"  formControlName="current6" style="width:70px;pointer-events: none;" readonly 
                                  [value]="row.get('current6')?.value"></td>
                                <td><input  type="text"  formControlName="current7" style="width:70px;pointer-events: none;" readonly 
                                  [value]="row.get('current7')?.value"></td>
                                <td><input  type="text" formControlName="current8" style="width:70px;pointer-events: none;" readonly 
                                  [value]="row.get('current8')?.value"></td>
                                <td><input  type="text" formControlName="current9" style="width:70px;pointer-events: none;" readonly 
                                  [value]="row.get('current9')?.value"></td>
                              </tr>
                                <tr>
                                  <td>Capacity (kVA)
                                    <mat-icon style="line-height: unset;font-size: 18px;margin-right: 53%;float: right;"
                                    matTooltip="Capacity of DG, if alternative source is from state EB fill as not applicable"
                                    matTooltipClass="multiline-tooltip"
                                    aria-label="Button that shows a red tooltip"
                                    class="example-button">
                                    info_outline
                                   </mat-icon>
                                  </td>
                                  <td colspan="9"><input  type="text" formControlName="capacity" [readonly]="service.allFieldsDisable" style="width: 950px"></td>
                                </tr>
                                <tr>
                                  <td>Actual load current connected to this source (A) </td>
                                  <td colspan="2"><input  type="text" formControlName="loadCurrent1" [readonly]="service.allFieldsDisable" style="width:206px"></td>
                                  <td colspan="2"><input  type="text" formControlName="loadCurrent2" [readonly]="service.allFieldsDisable" style="width:206px"></td>
                                  <td colspan="3"><input  type="text" formControlName="loadCurrent3" [readonly]="service.allFieldsDisable" style="width:206px"></td>
                                  <td colspan="2"><input  type="text" formControlName="loadCurrent4" [readonly]="service.allFieldsDisable" style="width:206px"></td>
                                </tr>
                          </tbody>
                          </table>
                      </div>
                    </div>
                  </div>
                  <br>

                  <div class="row" [ngClass]="{'disableForm':service.allFieldsDisable}">
                    <div class="col-sm-12">
                      <h2>Incoming (Supply) Protective Device Characteristics:</h2>
                      <div class="table-responsive" style="border: 1px solid black">
                      <table  class="table">
                          <tr>
                            <td nowrap="nowrap">Type Of Over Current Protective Device
                              <mat-icon style="float: right;font-size: 18px;
                              line-height: unset;margin-right: 47%;"
                              matTooltip="MCB/MCCB/RCBO/MCB with RCD/ACB with micrologic relay/ ACB with numerical protection relay."
                              matTooltipClass="multiline-tooltip"
                              aria-label="Button that shows a red tooltip"
                              class="example-button">
                              info_outline
                             </mat-icon>
                            </td>
                            <td>
                              <input type="text"  style="width:400px" [readonly]="service.allFieldsDisable" formControlName="protectiveDevice" 
                              [ngClass]="{ 'is-invalid': submitted && a.get('protectiveDevice')?.errors }">
                              <div *ngIf="submitted && a.get('protectiveDevice')?.errors" class="invalid-feedback">
                                <div *ngIf="a.get('protectiveDevice')?.errors?.required">Field Is Required</div>
                              </div>
                            </td>
                        
                          </tr>
                          <tr>
                              <td nowrap="nowrap">Rated current (A)
                                <mat-icon style="float: right;font-size: 18px;
                              line-height: unset;margin-right: 73%;"
                              matTooltip="Rated current mentioned in over current protective device."
                              matTooltipClass="multiline-tooltip"
                              aria-label="Button that shows a red tooltip"
                              class="example-button">
                              info_outline
                             </mat-icon>
                              </td>
                              <td>
                                <input type="number" min="0" [readonly]="service.allFieldsDisable" formControlName="ratedCurrent" min="0" 
                                [ngClass]="{ 'is-invalid': submitted && a.get('ratedCurrent')?.errors }" style="width:400px">
                                <div *ngIf="submitted && a.get('ratedCurrent')?.errors" class="invalid-feedback">
                                  <div *ngIf="a.get('ratedCurrent')?.errors?.required">Field Is Required</div>
                                </div>
                              </td>
                              
                          </tr>
                          <tr>
                            <td nowrap="nowrap">Current for Disconnection with in 0.2 seconds (A)
                              <mat-icon style="float: right;font-size: 18px;
                              line-height: unset;margin-right: 35%;"
                              matTooltip="MCB: B curve 3-5 times rated current (eg. For B6 MCB, 30 A current is needed to trip the MCB. 
                              C curve 5-10 times rated current
                              D curve 10-20 times rated current 
                              K curve 8-12 times rated current 
                              Z curve 2-3 times rated current 
                              MCCB: based on manufacturers curve (OEM data sheets to be referred). 
                              ACB with relay: w.r.t. current & curve settings time will be calculated based on IEC 60255 (details to be given in remarks)."
                              matTooltipClass="multiline-tooltip"
                              aria-label="Button that shows a red tooltip"
                              class="example-button">
                              info_outline
                             </mat-icon>
                            </td>
                            <td>
                              <div class="input-group">
                                <input type="number" min="0" formControlName="currentDissconnection" [readonly]="service.allFieldsDisable" [ngClass]="{ 'is-invalid': submitted && a.get('currentDissconnection')?.errors }" style="width:400px">
                                <div class="input-group-prepend">
                                  <span class="input-group-text">A</span>
                                </div>
                              </div>
                              <div *ngIf="submitted && a.get('currentDissconnection')?.errors" class="invalid-feedback">
                                <div *ngIf="a.get('currentDissconnection')?.errors?.required">Field Is Required</div>
                              </div>
                            </td>
                           
                          </tr>
                      </table>
                    </div>
                    </div>
                  </div>

<br>
        <div class="row" [ngClass]="{'disableForm':service.allFieldsDisable}">	
          <!-- <div class="col-md-4" *ngIf="a.get('aLSystemEarthing')?.value!='Others'">	
            <mat-form-field class="client-description">	
              <mat-label>	
                <h3>Brief Note (in case of confusion)(Optional)</h3>	
              </mat-label>	
              <textarea matInput class="client-box-description" formControlName="aLLiveConductorBNote" 	
              [ngClass]="{ 'is-invalid': submitted && a.get('aLLiveConductorBNote')?.errors }" maxlength="500" 	
              placeholder="Ex. Brief Note ..." ></textarea>	
              <div *ngIf="submitted && a.get('aLLiveConductorBNote')?.errors" class="invalid-feedback">	
                <div *ngIf="a.get('aLLiveConductorBNote')?.errors?.required">Field Is Required</div>	
              </div>	
            </mat-form-field>	
          </div> -->	
          <div class="col-md-4">	
            <mat-form-field class="client-description">	
              <mat-label>	
                <h3>Observations</h3>	
              </mat-label>	
              <textarea matInput class="client-box-description" formControlName="aLLiveConductorBNote" 	
              [ngClass]="{ 'is-invalid': submitted && a.get('aLLiveConductorBNote')?.errors }" 	
              maxlength="500" 	
              placeholder="Ex. Observations ..." ></textarea>	
            </mat-form-field>	
            <div *ngIf="submitted && a.get('aLLiveConductorBNote')?.errors" class="invalid-feedback">	
              <div *ngIf="a.get('aLLiveConductorBNote')?.errors?.required">Field Is Required</div>	
            </div>	
          </div>	
        </div>	
        </div>	
        </div>	
        </div>


        </mat-expansion-panel>
            <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h3>Particulars Of Installation Referred in the Report</h3>
                </mat-panel-title>
              </mat-expansion-panel-header>
              <div class="row" [ngClass]="{'disableForm':service.allFieldsDisable}">
                <div class="col-md-4" style="margin-top: 30px">
                  <p>Maximum Demand <input type="number" min="0" formControlName="maximumDemand"   [readonly]="service.allFieldsDisable"
                  [ngClass]="{ 'is-invalid': submitted && f.maximumDemand.errors }"[(ngModel)]="supplycharesteristic.maximumDemand" style="
                    width: 50px;
                    background: transparent;
                    border: none;
                    border-bottom: 1px solid #000000;"> KvA</p>
                    <div *ngIf="submitted && f.maximumDemand.errors" class="invalid-feedback">
                      <div *ngIf="f.maximumDemand?.errors?.required">Maximum Demand is Required</div>
                    </div>
                </div>

                <div class="col-md-4" style="margin-top: 30px">
                  <p>Maximum Load<input type="number" min="0" formControlName="maximumLoad" [readonly]="service.allFieldsDisable"
                  [ngClass]="{ 'is-invalid': submitted && f.maximumLoad.errors }" [(ngModel)]="supplycharesteristic.maximumLoad" style="
                    width: 50px;
                    background: transparent;
                    border: none;
                    border-bottom: 1px solid #000000;"> Amps</p>
                    <div *ngIf="submitted && f.maximumLoad.errors" class="invalid-feedback">
                      <div *ngIf="f.maximumLoad?.errors?.required">Maximum load is required</div>
                    </div>
                </div>

                <div class="col-md-4" >
                  <label>Means Of Earthing :</label>
                  <mat-icon style="float: right;font-size: 18px;
                  line-height: unset;margin-right: 61%;"
                  matTooltip="Choose supplier facility in case of TN-S system. 
                  Choose Installation earth electrode in case of TT system. 
                  Supplier and installation earth electrode in case of TN-C-S system or TN-S system with PME. 
                  In case of confusion make it NIL, incase if we select as Others, add section for Remarks."
                  matTooltipClass="multiline-tooltip"
                  aria-label="Button that shows a red tooltip"
                  class="example-button">
                  info_outline
                 </mat-icon>
                  <select class="form-control" formControlName="meansEarthing" [disabled]="service.allFieldsDisable" [tabindex]="service.allFieldsDisable ? -1 : 0"
                  [ngClass]="{ 'is-invalid': submitted && f.meansEarthing.errors }" [(ngModel)]="supplycharesteristic.meansEarthing">
                   <option value="" selected>Select Option</option>
                    <option *ngFor="let value of MeansofEarthingList"> {{value}}</option>
                  </select>
                  <div *ngIf="submitted && f.meansEarthing.errors" class="invalid-feedback">
                    <div *ngIf="f.meansEarthing?.errors?.required">Field Is Required</div>
                  </div>
                </div>
              </div>
<div class="row">
  <div class="col-md-4" *ngIf="f.meansEarthing?.value=='Others'">
    <mat-form-field class="client-description">
      <mat-icon style="float: right;font-size: 18px;
      line-height: unset;margin-right: 87%;margin-top: 0.7%;"
      matTooltip="If prospective fault current (4.3) obtained is more than current for disconnection within 0.2 sec (5.3) then circuit is said to be safe otherwise unsafe."
      matTooltipClass="multiline-tooltip"
      aria-label="Button that shows a red tooltip"
      class="example-button">
      info_outline
     </mat-icon>
      <mat-label>
        <h3>Remarks</h3>
      </mat-label>
      <textarea matInput class="client-box-description" [readonly]="service.allFieldsDisable" formControlName="meansEarthingRemark" [(ngModel)]="supplycharesteristic.meansEarthingRemark"
      [ngClass]="{ 'is-invalid': submitted && f.meansEarthingRemark?.errors }" 
      maxlength="500" 
      placeholder="Ex. Remarks ..." ></textarea>
    </mat-form-field>
    <div *ngIf="submitted && f.meansEarthingRemark?.errors" class="invalid-feedback">
      <div *ngIf="f.meansEarthingRemark?.errors?.required">Field Is Required</div>
    </div>
  </div>
</div>

              <div class="row" style="margin-top: 30px" [ngClass]="{'disableForm':service.allFieldsDisable}">

                <div class="col-md-4">
                  <label>Type of earthing  :</label>
                  <select class="form-control" formControlName="electrodeType" [disabled]="service.allFieldsDisable" [tabindex]="service.allFieldsDisable ? -1 : 0"
                  [ngClass]="{ 'is-invalid': submitted && f.electrodeType.errors }" [(ngModel)]="supplycharesteristic.electrodeType">
                   <option value="" selected>Select Option</option>
                    <option *ngFor="let value of  electrodeTypeList"> {{value}}</option>
                  </select>
                  <div *ngIf="submitted && f.electrodeType.errors" class="invalid-feedback">
                    <div *ngIf="f.electrodeType?.errors?.required">Field Is Required</div>
                  </div>
                </div>

                
                <!-- <div class="col-md-4">
                  <label>Material Of Earth Electrode:</label>
                  <select class="form-control" formControlName="electrodeMaterial" 
                  [ngClass]="{ 'is-invalid': submitted && f.electrodeMaterial.errors }" 
                  [(ngModel)]="supplycharesteristic.electrodeMaterial">
                   <option value="" selected>Select Option</option>
                    <option *ngFor="let value of  electrodeMaterialList"> {{value}}</option>
                  </select>
                  <div *ngIf="submitted && f.electrodeMaterial.errors" class="invalid-feedback">
                    <div *ngIf="f.electrodeMaterial?.errors?.required">Field Is Required</div>
                  </div>
                </div> -->

                <div class="col-md-4" style="margin-top: 30px">
                  <p class="joints">Number of earth electrodes 
                    <input (keypress)="keyPressNumbers($event)" type="number" min="0" formControlName="noOfLocation" [readonly]="service.allFieldsDisable"
                    [ngClass]="{ 'is-invalid': submitted && f.noOfLocation.errors }" 
                    [(ngModel)]="supplycharesteristic.noOfLocation" style="
                    width: 50px;
                    background: transparent;
                    border: none;
                    border-bottom: 1px solid #000000;" (keyup)="onKey1($event)"></p>
                    <div *ngIf="submitted && f.noOfLocation.errors" class="invalid-feedback">
                      <div *ngIf="f.noOfLocation?.errors?.required">Location number is required</div>
                      <!-- <div *ngIf="f.noOfLocation?.errors?.min">Please enter value above 0</div> -->
                    </div>
                </div>
              </div>
            <br>
            <div class="row" *ngIf="key1LocationTable" [ngClass]="{'disableForm':service.allFieldsDisable}">
              <div class="col-sm-12">
                <h2>Earth electrode details</h2>
                  <div class="table-responsive" style="border: 1px solid black">
                    <table class="table">
                      <thead>
                        <tr align="center">
                          <th>Location No</th>
                          <th>Location Name</th>
                          <th>Type of earth electrode (rod / pipe / flat / chemical pipe) </th>
                          <th>Material of earth electrode (copper/ copper bonded steel/ galvanised steel/ galvanised iron/ cast iron)</th>
                          <th>Size(diameter) of earth electrode (mm) </th>
                          <th>Depth/ length of earth electrode (m) </th>
                          <th>Electrode resistance to earth (Ω) </th>
                          <th>Electrode resistance to grid (Ω) </th>
                          
                        </tr>
                      </thead>
                      <tbody formArrayName="location1Arr" *ngFor="let a of getLocation1Controls(); let i = index">
                        <tr [formGroupName]="i">
                          <td><input type="number" min=1  formControlName="locationNo" class="form-control"  [readonly]="service.allFieldsDisable"
                            [ngClass]="{ 'is-invalid': submitted && a.get('locationNo')?.errors }" placeholder="Enter location number">
                            <div *ngIf="submitted && a.get('locationNo')?.errors" class="invalid-feedback">
                              <div *ngIf="a.get('locationNo')?.errors?.required">Location number is required</div>
                            </div></td>
                          <td><input type="text" formControlName="locationName" class="form-control" [readonly]="service.allFieldsDisable"
                            [ngClass]="{ 'is-invalid': submitted && a.get('locationName')?.errors }" placeholder="Enter location name" >
                            <div *ngIf="submitted && a.get('locationName')?.errors" class="invalid-feedback">
                              <div *ngIf="a.get('locationName')?.errors?.required">Location name is required</div>
                            </div></td>
                            <td> <input type="tel" min="0"  formControlName="electrodeEarthType" class="form-control"  [readonly]="service.allFieldsDisable"
                              [ngClass]="{ 'is-invalid': submitted && a.get('electrodeEarthType')?.errors }" 
                              placeholder="Enter electrode earth type">
                              <div *ngIf="submitted && a.get('electrodeEarthType')?.errors" class="invalid-feedback">
                                <div *ngIf="a.get('electrodeEarthType')?.errors?.required">Field Is Required</div>
                              </div></td>
                          <td> <input type="tel" min="0"  formControlName="electrodeEarthMaterial" class="form-control"  [readonly]="service.allFieldsDisable"
                            [ngClass]="{ 'is-invalid': submitted && a.get('electrodeEarthMaterial')?.errors }" 
                            placeholder="Enter electrode earth material" >
                            <div *ngIf="submitted && a.get('electrodeEarthMaterial')?.errors" class="invalid-feedback">
                              <div *ngIf="a.get('electrodeEarthMaterial')?.errors?.required">Field Is Required</div>
                            </div></td>
                          <td> <input type="tel" min="0"  formControlName="electrodeEarthSize" class="form-control" [readonly]="service.allFieldsDisable"
                            [ngClass]="{ 'is-invalid': submitted && a.get('electrodeEarthSize')?.errors }" 
                            placeholder="Enter electrode earth size" >
                            <div *ngIf="submitted && a.get('electrodeEarthSize')?.errors" class="invalid-feedback">
                              <div *ngIf="a.get('electrodeEarthSize')?.errors?.required">Field Is Required</div>
                            </div></td>
                          <td> <input type="tel" min="0"  formControlName="electrodeEarthDepth" class="form-control" [readonly]="service.allFieldsDisable" 
                            [ngClass]="{ 'is-invalid': submitted && a.get('electrodeEarthDepth')?.errors }" 
                            placeholder="Enter electrode earth depth">
                            <div *ngIf="submitted && a.get('electrodeEarthDepth')?.errors" class="invalid-feedback">
                              <div *ngIf="a.get('electrodeEarthDepth')?.errors?.required">Field Is Required</div>
                            </div></td>
                            <td><input type="number" min="0"  formControlName="electrodeResistanceEarth" class="form-control" 
                              [readonly]="service.allFieldsDisable" 
                              [ngClass]="{ 'is-invalid': submitted && a.get('electrodeResistanceEarth')?.errors }" 
                              placeholder="Enter electrode resistance" [value]="a.get('electrodeResistanceEarth')?.value">
                              <div *ngIf="submitted && a.get('electrodeResistanceEarth')?.errors" class="invalid-feedback">
                                <div *ngIf="a.get('electrodeResistanceEarth')?.errors?.required">Field Is Required</div>
                              </div></td>
                            <td><input type="number" min="0" formControlName="electrodeResistanceGird" class="form-control" [readonly]="service.allFieldsDisable"
                              [ngClass]="{ 'is-invalid': submitted && a.get('electrodeResistanceGird')?.errors }" [value]="a.get('electrodeResistanceGird')?.value"
                              placeholder="Enter electrode resistance">
                              <div *ngIf="submitted && a.get('electrodeResistanceGird')?.errors" class="invalid-feedback">
                                <div *ngIf="a.get('electrodeResistanceGird')?.errors?.required">Field Is Required</div>
                              </div>
                            </td>

                            <mat-icon class="mousechange" class="dlt" type="button" title="Delete" [ngClass]="{'disableForm':service.allFieldsDisable}" (click)="removeItem(a,i)" style="margin-top: 15px;font-size: x-large;height: auto;width: auto;" >remove_circle_outline</mat-icon>
                            
                        </tr>
                      </tbody>  
                    </table>
                  </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">	
                <mat-form-field class="client-description">	
                  <mat-label>	
                    <h3>Earth Electrode - Observations</h3>	
                  </mat-label>	
                  <textarea matInput class="client-box-description" formControlName="earthElectrodeObservation" 	
                  [ngClass]="{ 'is-invalid': submitted && f.earthElectrodeObservation?.errors }" 	[(ngModel)]="earthElectrodeObservation"
                  maxlength="500" 	
                  placeholder="Ex. Observations ..." ></textarea>	
                </mat-form-field>	
                <div *ngIf="submitted && f.earthElectrodeObservation?.errors" class="invalid-feedback">	
                  <div *ngIf="f.earthElectrodeObservation?.errors?.required">Field Is Required</div>	
                </div>	
              </div>
            </div>
            </mat-expansion-panel>

            <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h3>Details Of Main Protective Conductor</h3>
                </mat-panel-title>
              </mat-expansion-panel-header>

              <div class="form-group" [ngClass]="{'disableForm':service.allFieldsDisable}">
                <div class="row">
                  <div class="col-md-4" style="margin-top: 57px">
                    <mat-icon style="float: right;font-size: 18px;
                    line-height: unset;margin-right: 25%;"
                    matTooltip="Earthing conductor is used for connection from MET to means of earthing (earth electrode or towards source neutral)."
                    matTooltipClass="multiline-tooltip"
                    aria-label="Button that shows a red tooltip"
                    class="example-button">
                    info_outline
                   </mat-icon>
                    <p>Size of Earthing Conductor <input type="number" min="0" formControlName="conductorSize" [readonly]="service.allFieldsDisable"
                    [ngClass]="{ 'is-invalid': submitted && f.conductorSize.errors }" [(ngModel)]="supplycharesteristic.conductorSize" 
                    style="
                      width: 50px;
                      background: transparent;
                      border: none;
                      border-bottom: 1px solid #000000;"> sq.mm</p>
                      <div *ngIf="submitted && f.conductorSize.errors" class="invalid-feedback">
                        <div *ngIf="f.conductorSize?.errors?.required">Field Is Required</div>
                      </div>
                  </div>

                  <div class="col-md-4">
                    <label>Material Of Earthing Conductor:</label>
                    <mat-icon style="float: right;font-size: 18px;
                    line-height: unset;margin-right: 42%;"
                    matTooltip="Copper / aluminium / galvanised iron"
                    matTooltipClass="multiline-tooltip"
                    aria-label="Button that shows a red tooltip"
                    class="example-button">
                    info_outline
                   </mat-icon>
                    <input type="text"  class="form-control" formControlName="conductormaterial" [readonly]="service.allFieldsDisable"
                    [ngClass]="{ 'is-invalid': submitted && f.conductormaterial.errors }" [(ngModel)]="supplycharesteristic.conductormaterial">
                    <div *ngIf="submitted && f.conductormaterial.errors" class="invalid-feedback">
                      <div *ngIf="f.conductormaterial?.errors?.required">Field Is Required</div>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <label>Continuity and connection of earthing conductor is verified:</label>
                    <mat-icon style="float: right;font-size: 18px;
                    line-height: unset;"
                    matTooltip="Physical check up. If the wires are not traceable and a test can not be conducted during initial inspection select NO."
                    matTooltipClass="multiline-tooltip"
                    aria-label="Button that shows a red tooltip"
                    class="example-button">
                    info_outline
                   </mat-icon>
                    <select class="form-control" formControlName="conductorVerify" [disabled]="service.allFieldsDisable" 
                    [tabindex]="service.allFieldsDisable ? -1 : 0" [ngClass]="{ 'is-invalid': submitted && f.conductorVerify.errors }" [(ngModel)]="supplycharesteristic.conductorVerify">
                     <option value="" selected>Select Option</option>
                      <option *ngFor="let value of  earthingConductorVerifyList"> {{value}}</option>
                    </select>
                    <div *ngIf="submitted && f.conductorVerify.errors" class="invalid-feedback">
                      <div *ngIf="f.conductorVerify?.errors?.required">Field Is Required</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group" [ngClass]="{'disableForm':service.allFieldsDisable}">
                <div class="row">
                  <div class="col-md-4" style="margin-top: 30px">
                    <mat-icon style="float: right;font-size: 18px;
                    line-height: unset;"
                    matTooltip="Main protective bonding conductor is used to bond between MET and extraneous conductive parts 
                    entering the building (eg. Metal water pipes, gas pipes, steel structure, lightning protection etc.). 
                    If there is no such bonding available, make the answer “0”."
                    matTooltipClass="multiline-tooltip"
                    aria-label="Button that shows a red tooltip"
                    class="example-button">
                    info_outline
                   </mat-icon>
                    <p>Size of Main Protective Bonding Conductor <input type="number" [readonly]="service.allFieldsDisable" min="0" formControlName="bondingConductorSize" 
                    [ngClass]="{ 'is-invalid': submitted && f.bondingConductorSize.errors }" [(ngModel)]="supplycharesteristic.bondingConductorSize" style="
                      width: 50px;
                      background: transparent;
                      border: none;
                      border-bottom: 1px solid #000000;"> sq.mm</p>
                      <div *ngIf="submitted && f.bondingConductorSize.errors" class="invalid-feedback">
                        <div *ngIf="f.bondingConductorSize?.errors?.required">Field Is Required</div>
                      </div>
                  </div>

                  <div class="col-md-4">
                    <label>Material Of Main Protective Bonding Conductor:</label>
                    <mat-icon style="float: right;font-size: 18px;
                    line-height: unset;margin-right: 17%;"
                    matTooltip="Copper / aluminium"
                    matTooltipClass="multiline-tooltip"
                    aria-label="Button that shows a red tooltip"
                    class="example-button">
                    info_outline
                   </mat-icon>
                    <input type="text"  class="form-control" formControlName="bondingConductorMaterial" [readonly]="service.allFieldsDisable"
                    [ngClass]="{ 'is-invalid': submitted && f.bondingConductorMaterial.errors }" 
                    [(ngModel)]="supplycharesteristic.bondingConductorMaterial">
                    <div *ngIf="submitted && f.bondingConductorMaterial.errors" class="invalid-feedback">
                      <div *ngIf="f.bondingConductorMaterial?.errors?.required">Field Is Required</div>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <label>Main Protective Bonding Conductor Continuity And Connection Verified:</label>
                    <select class="form-control" formControlName="bondingConductorVerify" [disabled]="service.allFieldsDisable" [tabindex]="service.allFieldsDisable ? -1 : 0"
                    [ngClass]="{ 'is-invalid': submitted && f.bondingConductorVerify.errors }" [(ngModel)]="supplycharesteristic.bondingConductorVerify">
                     <option value="" selected>Select Option</option>
                      <option *ngFor="let value of bondingConductorVerifyList"> {{value}}</option>
                    </select>
                    <div *ngIf="submitted && f.bondingConductorVerify.errors" class="invalid-feedback">
                      <div *ngIf="f.bondingConductorVerify?.errors?.required">Field Is Required</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group" [ngClass]="{'disableForm':service.allFieldsDisable}">
                <div class="row">
                  <div class="col-md-4" style="margin-top: 30px">
                    <mat-icon style="float: right;font-size: 18px;
                    line-height: unset;margin-right: 49%;"
                    matTooltip="If number of joints is given, then point 8 & 9 should come."
                    matTooltipClass="multiline-tooltip"
                    aria-label="Button that shows a red tooltip"
                    class="example-button">
                    info_outline
                   </mat-icon>
                    <p  class="joints">Number Of Joints
                      <input (keypress)="keyPressNumbers($event)" type="number" formControlName="bondingNoOfJoints" [readonly]="service.allFieldsDisable"
                      [(ngModel)]="supplycharesteristic.bondingNoOfJoints" 
                      [ngClass]="{ 'is-invalid': submitted && f.bondingNoOfJoints.errors }" style="
                      width: 50px;
                      background: transparent;
                      border: none;
                      border-bottom: 1px solid #000000;" (keyup)="onKey($event)"
                      ></p>
                      <div *ngIf="submitted && f.bondingNoOfJoints.errors" class="invalid-feedback">
                        <div *ngIf="f.bondingNoOfJoints?.errors?.required">Number of joints is required</div>
                        <!-- <div *ngIf="f.bondingNoOfJoints?.errors?.min">Please enter value above 0</div> -->
                      </div>
                  </div>
                  <div class="col-md-4" style="margin-top: 30px" *ngIf="JointLocationTable">
                    <label>Type Of Joint:</label>
                    <mat-icon style="float: right;font-size: 18px;
                    line-height: unset;margin-right: 70%;"
                    matTooltip="Exothermic / connectors / bolt / ferrule / hand tight"
                    matTooltipClass="multiline-tooltip"
                    aria-label="Button that shows a red tooltip"
                    class="example-button">
                    info_outline
                   </mat-icon>
                    <input type="text"  class="form-control" formControlName="bondingJointsType" [readonly]="service.allFieldsDisable"
                    [ngClass]="{ 'is-invalid': submitted && f.bondingJointsType.errors }" 
                    [(ngModel)]="supplycharesteristic.bondingJointsType">
                    <!-- <p>Type Of Joints (Impairing Safety) 
                      <input type="text" formControlName="bondingJointsType" 
                    [ngClass]="{ 'is-invalid': submitted && f.bondingJointsType.errors }" 
                    [(ngModel)]="supplycharesteristic.bondingJointsType" style="
                      width: 50px;
                      background: transparent;
                      border: none;
                      border-bottom: 1px solid #000000;">
                    </p> -->
                    <div *ngIf="submitted && f.bondingJointsType.errors" class="invalid-feedback">
                      <div *ngIf="f.bondingJointsType?.errors?.required">Field Is Required</div>
                    </div>
                  </div>
                  <!-- (blur)="update(box.value)" (keyup)="onKey($event)"-->
                </div>
              </div>
               <div *ngIf="JointLocationTable"> 
              <div class="row" [ngClass]="{'disableForm':service.allFieldsDisable}">
                <div class="col-sm-12">
                <h2>Joint resistance details</h2>
                <!-- <mat-icon class="mousechange" (click)="addLocation2()" style=" padding-top: 5px;">add_box</mat-icon> -->
              </div>
              </div>

              <div class="row" [ngClass]="{'disableForm':service.allFieldsDisable}">
                <div class="col-md-3">
                  <label style="text-align: center;">Location</label>
                </div>
                <div class="col-md-3">
                  <label style="text-align: center;">Joint No</label>
                </div>
                <div class="col-md-3">
                  <label style="text-align: center;">Joint Reference</label>
                </div>
                <div class="col-md-3">
                  <label style="text-align: center;">Joint Resistance (Ω)</label>
                </div>
              </div>

              <div formArrayName="location2Arr" *ngFor="let a of getLocation2Controls(); let i = index">
                <div class="form-group" [formGroupName]="i" [ngClass]="{'disableForm':service.allFieldsDisable}">
                  <div class="row">
                    <div class="col-md-3">
                      <input type="text"  formControlName="location" class="form-control"  [readonly]="service.allFieldsDisable"
                      [ngClass]="{ 'is-invalid': submitted && a.get('location')?.errors }" placeholder="Enter location" >
                      <div *ngIf="submitted && a.get('location')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('location')?.errors?.required">Location is required</div>
                      </div>
                    </div>

                    <div class="col-md-3">
                      <input type="number" min="0" [readonly]="service.allFieldsDisable" formControlName="jointNo" class="form-control"  [ngClass]="{ 'is-invalid': submitted && a.get('jointNo')?.errors }" placeholder="Enter Joint No" >
                      <div *ngIf="submitted && a.get('jointNo')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('jointNo')?.errors?.required">Joint number is required</div>
                      </div>
                    </div>

                    <div class="col-md-3">
                      <input type="text" [readonly]="service.allFieldsDisable" formControlName="jointReference" class="form-control"  
                      [ngClass]="{ 'is-invalid': submitted && a.get('jointReference')?.errors }" placeholder="Enter Joint Reference" >
                      <div *ngIf="submitted && a.get('jointReference')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('jointReference')?.errors?.required">Joint reference is required</div>
                      </div>
                    </div>

                    <div class="col-md-3">
                      <input type="number" min="0" [readonly]="service.allFieldsDisable" formControlName="jointResistance" class="form-control"  [ngClass]="{ 'is-invalid': submitted && a.get('jointResistance')?.errors }" placeholder="Enter Joint resistance" >
                      <div *ngIf="submitted && a.get('jointResistance')?.errors" class="invalid-feedback">
                        <div *ngIf="a.get('jointResistance')?.errors?.required">Joint resistance is required</div>
                      </div>
                    </div>
            
                      <mat-icon class="mousechange" class="dlt" type="button" title="Delete" [ngClass]="{'disableForm':service.allFieldsDisable}" (click)="removeItem1(a,i)" style="font-size: x-large;margin-left: 99%;margin-top: -24px; width: 10%;">remove_circle_outline</mat-icon>
                   
                  </div>
                </div>
              </div>
              </div>
              <div class="row">
                <div class="col-md-4">	
                  <mat-form-field class="client-description">	
                    <mat-label>	
                      <h3>Bonding Conductor - Observations</h3>	
                    </mat-label>	
                    <textarea matInput class="client-box-description" formControlName="bondingConductorObservation" 	
                    [ngClass]="{ 'is-invalid': submitted && f.bondingConductorObservation?.errors }" 	[(ngModel)]="bondingConductorObservation"
                    maxlength="500" 	
                    placeholder="Ex. Observations ..." ></textarea>	
                  </mat-form-field>	
                  <div *ngIf="submitted && f.bondingConductorObservation?.errors" class="invalid-feedback">	
                    <div *ngIf="f.bondingConductorObservation?.errors?.required">Field Is Required</div>	
                  </div>	
                </div>
              </div>
              <div class="form-group" [ngClass]="{'disableForm':service.allFieldsDisable}">
                <div class="row">
                  <div class="col-md-4" style="margin-top: 30px">
                    <mat-icon style="float: right;font-size: 18px;
                    line-height: unset;"
                    matTooltip="Main protective earthing conductor is used for connection MET to downstream sub DB’s equipment."
                    matTooltipClass="multiline-tooltip"
                    aria-label="Button that shows a red tooltip"
                    class="example-button">
                    info_outline
                   </mat-icon>
                    <p>Size of Main Protective Earthing Conductor<input type="number" min="0"[readonly]="service.allFieldsDisable" formControlName="earthingConductorSize" 
                    [ngClass]="{ 'is-invalid': submitted && f.earthingConductorSize.errors }" [(ngModel)]="supplycharesteristic.earthingConductorSize" style="
                      width: 50px;
                      background: transparent;
                      border: none;
                      border-bottom: 1px solid #000000;"> Sq.mm</p>
                      <div *ngIf="submitted && f.earthingConductorSize.errors" class="invalid-feedback">
                        <div *ngIf="f.earthingConductorSize?.errors?.required">Field Is Required</div>
                      </div>
                  </div>

                  <div class="col-md-4">
                    <label>Material of Main Protective Earthing Conductor:</label>
                    <mat-icon style="float: right;font-size: 18px;
                    line-height: unset;margin-right: 17%;"
                    matTooltip="Copper / aluminium"
                    matTooltipClass="multiline-tooltip"
                    aria-label="Button that shows a red tooltip"
                    class="example-button">
                    info_outline
                   </mat-icon>
                    <input type="text"  class="form-control" [readonly]="service.allFieldsDisable" formControlName="earthingConductorMaterial"  
                    [ngClass]="{ 'is-invalid': submitted && f.earthingConductorMaterial.errors }" [(ngModel)]="supplycharesteristic.earthingConductorMaterial">
                    <div *ngIf="submitted && f.earthingConductorMaterial.errors" class="invalid-feedback">
                      <div *ngIf="f.earthingConductorMaterial?.errors?.required">Field Is Required</div>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <label>Main Protective Conductor Continuity and Connection Verified:</label>
                    <select class="form-control" formControlName="earthingConductorVerify" [disabled]="service.allFieldsDisable" [tabindex]="service.allFieldsDisable ? -1 : 0"
                    [ngClass]="{ 'is-invalid': submitted && f.earthingConductorVerify.errors }" [(ngModel)]="supplycharesteristic.earthingConductorVerify">
                     <option value="" selected>Select Option</option>
                      <option *ngFor="let value of conductorVerifyList"> {{value}}</option>
                    </select>
                    <div *ngIf="submitted && f.earthingConductorVerify.errors" class="invalid-feedback">
                      <div *ngIf="f.earthingConductorVerify?.errors?.required">Field Is Required</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group" [ngClass]="{'disableForm':service.allFieldsDisable}">
                <div class="row">
                  <div class="col-md-4" style="margin-top: 30px">
                    <mat-icon style="float: right;font-size: 18px;
                    line-height: unset;margin-right: 50%;"
                    matTooltip="If number of joints is given, then point 14 & 15 should come."
                    matTooltipClass="multiline-tooltip"
                    aria-label="Button that shows a red tooltip"
                    class="example-button">
                    info_outline
                   </mat-icon>
                    <p class="joints">Number Of Joints <input (keypress)="keyPressNumbers($event)" type="number" min="0" formControlName="earthingNoOfJoints" 
                    [ngClass]="{ 'is-invalid': submitted && f.earthingNoOfJoints.errors }" [readonly]="service.allFieldsDisable"
                    [(ngModel)]="supplycharesteristic.earthingNoOfJoints" style="
                      width: 50px;
                      background: transparent;
                      border: none;
                      border-bottom: 1px solid #000000;" (keyup)="onKey3($event)"></p>
                      <div *ngIf="submitted && f.earthingNoOfJoints.errors" class="invalid-feedback">
                        <div *ngIf="f.earthingNoOfJoints?.errors?.required">Field Is Required</div>
                        <!-- <div *ngIf="f.earthingNoOfJoints?.errors?.min">Please enter value above 0</div> -->
                      </div>
                  </div>
                  <div class="col-md-4" style="margin-top: 30px" *ngIf="keyJOintLocationTable" >
                    <label>Type Of Joint:</label>
                    <mat-icon style="float: right;font-size: 18px;
                    line-height: unset;margin-right: 70%;"
                    matTooltip="Exothermic / connectors / bolt / ferrule / hand tight"
                    matTooltipClass="multiline-tooltip"
                    aria-label="Button that shows a red tooltip"
                    class="example-button">
                    info_outline
                   </mat-icon>
                    <input type="text"  class="form-control" formControlName="earthingJointsType" [readonly]="service.allFieldsDisable"
                    [ngClass]="{ 'is-invalid': submitted && f.earthingJointsType.errors }" 
                    [(ngModel)]="supplycharesteristic.earthingJointsType">
                    <!-- <p>Type of Joints<input type="number" min="0" formControlName="earthingJointsType" 
                    [ngClass]="{ 'is-invalid': submitted && f.earthingJointsType.errors }" 
                    [(ngModel)]="supplycharesteristic.earthingJointsType" style="
                      width: 50px;
                      background: transparent;
                      border: none;
                      border-bottom: 1px solid #000000;">
                    </p> -->
                    <div *ngIf="submitted && f.earthingJointsType.errors" class="invalid-feedback">
                      <div *ngIf="f.earthingJointsType?.errors?.required">Field Is Required</div>
                    </div>
                  </div>
                  <!-- (keyup)="keyUpJoint($event)" -->
                </div>
              </div>
              <div *ngIf="keyJOintLocationTable">
                <div class="row" [ngClass]="{'disableForm':service.allFieldsDisable}">
                  <div class="col-sm-12">
                  <h2>Location Table</h2>
                  </div>
                  <!-- <mat-icon class="mousechange" (click)="addLocation3()" style=" padding-top: 5px;">add_box</mat-icon> -->
                </div>
  
                <div class="row" [ngClass]="{'disableForm':service.allFieldsDisable}">
                  <div class="col-md-3">
                    <label style="text-align: center;">Location</label>
                  </div>
                  <div class="col-md-3">
                    <label style="text-align: center;">Joint No</label>
                  </div>
                  <div class="col-md-3">
                    <label style="text-align: center;">Joint Reference</label>
                  </div>
                  <div class="col-md-3">
                    <label style="text-align: center;">Joint Resistance (Ω)</label>
                  </div>
                </div>
  
                <div formArrayName="location3Arr" *ngFor="let a of getLocation3Controls(); let i = index">
                  <div class="form-group" [formGroupName]="i" [ngClass]="{'disableForm':service.allFieldsDisable}">
                    <div class="row">
                      <div class="col-md-3">
                        <input type="text"  formControlName="location" class="form-control" [readonly]="service.allFieldsDisable" [ngClass]="{ 'is-invalid': submitted && a.get('location')?.errors }" placeholder="Enter location" >
                        <div *ngIf="submitted && a.get('location')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('location')?.errors?.required">Location is required</div>
                        </div>
                      </div>
  
                      <div class="col-md-3">
                        <input type="number" min="0"  formControlName="jointNo" [readonly]="service.allFieldsDisable" class="form-control" [ngClass]="{ 'is-invalid': submitted && a.get('jointNo')?.errors }" placeholder="Enter Joint No" >
                        <div *ngIf="submitted && a.get('jointNo')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('jointNo')?.errors?.required">Joint number is required</div>
                        </div>
                      </div>
  
                      <div class="col-md-3">
                        <input type="text" formControlName="jointReference" class="form-control"  [readonly]="service.allFieldsDisable"
                        [ngClass]="{ 'is-invalid': submitted && a.get('jointReference')?.errors }" placeholder="Enter Joint Reference" >
                        <div *ngIf="submitted && a.get('jointReference')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('jointReference')?.errors?.required">Joint reference is required</div>
                        </div>
                      </div>

                      
                      <div class="col-md-3">
                        <input type="number" min="0"  formControlName="jointResistance" class="form-control" [readonly]="service.allFieldsDisable" [ngClass]="{ 'is-invalid': submitted && a.get('jointResistance')?.errors }" placeholder="Enter Joint resistance" >
                        <div *ngIf="submitted && a.get('jointResistance')?.errors" class="invalid-feedback">
                          <div *ngIf="a.get('jointResistance')?.errors?.required">Field Is Required</div>
                        </div>
                      </div>

                        <mat-icon class="mousechange" class="dlt" type="button" title="Delete" [ngClass]="{'disableForm':service.allFieldsDisable}" (click)="removeItem2(a,i)" style="margin-top: -24px;margin-left: 99%;font-size: x-large; width: 10%;">remove_circle_outline</mat-icon>

                    </div>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-4">	
                  <mat-form-field class="client-description">	
                    <mat-label>	
                      <h3>Earthing Conductor - Observations</h3>	
                    </mat-label>	
                    <textarea matInput class="client-box-description" formControlName="earthingConductorObservation" 	
                    [ngClass]="{ 'is-invalid': submitted && f.earthingConductorObservation?.errors }" 	[(ngModel)]="earthingConductorObservation"
                    maxlength="500" 	
                    placeholder="Ex. Observations ..." ></textarea>	
                  </mat-form-field>	
                  <div *ngIf="submitted && f.earthingConductorObservation?.errors" class="invalid-feedback">	
                    <div *ngIf="f.earthingConductorObservation?.errors?.required">Field Is Required</div>	
                  </div>	
                </div>
              </div>
            </mat-expansion-panel>

                <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      <h3>Details Of Main Switch or Circuit Breaker</h3>
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <div formArrayName="circuitArr" *ngFor="let a of getCircuitControls(); let i = index">
                    <div class="form-group" [formGroupName]="i" [ngClass]="{'disableForm':service.allFieldsDisable}">
                      <h2>Details Of Circuit Breaker</h2>

                      <div class="row">
                        <div class="col-md-4">
                          <label>Location:</label>
                          <input type="text" [readonly]="service.allFieldsDisable"  formControlName="location" class="form-control" [ngClass]="{ 'is-invalid': submitted && a.get('location')?.errors }" placeholder="Enter Location" >
                          <div *ngIf="submitted && a.get('location')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('location')?.errors?.required">Location is required</div>
                          </div>
                        </div>

                     
                          <div class="col-md-4">
                            <label>Source Name:</label>

                            <mat-icon style="float: right; font-size: 18px; margin-right: 69%; padding: 1px;" matTooltip="Mains Incoming shortname value from Supply Characteristics" matTooltipClass="multiline-tooltip"> info_outline </mat-icon>

                            <!-- <input type="text" [readonly]="service.allFieldsDisable" formControlName="sourceName" class="form-control" [(ngModel)]="supplycharesteristic.shortName" [ngClass]="{ 'is-invalid': submitted && a.get('sourceName')?.errors }" > -->

                            <textarea cols="60" rows="1" type="text" formControlName="sourceName" class="form-control" [ngClass]="{ 'is-invalid': submitted && a.get('sourceName')?.errors }" readonly></textarea>

                            <div *ngIf="submitted && a.get('sourceName')?.errors" class="invalid-feedback">
                              <div *ngIf="a.get('sourceName')?.errors?.required">Source Name is required</div>
                            </div>
                          </div>
                 

                 
                          <div class="col-md-4">
                            <label>Make:</label>
                            <mat-icon style="float: right; font-size: 18px; margin-right: 83%; padding: 1px;" matTooltip="Manufacturer’s name" matTooltipClass="multiline-tooltip"> info_outline </mat-icon>
                            <input type="text" [readonly]="service.allFieldsDisable" formControlName="make" class="form-control" [ngClass]="{ 'is-invalid': submitted && a.get('make')?.errors }" >
                            <div *ngIf="submitted && a.get('make')?.errors" class="invalid-feedback">
                              <div *ngIf="a.get('make')?.errors?.required">Make is required</div>
                            </div>
                          </div>
               

                     
                          <div class="col-md-4">
                            <label>Model / Current curve:</label>
                            <mat-icon style="float: right; font-size: 18px; margin-right: 56%; padding: 1px;" matTooltip="MCB Type B / C / D / K / Z & others specify manufacturer’s model" matTooltipClass="multiline-tooltip"> info_outline </mat-icon>
                            <input type="text" [readonly]="service.allFieldsDisable" formControlName="currentCurve" class="form-control" [ngClass]="{ 'is-invalid': submitted && a.get('currentCurve')?.errors }" placeholder="Enter Model / Current curve" >
                            <div *ngIf="submitted && a.get('currentCurve')?.errors" class="invalid-feedback">
                              <div *ngIf="a.get('currentCurve')?.errors?.required">Model / Current curve is required</div>
                            </div>
                          </div>
                   

                        <div class="col-md-4">
                          <label>Type:</label>
                          <mat-icon style="float: right;font-size: 18px;
                          line-height: unset;margin-right: 82%;"
                          matTooltip="MCB/MCCB/RCBO/MCB with RCD/ACB with micrologic relay/ ACB with numerical protection relay (enter details of relay in case of ACB)."
                          matTooltipClass="multiline-tooltip"
                          aria-label="Button that shows a red tooltip"
                          class="example-button">
                          info_outline
                         </mat-icon>
                         <input type="text" [readonly]="service.allFieldsDisable" formControlName="type"
                         class="form-control" [ngClass]="{ 'is-invalid': submitted && a.get('type')?.errors }" 
                         placeholder="Enter Type" >
                          <!-- <select class="form-control" [disabled]="service.allFieldsDisable" formControlName="type" 
                          [tabindex]="service.allFieldsDisable ? -1 : 0" [ngClass]="{ 'is-invalid': submitted && a.get('type')?.errors }">
                           <option value="" selected>Select Option</option>
                            <option value="MCB">MCB</option>
                            <option value=" ACB"> ACB</option>
                            <option value="MCCB">MCCB</option> 
                            <option value="RCBO">RCBO</option>
                          </select> -->
                          <div *ngIf="submitted && a.get('type')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('type')?.errors?.required">If no value, then fill as NA</div>
                          </div>
                        </div>

                        <div class="col-md-4">
                          <label>No Of Poles:</label>
                          <mat-icon style="float: right;font-size: 18px;
                          line-height: unset;margin-right: 71%;"
                          matTooltip="1/ 2/ 3/ 4"
                          matTooltipClass="multiline-tooltip"
                          aria-label="Button that shows a red tooltip"
                          class="example-button">
                          info_outline
                         </mat-icon>
                          <input type="number" min="0" [readonly]="service.allFieldsDisable" class="form-control" formControlName="noPoles" [ngClass]="{ 'is-invalid': submitted && a.get('noPoles')?.errors }"  placeholder="Enter poles" >
                          <div *ngIf="submitted && a.get('noPoles')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('noPoles')?.errors?.required">Field Is Required</div>
                          </div>
                        </div>

                        <div class="col-md-4">
                          <label>Current Rating:</label>
                          <div class="input-group">
                            <input type="number" min="0" [readonly]="service.allFieldsDisable"  class="form-control" formControlName="current" [ngClass]="{ 'is-invalid': submitted && a.get('current')?.errors }" placeholder="Enter rating" >
                            <div class="input-group-prepend">
                              <span class="input-group-text">A</span>
                            </div>
                          </div>
                          <div *ngIf="submitted && a.get('current')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('current')?.errors?.required">Field Is Required</div>
                          </div>
                        </div>

                        <div class="col-md-4">
                          <label>Voltage Rating:</label>
                          <mat-icon style="float: right;font-size: 18px;
                          line-height: unset;margin-right: 68%;"
                          matTooltip="Rated voltage of the protective device."
                          matTooltipClass="multiline-tooltip"
                          aria-label="Button that shows a red tooltip"
                          class="example-button">
                          info_outline
                         </mat-icon>
                          <div class="input-group">
                            <input type="number" min="0"  [readonly]="service.allFieldsDisable" class="form-control" formControlName="voltage" [ngClass]="{ 'is-invalid': submitted && a.get('voltage')?.errors }" placeholder="Enter voltage" >
                            <div class="input-group-prepend">
                              <span class="input-group-text">V</span>
                            </div>
                          </div>
                          <div *ngIf="submitted && a.get('voltage')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('voltage')?.errors?.required">Field Is Required</div>
                          </div>
                        </div>

                        <div class="col-md-4">
                          <label>Fuse Rating or Settings:</label>
                          <mat-icon style="float: right;font-size: 18px;
                          line-height: unset;margin-right: 54%;"
                          matTooltip="Over current / Short circuit or earth fault setting."
                          matTooltipClass="multiline-tooltip"
                          aria-label="Button that shows a red tooltip"
                          class="example-button">
                          info_outline
                         </mat-icon>
                          <div class="input-group">
                            <input type="number" min="0" [readonly]="service.allFieldsDisable"  class="form-control" formControlName="fuse" [ngClass]="{ 'is-invalid': submitted && a.get('fuse')?.errors }" placeholder="Enter rating" >
                            <div class="input-group-prepend">
                              <span class="input-group-text">A</span>
                            </div>
                          </div>
                          <div *ngIf="submitted && a.get('fuse')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('fuse')?.errors?.required">Field Is Required</div>
                          </div>
                        </div>

                 
                          <div class="col-md-4">
                            <label>Type of residual current device:</label>
                            <mat-icon style="float: right; font-size: 18px; margin-right: 41%; padding: 1px;" matTooltip="Type A / Type AC / Type F / Type B" matTooltipClass="multiline-tooltip"> info_outline </mat-icon>
                            <input type="text" [readonly]="service.allFieldsDisable" formControlName="typeOfResidualCurrent" class="form-control" [ngClass]="{ 'is-invalid': submitted && a.get('typeOfResidualCurrent')?.errors }" placeholder="Enter Type of residual current device" >
                            <div *ngIf="submitted && a.get('typeOfResidualCurrent')?.errors" class="invalid-feedback">
                              <div *ngIf="a.get('typeOfResidualCurrent')?.errors?.required">Model / Current curve is required</div>
                            </div>
                          </div>

                        <div class="col-md-4" *ngIf="true">
                          <label>Rated residual operating current I∆n (mA):</label>
                          <mat-icon style="float: right;font-size: 18px; margin-right: 23%;"
                          matTooltip="30/100/300/500"
                          matTooltipClass="multiline-tooltip"
                          aria-label="Button that shows a red tooltip"
                          class="example-button">
                          info_outline
                         </mat-icon>
                          <div class="input-group">
                            <input type="text" min="0" [readonly]="service.allFieldsDisable"  class="form-control" formControlName="residualCurrent" [ngClass]="{ 'is-invalid': submitted && a.get('residualCurrent')?.errors }" placeholder="Enter value" >
                            <div class="input-group-prepend">
                              <span class="input-group-text">mA</span>
                            </div>
                          </div>
                          <div *ngIf="submitted && a.get('residualCurrent')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('residualCurrent')?.errors?.required">If no value, then fill as NA</div>
                          </div>
                        </div>

                        <div class="col-md-4" *ngIf="true">
                          <label>Measured operating time @I∆n (ms):</label>
                          <div class="input-group">
                            <input type="text" min="0" [readonly]="service.allFieldsDisable"  class="form-control" formControlName="residualTime" 
                            
                            [ngClass]="{ 'is-invalid': submitted && a.get('residualTime')?.errors }" placeholder="Enter value" >
                            <div class="input-group-prepend">
                              <span class="input-group-text">mS</span>
                            </div>
                          </div>
                          <div *ngIf="submitted && a.get('residualTime')?.errors" class="invalid-feedback">
                            <div *ngIf="a.get('residualTime')?.errors?.required">If no value, then fill as NA</div>
                          </div>
                        </div>

                      </div>
                    </div>
                  </div>


              </mat-expansion-panel>

<!-- comments start-->
  <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false" *ngIf="hideShowComment">
    <mat-expansion-panel-header>
      <mat-panel-title>
        <h3>Comments</h3>
      </mat-panel-title>
    </mat-expansion-panel-header>
   
   <mat-progress-spinner style="margin: 0 auto;" *ngIf="spinner"
  color="primary"
   [mode]="mode"
   value="50"
  diameter="50">
</mat-progress-spinner>

<div class="card-body" style="padding: 0px;" *ngIf="cardBodyComments">
<button class="btn dropdown" (click)="showSubmenu = !showSubmenu" style="width:100%;" 
*ngIf="(isExpanded || isShowing) || (toggleHideShow || getViewerCommentControls().length > 2)">
  <mat-icon class="menu-button" [ngClass]="{'rotated' : showSubmenu}" style="float: left;">chevron_right</mat-icon> 
  <label style="float: left;">Check comments here!</label>
 </button> 
 <span *ngIf="getViewerCommentControls().length==0">No comments!</span>
 <mat-icon class="mousechange" (click)="refreshCommentSection()" style="float: right;"
 title="Refresh comment">refresh</mat-icon> 

<div  formArrayName="viewerCommentArr" *ngFor="let a of getViewerCommentControls(); let i = index" 
style="margin-left: 10px;">
<div [formGroupName]="i" style="margin-left: 30px;">
<div class="submenu" [ngClass]="{'expanded' : showSubmenu}" [ngStyle]="{'display': showSubmenu ? 'block' : 'none'}">

  <div class="input-group" [ngClass]="{even: i!=0}" style="align-items: end;">
    <div class="input-group-prepend" title="Viewer" style="height: 26px;">
        <span class="input-group-text" style="line-height: unset;">
            <i class="bi bi-eye-fill"></i>
        </span>
    </div>
    <textarea cols="60" rows="1" formControlName="viewerComments" placeholder="Enter Viewer Comment">
   </textarea>

<div style="display: flex;margin-left: 25px;" *ngIf="replyCommentBox">

          <mat-icon class="mousechange" (click)="sendViewerComment(a)" [ngClass]="{'disable':disableSend== true}"
          *ngIf="((a.get('inspectorComments')?.value=='' || a.get('inspectorComments')?.value==null) && sendComment)"
          title="Send comment">send</mat-icon> &nbsp;&nbsp;&nbsp;&nbsp;

          <mat-icon class="mousechange" (click)="replyToViewerComment(a)" 
          *ngIf="((a.get('viewerComments')?.value!='') && (getViewerCommentControls().length-1 == i)) && hideAsViewerLogin "
         title="Reply comment">reply</mat-icon>&nbsp;&nbsp;&nbsp;&nbsp;

         <mat-icon class="mousechange" (click)="ViewerRemoveComment(i)" style="float:right;position: relative;left: 630%;"
         *ngIf="(a.get('inspectorComments')?.value=='' || a.get('viewerComments')?.value=='') && hideDelete" >delete</mat-icon>
         &nbsp;&nbsp;&nbsp;&nbsp;

        
  </div>
</div>


  <span [ngClass]="i!=0 ? 'viewer' : 'even1'">
    {{a.value.viewerUserName}} {{a.value.viewerDateTime | date:'dd-MM-YY hh:mm:ss a':'+0530'}}
  </span>  

<div *ngIf="replyCommentBox">

<ul style="list-style-type:none;margin-bottom: 0rem;">
<li> 

  <div class="input-group" style="align-items: end;"
  *ngIf="(a.get('inspectorComments')?.value!='' && a.get('inspectorComments')?.value!=null) || showReplyBox" >
    <div class="input-group-prepend" title="Inspector" style="height: 26px;">
        <span class="input-group-text" style="line-height: unset;">
            <i class="bi bi-person-fill"></i>
        </span>
    </div>
    <textarea cols="60" rows="1" placeholder="Enter Inspector Comment" formControlName="inspectorComments" ></textarea>
 <div style="display: initial;margin-left: 25px;">

     <mat-icon class="mousechange" (click)="inspectorComment(a)" [ngClass]="{'disable':disableReply== true}"
     *ngIf="(getViewerCommentControls().length-1 == i) && SendReply" title="Send reply">send</mat-icon>

     <mat-icon class="mousechange" (click)="approveComment(a)" [ngClass]="{'disable':enabledRequest== true}"
     *ngIf="((getViewerCommentControls().length-1 == i) && hideapprove) && a.value.approveOrReject != 'REJECT'"
     title="Approve comment">thumb_up_alt</mat-icon> &nbsp;&nbsp;&nbsp;&nbsp;

     <mat-icon class="mousechange" (click)="rejectComment(a)" 
     [ngClass]="{'disable':a.value.approveOrReject === 'REJECT' || enabledRequest== true}"

      *ngIf="((getViewerCommentControls().length-1 == i) && hideReject) || 
      ((a.get('inspectorComments')?.value!='' || a.get('viewerComments')?.value!='') && a.value.approveOrReject=='REJECT')"
     title="Reject comment">thumb_down_alt</mat-icon>

     

     <mat-icon class="mousechange" (click)="addAnotherviewerComment()"
     *ngIf="((getViewerCommentControls().length-1 == i) && hideAdd) 
     || ((a.value.approveOrReject === 'REJECT' && getViewerCommentControls().length-1 == i) && addReject)"
      style="float:right;position: relative;left: 718%;" title="Add another comment">add_box</mat-icon>

 </div>
</div>

 <span style="display: block;font-size: 11px;text-align: center;margin-left: -29%;">
  {{a.value.inspectorUserName}} {{a.value.inspectorDateTime | date:'dd-MM-YY hh:mm:ss a':'+0530'}}</span>  
       </li>
     </ul>
    </div> 
    </div>
    </div>
  </div> 
   
  </div>   
   
  </mat-expansion-panel>

<!-- completed comments start-->
<mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false" *ngIf="completedComments">
<mat-expansion-panel-header>
<mat-panel-title>
<h3>Completed Comments</h3>
</mat-panel-title>

</mat-expansion-panel-header>
<div class="card-body" style="padding: 0px;">
<div formArrayName="completedCommentArr1" *ngFor="let x of getCompletedCommentControls1(); let j = index" >
<div [formGroupName]="j">

<button class="btn dropdown" (click)="showHideAccordion(j);" style="width:100%;" 
*ngIf="(isExpanded || isShowing) || toggleHideShow || getCompletedCommentControls1().length >= 1">
  <mat-icon class="menu-button" style="float: left;">chevron_right</mat-icon> 
  <label style="float: left;">{{getViewerFirstMessage(x)}}...</label>
 </button> 

<div *ngIf="j === expandedIndexx" >
<div  formArrayName="completedCommentArr" *ngFor="let a of getCompletedCommentControls(x); let i = index" 
style="margin-left: 10px;" > 
<div [formGroupName]="i" style="margin-left: 30px;">
<div class="submenu" >

<div class="input-group" [ngClass]="{even: i!=0}" style="align-items: end;">
<div class="input-group-prepend" title="Viewer" style="height: 26px;">
    <span class="input-group-text" style="line-height: unset;">
        <i class="bi bi-eye-fill"></i>
    </span>
</div>
<textarea cols="60" rows="1"  formControlName="viewerComments" placeholder="Enter Viewer Comment">
</textarea>
</div>
<div>
<span [ngClass]="i!=0 ? 'viewer' : 'even1'">
{{a.value.viewerUserName}} 
{{a.value.viewerDateTime | date:'dd-MM-YY hh:mm:ss a':'+0530'}}
</span>  
</div>
<div class="input-group" style="margin-left: 41px;width: 50%;align-items: end;">
<div class="input-group-prepend" title="Inspector" style="height: 26px;">
<span class="input-group-text" style="line-height: unset;">
  <i class="bi bi-person-fill"></i>
</span>
</div>
<textarea cols="60" rows="1"  formControlName="inspectorComments" placeholder="Enter Viewer Comment"></textarea>
</div>

<span style="display: block;font-size: 11px;text-align: center;margin-left: -25%;">
{{a.value.inspectorUserName}} {{a.value.inspectorDateTime | date:'dd-MM-YY hh:mm:ss a':'+0530'}}</span>  
   
</div>
</div>
</div> 
</div>
</div>
</div>
</div>   

</mat-expansion-panel>
<!-- completed comments end-->

             </mat-accordion>
             <div *ngIf="validationError" style="text-align: center;margin-top: 30px;">
              <span class="alert alert-danger">{{validationErrorMsg}}</span>
             </div>
             <div *ngIf="commentSuccess" style="text-align: center;margin-top: 30px;">
              <span class="successshow">Your comment has been sent to Inspector</span>
            </div>
            <div *ngIf="commentApprove" style="text-align: center;margin-top: 30px;">
              <span class="alert alert-success">Your response to comments has been approved</span>
            </div>
            <div *ngIf="commentReject" style="text-align: center;margin-top: 30px;">
              <span class="alert alert-danger">Your response to comments has been rejected</span>
            </div>
            <br>
             <div style="text-align: center;margin-top: 40px;margin-left: 80px;">
              <!-- <button class="previous" mat-button matStepperPrevious *ngIf="service.backBtn">&laquo; Back</button> -->
              <button  class="next" (click)="gotoNextModal(content1,content2)" mat-button >Next &raquo;</button>
             </div>
    </form>
  </div>
</div>

<ng-template #content1 let-modal>

  <div class="modal-body">

 <div class="centre-text m-btm30">
  <div *ngIf="success" style="text-align: center;">
    <span class="successshow">{{successMsg}}</span>
   </div>
   <div *ngIf="Error" style="text-align: center;">
     <span class="errorshow">{{errorMsg}}</span>
    </div>
       </div>

   </div>
<br>
   <button type="button" class="close" class="btn btn-block btn-primary btn-rounded btn-md font-weight-medium auth-form-btn"
   aria-label="Close" (click)="closeModalDialog()" matStepperNext>
    <span aria-hidden="true">Ok</span>
</button>
</ng-template>

<ng-template #content2 let-modal>
  <div class="modal-body">
   <div class="centre-text m-btm30">
    <div style="text-align: center;">
      <span class="successshow">Are you sure you want to procced? </span>
      <br>
      <span style="font-size: 12px;">Note: Please verify all the details! </span>
     </div>
    </div>
   </div>
  <br>
  <div class="row">
     <button type="button" class="col-md-6" style="text-align:center; width: auto;" class="btn btn-primary btn-rounded btn-md font-weight-medium auth-form-btn"
     aria-label="Close" (click)="closeModalDialog()" matStepperNext>
     <i class="bi bi-arrow-right-circle"></i>&nbsp;
      <span aria-hidden="true">Ok</span>
  </button>
  <button type="button" class="col-md-6" style="width: auto;" class="btn btn-danger btn-rounded btn-md font-weight-medium auth-form-btn"
     aria-label="Close" (click)="closeModalDialog()">
     <i class="bi bi-x icon"></i>
      <span aria-hidden="true">Cancel</span>
  </button>
</div>

  </ng-template>

  
<!-- <ng-template #observationIter let-modal>
  <form [formGroup]="ObservationsForm">
    <div class="modal-header" style="text-align: center; display: block">
      <h2 class="modal-title" style="display: contents">Observations:</h2>
    </div>
    <div class="modal-body">
      <textarea col=60 row=1 (keyup)="onKeyObservation($event);" 
      class="form-control"  [(ngModel)]="observationValues"
      formControlName="observations"  placeholder="Ex. Observations ..." >
      </textarea>
      <br>
      <div style="text-align: center">
        <button class="btn btn-primary" (click)="submit(observationUpdateFlag)" [disabled]="disableObservation" 
        style="font-size: 14px;">
          Save</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <button type="button" aria-label="Close" class="btn btn-danger" (click)="closeModalDialog()"
          style="font-size: 14px;">
          <i class="bi bi-x icon"></i>
          <span aria-hidden="true">Cancel</span>
        </button>
      </div>
</div>
    <div *ngIf="success" style="text-align: center;">
      <span class="successshow">{{successMsg}}</span>
    </div>
    <div *ngIf="Error" style="text-align: center;">
      <span class="errorshow">{{errorMsg}}</span>
    </div>
  </form>
</ng-template> -->
