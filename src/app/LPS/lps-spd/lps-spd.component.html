<div class="card">
<div class="card-body">
    <form [formGroup]="spdForm" (ngSubmit)="onSubmit(flag)" (keyup)="onKeyForm($event)" (change)="onChangeForm($event)">
        <div formArrayName="spd" *ngFor="let q of overAllspdControl(); let j = index">
        <div class="form-group" [formGroupName]="j">  
        <mat-accordion>
            <mat-expansion-panel>
                <mat-expansion-panel-header>Basic Details</mat-expansion-panel-header>
                <div class="row">
                    <div class="col-md-4">
                        <label for="buildingnumber">Building Number</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">
                                    <i class="bi bi-align-start"></i>
                                </span>
                                </div>
                            <input class="form-control"  placeholder="Enter length in meter"/>
                        </div>
                    </div>
        
                    <div class="col-md-4">
                        <label for="buildingname">Building Name</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">
                                    <i class="bi bi-align-start"></i>
                                </span>
                            </div>
                            <input  class="form-control"  placeholder="Enter length in meter"/>
                        </div>
                    </div>
                </div>
                    
                    <!-- tables -->
                    <div class="row">
                    <div class="col-sm-16">
                        <div class="table-responsive" style="overflow-x: unset; margin-top: 20px;"> 
                            <table class="table TableBorder">
                            <thead>
                                <th>SI.No</th>
                                <th>Description</th>
                                <th>Observation</th>
                                <th>Remarks(Optional)</th>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="width: 1rem; text-align: center;">1.</td>
                                    <td style="width: 24rem;">Mains incoming panel</td>
                                    <td style="width: 43rem;">
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">
                                                    <i class="bi bi-text-paragraph"></i>
                                                </span></div>
                                            <textarea type="text" class="form-control" [readonly]="isEditable" formControlName="mainsIncomingOb"
                                                placeholder="Please enter Observation here"
                                                [ngClass]="{'is-invalid': submitted && q.get('mainsIncomingOb')?.errors}"></textarea>
                                            <div *ngIf="submitted && q.get('mainsIncomingOb')?.errors" class="invalid-feedback">
                                                <div *ngIf="q.get('mainsIncomingOb')?.errors?.required">Mains incoming panel observation is required
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td style="width: 43rem;">
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">
                                                    <i class="bi bi-text-paragraph"></i>
                                                </span>
                                            </div>
                                            <textarea type="text" class="form-control"
                                                [readonly]="isEditable" formControlName="mainsIncomingRem"  [(ngModel)]="spd.mainsIncomingRem"
                                                ></textarea>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="text-align: center;">2.</td>
                                    <td>Total Number of mains incoming panels</td>
                                    <td>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">
                                                    <i class="bi bi-text-paragraph"></i>
                                                </span>
                                            </div>
                                            <textarea type="text" class="form-control"
                                                [readonly]="isEditable" formControlName="totalMainsIncomingOb"  
                                                placeholder="Please enter Observation here"
                                                [ngClass]="{'is-invalid': submitted && q.get('totalMainsIncomingOb')?.errors}"></textarea>
                                                <div *ngIf="submitted && q.get('totalMainsIncomingOb')?.errors" class="invalid-feedback">
                                                <div *ngIf="q.get('totalMainsIncomingOb')?.errors?.required">Total Number of mains incoming panels observation is required</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">
                                                    <i class="bi bi-text-paragraph"></i>
                                                </span>
                                            </div>
                                            <textarea type="text" class="form-control"
                                                [readonly]="isEditable" formControlName="totalMainsIncomingRem"  [(ngModel)]="spd.totalMainsIncomingRem"
                                                ></textarea>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="text-align: center;">3.</td>
                                    <td>Total Number of panels supplting power to outdoor equipment such as light
                                        fittings / air conditioner chiller units (not split AC outdoor unit)</td>
                                    <td>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">
                                                    <i class="bi bi-text-paragraph"></i>
                                                </span>
                                            </div>
                                            <textarea type="text" class="form-control"
                                                [readonly]="isEditable" formControlName="noPannelSupplittingOb"
                                                placeholder="Please enter Observation here"
                                                [ngClass]="{'is-invalid': submitted && q.get('noPannelSupplittingOb')?.errors}"></textarea>
                                            <div *ngIf="submitted && q.get('noPannelSupplittingOb')?.errors" class="invalid-feedback">
                                                <div *ngIf="q.get('noPannelSupplittingOb')?.errors?.required">Total Number of panels supplting power to outdoor equipment observation is
                                                    required</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">
                                                    <i class="bi bi-text-paragraph"></i>
                                                </span>
                                            </div>
                                            <textarea type="text" class="form-control" 
                                                [readonly]="isEditable" formControlName="noPannelSupplittingRem"
                                                ></textarea>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="text-align: center;">4.</td>
                                    <td>Total Number of outdoor equipment and type each equipment</td>
                                    <td>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">
                                                    <i class="bi bi-text-paragraph"></i>
                                                </span>
                                            </div>
                                            <textarea type="text" class="form-control"
                                                [readonly]="isEditable" formControlName="totalNoOutDoorRequipmentOb"
                                                placeholder="Please enter Observation here"
                                                [ngClass]="{'is-invalid': submitted && q.get('totalNoOutDoorRequipmentOb')?.errors}"></textarea>
                                            <div *ngIf="submitted && q.get('totalNoOutDoorRequipmentOb')?.errors" class="invalid-feedback">
                                                <div *ngIf="q.get('totalNoOutDoorRequipmentOb')?.errors?.required">Total Number of outdoor equipment observation is
                                                    required</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">
                                                    <i class="bi bi-text-paragraph"></i>
                                                </span>
                                            </div>
                                            <textarea type="text" class="form-control" 
                                                [readonly]="isEditable" formControlName="totalNoOutDoorRequipmentRem"
                                                ></textarea>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        </div>
                    </div>
                    </div>

            </mat-expansion-panel>

            <div style="margin-top: 10px;">
                <label style="font-size: 11px; font-weight: bold;">* SPD is necessary for each mains incoming panel and each electrical panel feeding power to an outdoor equipment</label>
            </div>

            <mat-expansion-panel>
                <mat-expansion-panel-header>SPD</mat-expansion-panel-header>
                <div class="row">
                    <div class="col-sm-16">
                    <div class="table-responsive" style="overflow-x: unset;">
                        <table class="table TableBorder">
                            <tbody>
                                <div class="form-group">

                                    <thead>
                                        <th>SI.No</th>
                                        <th>Description</th>
                                        <th>Observation</th>
                                        <th>Remarks(Optional)</th>
                                    </thead>

                                    <!-- <div class="row">
                                        <div class="col-md-4">
                                            <label for="buildingnumber">Location</label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-align-start"></i>
                                                    </span>
                                                    </div>
                                                <input class="form-control"  placeholder="Enter Location"/>
                                            </div>
                                        </div>
                            
                                        <div class="col-md-4">
                                            <label for="buildingname">Panel Name</label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-align-start"></i>
                                                    </span>
                                                </div>
                                                <input  class="form-control"  placeholder="Enter panel name"/>
                                            </div>
                                        </div>
                                    </div>
                                    <br> -->

                                    <tr>
                                        <td style="width: 1rem; text-align: center;">5</td>
                                        <td style="width: 43rem;">
                                                <label for="buildingnumber">Location</label>
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="bi bi-align-start"></i>
                                                        </span>
                                                        </div>
                                                    <input class="form-control"  placeholder="Enter Location"/>
                                                </div>
                                        </td>
                                        <td style="width: 43rem;">
                                            <label for="buildingnumber">Panel Name</label>
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <i class="bi bi-align-start"></i>
                                                        </span>
                                                        </div>
                                                    <input class="form-control"  placeholder="Enter Location"/>
                                                </div>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td rowspan="5" style="width: 1rem; text-align: center;">5(a)</td>
                                        <td style="width: 24rem; font-weight: 600;">* Details of SPD</td>
                                        <td style="width: 43rem;"></td>
                                        <td style="width: 43rem;"></td>
                                    </tr>

                                    <tr>
                                        <td>Make</td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                                </div>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td>Model</td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td>class Type</td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <select class="form-control">
                                                    <option  value="" selected>Select Option</option>
                                                    <option value="class I" >class I</option>
                                                    <option value="class II" >class II</option>
                                                    <option value="class III" >class III</option>
                                                </select>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td>Application</td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <select class="form-control">
                                                    <option  value="" selected>Select Option</option>
                                                    <option value="Power line" >Power line</option>
                                                    <option value="telecom line" >Telecom line</option>
                                                </select>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td style="text-align: center;">5(b)</td>
                                        <td>Application</td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <select class="form-control" >
                                                    <option  value="" selected>Select Option</option>
                                                    <option value="YES" >Continuation of supply to equipment</option>
                                                    <option value="NO" >Continuation of protection to equipment</option>
                                                </select>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                    </tr>
                                    
                                    <tr>
                                        <td style="text-align: center;">5(c)</td>
                                        <td>Proper connection made based on application</td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <select class="form-control">
                                                    <option  value="" selected>Select Option</option>
                                                    <option value="YES" >Yes</option>
                                                    <option value="NO" >No</option>
                                                </select>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td style="text-align: center;">5(d)</td>
                                        <td>Incomer rating of the panel in A</td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td style="text-align: center;">5(e)</td>
                                        <td>Back up fuse/MCB rating in A (Back up fuse in line with safety requirements at "End of Life")</td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td rowspan="3" style="text-align: center;">5(f)</td>
                                        <td style="font-weight: 600;">* Length of connecting wire in meters</td>
                                    </tr>

                                    <tr>
                                        <td>Phase</td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td>Protective conductor</td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td rowspan="3" style="text-align: center;">5(g)</td>
                                        <td style="font-weight: 600;">* Size of connecting wire in sq.mm</td>
                                    </tr>

                                    <tr>
                                        <td>Phase</td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td>Protective conductor</td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-text-paragraph"></i>
                                                    </span>
                                                </div>
                                                <textarea type="text" class="form-control"></textarea>
                                            </div>
                                        </td>
                                    </tr>

                                </div>

                            </tbody>
                        </table>
                    </div>
                    </div>
                </div>
            </mat-expansion-panel>

        </mat-accordion>
        </div>
        </div>

        <div style="text-align: center;margin-top: 40px;margin-bottom: 20px;">
            <button class="previous" mat-button matStepperPrevious>&laquo; Back</button>
            <button class="next" (click)="gotoNextModal(content,contents)" mat-button >Next &raquo;</button>
        </div>  

        <div *ngIf="validationError" style="text-align: center;margin-top: 30px;">
            <span class="alert alert-danger">{{validationErrorMsg}}</span>
        </div>
    </form>
</div>
</div>

<ng-template #content let-modal>
    <div class="modal-body">
        <div class="centre-text m-btm30">
            <div *ngIf="success" style="text-align: center;">
                <span class="successshow">{{successMsg}}</span>
            </div>
            <div *ngIf="Error" style="text-align: center;">
                <span class="errorshow">{{errorMsg}}</span>
            </div>
        </div>
    </div>
    <br>
     <button type="button" class="close" class="btn btn-block btn-primary btn-rounded btn-md font-weight-medium auth-form-btn"
     aria-label="Close"  (click)="closeModalDialog()" matStepperNext>

      <span aria-hidden="true">Ok</span>

  </button>
</ng-template> 
<ng-template #contents let-modal>
    <div class="modal-body">
     <div class="centre-text m-btm30">
      <div style="text-align: center;">
        <span class="successshow">Are you sure you want to procced? </span>
        <br>
        <span style="font-size: 12px;">Note: Please verify all the details! </span>
       </div>
      </div>
     </div>
    <br>
    <div class="row">
       <button type="button" class="col-md-6" style="text-align:center; width: auto;" class="btn btn-primary btn-rounded btn-md font-weight-medium auth-form-btn"
       aria-label="Close" (click)="closeModalDialog()" matStepperNext>
       <i class="bi bi-arrow-right-circle"></i>&nbsp;
        <span aria-hidden="true">Ok</span>
    </button>
    <button type="button" class="col-md-6" style="width: auto;" class="btn btn-danger btn-rounded btn-md font-weight-medium auth-form-btn"
       aria-label="Close" (click)="closeModalDialog()">
       <i class="bi bi-x icon"></i>
        <span aria-hidden="true">Cancel</span>
    </button>
  </div>
  
    </ng-template>