<div *ngIf="service.msgForStep1" style="text-align: center;margin-top: 30px;">
    <span class="successshow">Please fill steps to proceed further!</span>
</div>
<div *ngIf="tabError" style="text-align: center;">
    <span class="alert alert-danger">{{tabErrorMsg}}</span>
</div>
<div *ngIf="validationErrorTab" style="text-align: center;">
    <span class="alert alert-danger">{{validationErrorMsgTab}}</span>
</div>
<div class="card">
<div class="card-body">
    <form [formGroup]="LPSBasicForm" (ngSubmit)="onSubmit(flag)" (keyup)="onKeyForm($event)" (change)="onChangeForm($event)" (window:beforeunload)="doBeforeUnload()">
        <div  formArrayName="lpsBasic" *ngFor="let f of overAllControl(); let j = index">
            <div class="col-md-4" class="form-group" [formGroupName]="j">
            <div class="row" style="font-weight: bold;">
                <label for="Basicdetails" style="font-weight: bold;margin: 10px;font-size: 16px;">Basic Details</label>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <label for="clientname">Client Name</label>
                    <!-- icon code -->
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"> 
                                <i class="bi bi-person-lines-fill"></i>
                            </span>
                        </div>
                        <input type="text" class="form-control" placeholder="Enter clientname"
                            [readonly]="isEditable1" formControlName="clientName"
                            [ngClass]="{ 'is-invalid': submitted && f.get('clientName')?.errors }"/>
                        <div *ngIf="submitted && f.get('clientName')?.errors" class="invalid-feedback">
                                <div *ngIf="f.get('clientName')?.errors?.required">ClientName is required</div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="projectname">Project Name</label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <i class="bi bi-journal-plus"></i>
                            </span>
                        </div>
                        <input type="text" class="form-control" placeholder="Enter project name" (change)="projectValidation($event,f)"
                            [readonly]="isEditable1" formControlName="projectName" [ngClass]="{ 'is-invalid': submitted && f.get('projectName')?.errors }"/>
                            <div *ngIf="submitted && f.get('projectName')?.errors" class="invalid-feedback">
                                <div *ngIf="f.get('projectName')?.errors?.required">ProjectName is required</div>
                            </div>

                            <div *ngIf="projectNameError" class="invalid-feedback">
                                <div>{{projectNameMsg}}</div>
                            </div>
                            
                            <div *ngIf="projectNameSuccess" class="invalid-feedback">
                                <div style="color: #11a807;">{{projectNameMsg1}}</div>
                            </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="pmcname">PMC Name </label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <i class="bi bi-person-lines-fill"></i>
                            </span>
                        </div>
                        <input type="text" class="form-control" placeholder="Enter PMC name (Optional)" [readonly]="isEditable" formControlName="pmcName"
                        [ngClass]="{ 'is-invalid': submitted && f.get('pmcName')?.errors }"/>
                        <div *ngIf="submitted && f.get('pmcName')?.errors" class="invalid-feedback">
                            <div *ngIf="f.get('pmcName')?.errors?.required">PMC Name is required</div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="consultantname">Consultant Name </label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <i class="bi bi-person-lines-fill"></i>
                            </span>
                        </div>
                        <input type="text" class="form-control" placeholder="Enter consultant name (Optional)"
                            [readonly]="isEditable" formControlName="consultantName" [ngClass]="{ 'is-invalid': submitted && f.get('consultantName')?.errors }"/>
                            <div *ngIf="submitted && f.get('consultantName')?.errors" class="invalid-feedback">
                                <div *ngIf="f.get('consultantName')?.errors?.required">Consultant Name is required</div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="contractorname">Contractor Name </label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <i class="bi bi-person-lines-fill"></i>
                            </span>
                        </div>
                        <input type="text" class="form-control" placeholder="Enter contractor name (Optional)"
                            [readonly]="isEditable" formControlName="contractorName" [ngClass]="{ 'is-invalid': submitted && f.get('contractorName')?.errors }"/>
                            <div *ngIf="submitted && f.get('contractorName')?.errors" class="invalid-feedback">
                                <div *ngIf="f.get('contractorName')?.errors?.required">Contractor Name is required</div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="dealer/sub-contractor">Dealer/Sub-contractor </label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <i class="bi bi-person-lines-fill"></i>
                            </span>
                        </div>
                        <input type="text" class="form-control" placeholder="Enter dealer/sub-contractor name (Optional)"
                            [readonly]="isEditable" formControlName="dealerContractorName" [ngClass]="{ 'is-invalid': submitted && f.get('dealerContractorName')?.errors }"/>
                            <div *ngIf="submitted && f.get('dealerContractorName')?.errors" class="invalid-feedback">
                                <div *ngIf="f.get('dealerContractorName')?.errors?.required">Dealer/Sub-contractor is required</div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="address">Address </label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <i class="bi bi-geo-fill"></i>
                            </span>
                        </div>
                        <input type="text" class="form-control" placeholder="Enter address name"
                            [readonly]="isEditable" formControlName="address" [ngClass]="{ 'is-invalid': submitted && f.get('address')?.errors }"/>
                            <div *ngIf="submitted && f.get('address')?.errors" class="invalid-feedback">
                                <div *ngIf="f.get('address')?.errors?.required">Address is required</div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="location/region/branch">Location/Region/Branch </label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <i class="bi bi-geo-fill"></i>
                            </span>
                        </div>
                        <input type="text" class="form-control" placeholder="Enter Location/Region/Branch name"
                            [readonly]="isEditable" formControlName="location" [ngClass]="{ 'is-invalid': submitted && f.get('location')?.errors }"/>
                            <div *ngIf="submitted && f.get('location')?.errors" class="invalid-feedback">
                                <div *ngIf="f.get('location')?.errors?.required">Location/Region/Branch is required</div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="typeofindustry">Type of Industry </label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <i class="bi bi-building"></i>
                            </span>
                        </div>
                        <input type="text" class="form-control" placeholder="Enter Type of Industry name"
                            [readonly]="isEditable" formControlName="industryType" [ngClass]="{ 'is-invalid': submitted && f.get('industryType')?.errors }"/>
                            <div *ngIf="submitted && f.get('industryType')?.errors" class="invalid-feedback">
                                <div *ngIf="f.get('industryType')?.errors?.required">Type of Industry is required</div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="soilresistivity">Soil Resistivity in ohm-meter(Optional)</label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <i class="bi bi-shield-fill-x"></i>
                            </span>
                        </div>
                        <input (keypress)="keyPressNumbers($event)" class="form-control" placeholder="Enter Soil Resistivity"
                            [readonly]="isEditable" formControlName="soilResistivity"
                            />
                    </div>
                </div>                
            </div>

            <!-- <div class="row" style="font-weight: bold;">
                <label for="Basicdetails" style="font-weight: bold;margin: 10px; font-size: 16px;">Person who preparing the report</label>
            </div> -->
            
            <!-- <div class="row">
                <div class="col-md-4">
                    <label for="email1">Email</label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"> 
                                <i class="bi bi-person-lines-fill"></i>
                            </span>
                        </div>
                        <input type="text" class="form-control" formControlName="email1" [ngModel]="currentUsermail" readonly/>
                    </div>
                </div>
                <div class="col-md-4">
                    <label for="name1">Name</label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"> 
                                <i class="bi bi-person-lines-fill"></i>
                            </span>
                        </div>
                        <input type="text" class="form-control" formControlName="name1" [ngModel]="currentUserName" readonly/>
                    </div>
                </div>
            </div> -->

            <div class="row" style="font-weight: bold;">
                <label for="Basicdetails" style="font-weight: bold;margin: 10px; font-size: 16px;">Person who ordering the report</label>
            </div>

            <div class="row">
                <div class="col-md-4">
                    <label for="clientname">Name</label>
                    <!-- icon code -->
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"> 
                                <i class="bi bi-person-lines-fill"></i>
                            </span>
                        </div>
                        <input type="text" class="form-control" placeholder="Enter Name"
                         formControlName="name"  [readonly]="isEditable" [ngClass]="{ 'is-invalid': submitted && f.get('name')?.errors }"/>
                         <div *ngIf="submitted && f.get('name')?.errors" class="invalid-feedback">
                             <div *ngIf="f.get('name')?.errors?.required">Name is required</div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="clientname">Company</label>
                    <!-- icon code -->
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"> 
                                <i class="bi bi-building"></i>
                            </span>
                        </div>
                        <input type="text" class="form-control" placeholder="Enter Company" 
                        [readonly]="isEditable" formControlName="company" [ngClass]="{ 'is-invalid': submitted && f.get('company')?.errors }"/>
                        <div *ngIf="submitted && f.get('company')?.errors" class="invalid-feedback">
                            <div *ngIf="f.get('company')?.errors?.required">Company is required</div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="clientname">Designation</label>
                    <!-- icon code -->
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"> 
                                <i class="bi bi-person-lines-fill"></i>
                            </span>
                        </div>
                        <input type="text" class="form-control" placeholder="Enter Designation" 
                        [readonly]="isEditable" formControlName="designation" [ngClass]="{ 'is-invalid': submitted && f.get('designation')?.errors }"/>
                        <div *ngIf="submitted && f.get('designation')?.errors" class="invalid-feedback">
                            <div *ngIf="f.get('designation')?.errors?.required">Designation is required</div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <label for="contactNumber">Contact Number</label>
                    <input type="tel" class="form-control" ng2TelInput [ng2TelInputOptions]="{initialCountry: 'in',separateDialCode: 'true'}"
                       (keypress)="keyPressNumbers($event)" (countryChange)="countryChange($event,f)" placeholder="Enter Contact Number" 
                       [readonly]="isEditable" formControlName="contactNumber"  [ngClass]="{ 'is-invalid': submitted && f.get('contactNumber')?.errors }"/>
                       <div *ngIf="submitted && f.get('contactNumber')?.errors" class="invalid-feedback">
                           <div *ngIf="f.get('contactNumber')?.errors?.required">Contact Number is required</div>
                           <div *ngIf="f.get('contactNumber')?.errors?.minlength">Enter 10 Digit Number</div> 
                                <div *ngIf="f.get('contactNumber')?.errors?.maxlength">Enter 10 Digit Number</div>
                       </div>
            </div>

                <div class="col-md-4">
                    <label for="clientname">Email Id</label>
                    <!-- icon code -->
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"> 
                                <i class="bi bi-envelope-fill"></i>
                            </span>
                        </div>
                        <input type="text" [readonly]="isEditable" formControlName="mailId" 
                         class="form-control" placeholder="Enter Email Id"  [ngClass]="{ 'is-invalid': submitted && f.get('mailId')?.errors }"/>
                         <div *ngIf="submitted && f.get('mailId')?.errors" class="invalid-feedback">
                             <div *ngIf="f.get('mailId')?.errors?.required">Email Id is required</div>
                            <div *ngIf="f.get('mailId')?.errors?.pattern">Enter valid email</div>
                        </div>
                    </div>
                </div>
            </div>

            <br>

            <div class="row">
                <div class="col-md-4">
                    <label>Availability of previous report</label>
                    <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text"> 
                            <i class="bi bi-check-square-fill"></i>
                        </span>
                    </div>

                    <select class="form-control" formControlName="availabilityOfPreviousReport" [attr.disabled]="isEditable ? '' : null" (ngModelChange)="dropDown1($event,f);dropDownPopup($event,dropDown);" 
                    [ngClass]="{ 'is-invalid': submitted && f.get('availabilityOfPreviousReport')?.errors }" [(ngModel)]="availableReportNo">
                        <option  value="" selected>Select Option</option>
                        <option value="Yes" >Yes</option>
                        <option value="No" >No</option>
                    </select>

                    <div *ngIf="submitted && f.get('availabilityOfPreviousReport')?.errors" class="invalid-feedback">
                        <div *ngIf="f.get('availabilityOfPreviousReport')?.errors?.required">Availability of previous report is required</div>
                    </div>
                    </div>
                </div>
            </div>

            <div class="row">
                
                <!-- File Upload for Basic -->
                <div class="col-md-12" *ngIf="f.get('availabilityOfPreviousReport')?.value == 'Yes'">
                    <table class="table TableBorder" style="margin-top: 1rem;">
                        <thead>
                          <tr>
                            <th width="25%">Attach The File Here</th>
                            <th width="27%">Name</th>
                            <th width="6%" ng-show="uploader.isHTML5">Size</th>
                            <th width="25%">Actions</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>
                              <input style="height: 3rem;" type="file" class="form-control" (change)="onChange($event,f)" [attr.disabled]="isEditable ? '' : null" accept=".txt,.jpeg,.png,.jpg,.pdf" formControlName="fileId">
                              <div *ngIf="submitted && f.get('fileId')?.errors" class="invalid-feedback">
                                <div *ngIf="f.get('fileId')?.errors?.required">Field is required</div>
                              </div>
                            </td>
                            
                            <td style="text-align: center;">{{fileName}}</td>
                            <td ng-show="uploader.isHTML5" nowrap style="text-align: center;">{{fileSize}}</td>

                            <td nowrap style="text-align: center;">
                              <button type="button" class="btn btn-secondary btn-xs mr-4" [disabled]="uploadDisable" (click)="onUpload(contentSpinner,f)" title="Upload">
                                <i class="fa fa-upload" style="color: white;"></i>  </button>
                                  <div *ngIf="submitted && f.get('fileId')?.errors" class="invalid-feedback">
                                    <div *ngIf="f.get('fileId')?.errors?.required">File upload is required</div>
                                  </div>
                              <button type="button" class="btn btn-success btn-xs mr-4" *ngIf="fileId!= null && fileId!=undefined && fileId!= ''" (click)="onDownload()" href='javascript:void(0)' title="Download" [ngClass]="{'disableForm':isEditable}">
                                <i class="fa fa-download" style="color: white;"></i></button>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                </div>

                <p class="col-md-12" *ngIf="f.get('availabilityOfPreviousReport')?.value == 'Yes'" style="font-weight: bold">Note :  If you are attaching multiple photos or files, Please create single PDF or Word document with photos and upload</p>
            </div>
        </div>
    </div>
            <div style="text-align: center;margin-top: 20px;">
                <button [ngClass]="{'disableForm':isEditable}" class="next" (click)="gotoNextModal(content,contents)" mat-button>Next &raquo;</button>
            </div>
       
            <div *ngIf="validationError" style="text-align: center;margin-left: 0%;">
            <span class="alert alert-danger">{{validationErrorMsg}}</span>
            </div>
    </form>
</div>
</div>

<ng-template #content let-modal>
    <!-- Spinner -->
    <mat-progress-spinner style="margin: 0 auto;" *ngIf="spinner" color="primary" [mode]="mode" value="50" diameter="50">
    </mat-progress-spinner>
    <br>
    <div *ngIf="spinner" style="text-align: center;">
        Please wait, the details are loading!
    </div>
    <div class="modal-body" *ngIf="popup">
        <div class="centre-text m-btm30">
            <div *ngIf="success" style="text-align: center;">
                <span class="successshow">{{successMsg}}</span>
            </div>
            <div *ngIf="Error" style="text-align: center;">
                <span class="errorshow">{{errorMsg}}</span>
            </div>
        </div>
    </div>
    <br>
    <div *ngIf="popup" style="text-align: center;">
        <button type="button" *ngIf="!Error"  class="close" class="btn btn-block btn-primary btn-rounded btn-md font-weight-medium auth-form-btn"
        aria-label="Close"  (click)="closeModalDialog()" style="margin-left: 195px;width: 16%;" matStepperNext>
         <span aria-hidden="true">Ok</span>
        </button>
    
        <button type="button" *ngIf="Error" class="close" class="btn btn-block btn-primary btn-rounded btn-md font-weight-medium auth-form-btn"
        aria-label="Close"  (click)="closeModalDialog()" style="margin-left: 195px;width: 16%;" >
        <span aria-hidden="true">Ok</span>
        </button>
    </div>
</ng-template> 

<ng-template #contents let-modal>
    <div class="modal-body">
     <div class="centre-text m-btm30">
      <div style="text-align: center;">
        <span class="successshow">Are you sure you want to procced? </span>
        <br>
        <span style="font-size: 12px;"><b>Note:</b> Please verify all the details! </span>
       </div>
      </div>
     </div>
    <br>
    <div class="row">
       <button type="button" class="col-md-6" style="width: 5rem;position: relative;margin-left: 30%;" class="btn btn-primary btn-rounded btn-md font-weight-medium auth-form-btn"
       aria-label="Close" (click)="closeModalDialog()" matStepperNext>
       <i class="bi bi-arrow-right-circle"></i>&nbsp;
        <span aria-hidden="true">Ok</span>
    </button>
    <button type="button" class="col-md-6" style="text-align: center;width: auto;position: relative;margin-right: 30%;" class="btn btn-danger btn-rounded btn-md font-weight-medium auth-form-btn"
       aria-label="Close" (click)="closeModalDialog()">
       <i class="bi bi-x icon"></i>
        <span aria-hidden="true">Cancel</span>
    </button>
  </div>
</ng-template>

<ng-template #dropDown let-modal>
    <div class="modal-body">
     <div class="centre-text m-btm30">
      <div style="text-align: center;">
        <span class="warningMsg">Note: If select option No, On click of Next button Previously uploaded file will be Removed</span>
       </div>
      </div>
     </div>
    <br>
    <div class="row">
       <button type="button" class="col-md-6" style="position: relative;margin-left: 20%;width: auto;" class="btn btn-primary btn-rounded btn-md font-weight-medium auth-form-btn"
       aria-label="Close" (click)="closeModalDialog1('No')">
       <i class="bi bi-arrow-right-circle"></i>&nbsp;
        <span aria-hidden="true">Confirm</span>
    </button>
    <button type="button" class="col-md-6" style="text-align: center;width: auto;position: relative;margin-right: 20%;" class="btn btn-danger btn-rounded btn-md font-weight-medium auth-form-btn"
       aria-label="Close" (click)="closeModalDialog1('Yes')">
       <i class="bi bi-x icon"></i>
        <span aria-hidden="true">Cancel</span>
    </button>
  </div>
</ng-template>

<!-- File Upload -->
<ng-template #contentSpinner let-modal>
    <mat-progress-spinner style="margin: 0 auto;" *ngIf="spinnerUpload" color="primary" [mode]="mode" value="50" diameter="50">
    </mat-progress-spinner>
    <div class="modal-body" *ngIf="popupUpload">
        <div class="centre-text m-btm30">
            <div *ngIf="filesuccess" style="text-align: center;">
                <span class="successshow">{{filesuccessMsg}}</span>
            </div>
            <div *ngIf="Error" style="text-align: center;">
                <span class="errorshow">{{errorMsg}}</span>
            </div>
        </div>
    </div>
    <div *ngIf="filesuccess" style="text-align: center;">
        <b>Note:</b> Please click Next Button, Then only the file changes will reflect!
      </div>
    <div *ngIf="popupUpload">
        <button type="button" style="text-align: center;margin-left:180px;width:20%" class="close" (click)="closeModalDialogFile()"
            class="btn btn-block btn-primary btn-rounded btn-md font-weight-medium auth-form-btn" aria-label="Close">
            <span >Ok</span>
        </button>
    </div>
</ng-template>